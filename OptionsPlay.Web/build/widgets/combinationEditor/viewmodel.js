define(["knockout","modules/formatting","dataContext","modules/localizer","modules/combinationViewModel","modules/dropDownList","modules/enums","events","koBindings/chartBindings"],function(e,t,n,r,i,s,o,u){var a=function(){function s(){n.optionChains.get(i.combination.ulCode).done(function(e){var n=e.expirationDates.map(function(e){var n={key:t.formatDate(e.date,"MMM")+" ("+e.noOfDaysToExpiry+")",value:e.date};return n});i.expiryList(n),i.expiryStrikes(e.expiryStrikes)})}var i=this;this.expiryList=e.observableArray([]),this.expiryStrikes=e.observable({}),this.activate=function(e){var n=e.combination;this.combination=n,s(),this.localeSub=r.activeLocale.subscribe(s),this.removeLeg=function(e){i.combination.removePosition(e)},this.flipBuySell=function(){i.combination.positions().forEach(function(e){e.buySellFlag(!e.buySellFlag())})},this.increaseQuantity=function(){var e=i.combination.absQuantity();i.combination.positions().forEach(function(t){var n=t.absQuantity();t.absQuantity(n+Math.max(1,t.absQuantity()/e))})},this.decreaseQuantity=function(){var e=i.combination.absQuantity();e>1&&i.combination.positions().forEach(function(t){var n=t.absQuantity();t.absQuantity(Math.max(1,n-Math.max(1,t.absQuantity()/e)))})},this.forwardExpiry=function(e){var t=i.combination.chains;t&&i.combination.positions().forEach(function(n){var r=t.findExpiry(n.expiry(),e,1);r&&n.expiry(r.date)})},this.forwardStrike=function(e){var t=i.combination.chains;t&&i.combination.positions().forEach(function(n){var r=t.findStrike(n.strikePrice(),n.expiry(),e);r&&n.strikePrice(r)})},this.addNewLeg=function(e){var n=e?o.CALL:o.PUT,r=i.combination.strikes()[0]||i.expiryStrikes()[t.formatDate(i.combination.expiry(),"yyyyMMdd")];i.combination.addPosition(i.combination.buyOrSell(),1,n,i.combination.expiry(),r)},this.resetCombination=function(){var e=i.combination.positions().slice(0);for(var t=0;t<e.length;t++)i.combination.removePosition(e[t]);i.combination.initPositions(i.combination.originalLegs)},this.prefillOrder=function(){}},this.detached=function(){i.localeSub&&i.localeSub.dispose()}};return a});