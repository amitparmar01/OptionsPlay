define("koExtenders",["knockout","jquery"],function(e,t){window.ko=e;var n={"boolean":!0,number:!0,string:!0,"function":!0,"undefined":!0};e.observable.fn.equalityComparer=function(e,r){return typeof e in n||typeof r in n||e===null||r==null?e===r:t.isArray(e)&&t.isArray(r)?e.length!=r.length?!1:e.every(function(e,t){return e===r[t]}):e.valueOf&&r.valueOf?e.valueOf()===r.valueOf():!1},e.extenders.allows=function(n,r){var i=e.computed({read:n,write:function(e){var i=!0;typeof r=="function"?i=r(e):t.isArray(r)&&(i=r.some(function(t){return t===e}));var s=n();i&&e!==s?n(e):e!==s&&n.notifySubscribers(s)}}).extend({notify:"always"});return i(n()),i},e.extenders.shouldTrim=function(t){var n=e.computed({read:t,write:function(e){var n=t(),r=e.trim();r!==n&&t(r)}});return n(t()),n}}),define("modules/context",["knockout","dataContext","koExtenders"],function(e,t){function i(){var e=n;return localStorage&&localStorage.defaultUlCode&&(e=localStorage.defaultUlCode),e}function o(e){return r.optionables().some(function(t){return t.securityCode==e})}var n="600104",r={};r.optionables=e.observableArray();var s=function(e){return localStorage&&(localStorage.defaultUlCode=e),e};return r.symbolCode=e.observable(i()).extend({shouldTrim:!0}),r.symbolCode.subscribe(s),r.ulCode=r.symbolCode.extend({allows:o}),r.quote=e.observable(null),r.selectedTradeIdea=e.observable(null),r.selectedTradeIdea.subscribe(function(e){e&&r.ulCode()!==e.securityCode&&r.ulCode(e.securityCode)}),r.isTradePanelVisible=e.observable(!0),r.symbolSentiments=e.observable(),r.trendSentiment=e.observable(),r.isWhyPanelLoading=e.observable(!1),r.isHowPanelLoading=e.observable(!1),r.isTradeIdPanelLoading=e.observable(!1),r}),define("modules/configurations",["knockout"],function(e){var t={};t.TechnicalAnalysis=Object.freeze({riskFreeRate:e.observable(.03),defaultDividendYield:e.observable(0),daysOfDefaultExpiry:e.observable(20)});var n=e.observable(function(){return localStorage&&typeof localStorage.showTrace!="undefined"?JSON.parse(localStorage.showTrace):!1}());return n.subscribe(function(e){localStorage&&(localStorage.showTrace=e)}),t.App=Object.freeze({showTrace:n,gridPageSize:e.observable(10)}),t.updateConfiguration=function(e){t.TechnicalAnalysis.riskFreeRate(e.technicalAnalysis.riskFreeRate),t.TechnicalAnalysis.defaultDividendYield(e.technicalAnalysis.defaultDividendYield),t.TechnicalAnalysis.daysOfDefaultExpiry(e.technicalAnalysis.daysOfDefaultExpiry),(!localStorage||typeof localStorage.showTrace=="undefined")&&t.App.showTrace(e.app.showTrace),t.App.gridPageSize(e.app.gridPageSize)},t.DATE_FORMAT="yyyy/MM/dd",Object.freeze(t)}),define("modules/enums",[],function(){var e=Object.freeze||function(e){return e},t={BUY:"BUY",SELL:"SELL",CALL:"CALL",PUT:"PUT",COVERED:"COVERED",SECURITY:"SECURITY",BULLISH:"bullish",BEARISH:"bearish"};return t.Sentiment=e({BULLISH:"Bullish",BEARISH:"Bearish"}),t.StockTwitsSentiment=e({BULLISH:"Bullish",BEARISH:"Bearish",NEUTRAL:"Neutral"}),t.BuyOrSell=e({BUY:"BUY",SELL:"SELL"}),t.LegType=e({CALL:"CALL",PUT:"PUT",SECURITY:"SECURITY",SEC:"SEC"}),t.PhpType=e({TRADEIDEAS:"tradeIdeas",PORTFOLIO:"portfolio",DEFAULT:"tradeIdeas"}),t.PhpWhatState=e({WATCH_LISTS:"watchLists",SHARE:"share",DEFAULT:"default"}),t.PhpHubEvents=e({QUOTES:"Quotes",SYRAH_SENTIMENT:"SyrahSentiment",LATEST_HISTORICAL_DATA:"LatestHistoricalData",MARKET_WORK_TIME:"MarketWorkTime",MARKET_INDEX_SENTIMENT:"MarketIndexSentiment"}),t.Roles=e({ADMIN:"Admin"}),t.Permissions=e({NOT_AUTHENTICATED:"NotAuthenticated",USE_REAL_TIME_QUOTES:"UseRealTimeQuotes",VIEW_USER_ACTIVITIES:"ViewUserActivities",MANAGE_PROMO_CODES:"ManagePromoCodes",MANAGE_DISCOUNTS:"ManageDiscounts",MANAGE_SUBSCRIPTIONS:"ManageSubscriptions",EDIT_USERS:"EditUsers",MANAGE_API_KEYS:"ManageApiKeys",VIEW_POWERHOUSE_OPP:"ViewPowerhouseOPP",VIEW_POWERHOUSE_OPI:"ViewPowerhouseOPI",VIEW_POWERHOUSE_PRO_COMMON:"ViewPowerhouseProCommon",WORK_WITH_POWERHOUSE_PRO_CORE:"WorkWithPowerhouseProCore",MANAGE_PROFILE:"ManageProfile",MANAGE_PROFILE_SUBSCRIPTIONS:"ManageProfileSubscriptions",MANAGE_PAYMENT_TRANSACTIONS:"ManagePaymentTransactions",ALLOW_SHARING:"AllowSharing"}),t.ErrorCodes=e({ALREADY_AUTHENTICATED:1070001}),t.BillingModel=e({MONTHLY:"Monthly",ANNUAL:"Annual"}),t.SharingType=e({TWITTER:"Twitter",STOCKTWITS:"StockTwits",EMAIL:"Email",EMAIL_CLIENT:"EmailClient",COPY:"Clipboard"}),t.SubscriptionStatus=e({ACTIVE_TRIAL:"ActiveTrial",ACTIVE:"Active",EXPIRED:"Expired",NO_SUBSCRIPTIONS:"NoSubscriptions",NO_APPLIED_SUBSCRIPTIONS:"NoAppliedSubscriptions",EXPIRED_TRIAL:"ExpiredTrial",ACTIVE_CANCELED:"ActiveCanceled"}),t.KeyboardCodes=e({ENTER:13,SLASH:47}),t.Quadrant=e({TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_RIGHT:"bottom-right",BOTTOM_LEFT:"bottom-left"}),t.PriceOptions=e({BID_ASK:"Bid/Ask",MID:"Mid"}),e(t)}),define("modules/strategyTemplates",["knockout","modules/enums"],function(e,t){var n=1e3,r=function(){function i(e){var r=e.legs;r.sort(function(e,n){if(e.legType.toUpperCase()==t.SECURITY)return-1;if(n.legType.toUpperCase()==t.SECURITY)return 1;var r=e.strike-n.strike;return r||(r=e.expiry-n.expiry),r||(r=e.legType.toUpperCase()==t.CALL?-1:1),r});var i="";for(var s=0;s<r.length;s++){var o=r[s],u=r[s-1],a=o.buyOrSell.toUpperCase()==t.BUY?o.quantity:-o.quantity,f=1;u&&(f=u.buyOrSell.toUpperCase()==t.BUY?u.quantity:-u.quantity,u.legType.toUpperCase()==t.SECURITY&&(f/=n)),o.legType.toUpperCase()==t.SECURITY&&(a/=n),i+=((u?a/f:a>0?1:-1)*100).toFixed(0),i+=!u||u.legType.toUpperCase()==t.SECURITY?2:u.expiry==o.expiry?0:u.expiry<o.expiry?-1:1,i+=!u||u.legType.toUpperCase()==t.SECURITY?2:o.strike==u.strike?0:1,i+=o.legType.toUpperCase()==t.SECURITY?0:o.legType.toUpperCase()==t.CALL?1:2,i+="|"}return i}function s(e){var n={};for(var s=0;s<e.length;s++){var o={legs:[]},u=e[s],a=i(u);n[a]&&(console.log("Buy"),console.log(u),console.log(n[a]));var f="Long "+u.name;r.strategyMapping[a]={template:u,buyOrSell:"Buy",longOrShort:"Long",displayedName:f,iconName:f.replace(/ /g,"")},r.nameStrategyMap[f]=r.strategyMapping[a],n[a]={template:u,buyOrSell:t.BUY},u.buyEigenvalue=a,$.each(u.legs,function(e,t){o.legs.push({buyOrSell:t.buyOrSell=="Sell"?"Buy":"Sell",quantity:t.quantity,strike:t.strike,expiry:t.expiry,legType:t.legType})}),a=i(o),n[a]&&(console.log("Sell"),console.log(u),console.log(n[a])),f="Short "+u.name,r.strategyMapping[a]={template:u,buyOrSell:"Sell",longOrShort:"Short",displayedName:f,iconName:f.replace(/ /g,"")},r.nameStrategyMap[f]=r.strategyMapping[a],n[a]={template:u,buyOrSell:t.SELL},u.sellEigenvalue=a}return n}var r=this;this.sentiments=["Bullish","Bearish","Neutral","Sharp-Move","All Strategies"],this.strategyTemplates=e.observableArray([]),this.templateMap=this.strategyMapping={},this.initialize=function(e){for(var t=0;t<e.length;t++){var n={legs:[]},s=e[t],o=i(s);r.strategyMapping[o]&&(console.log("Buy"),console.log(s),console.log(r.strategyMapping[o]));var u="Long "+s.name;r.strategyMapping[o]={template:s,buyOrSell:"Buy",longOrShort:"Long",displayedName:u,iconName:u.replace(/ /g,"")},r.nameStrategyMap[u]=r.strategyMapping[o],s.buyEigenvalue=o,!s.name.match(/covered call/i)&&!s.name.match(/protective put/i)&&($.each(s.legs,function(e,t){n.legs.push({buyOrSell:t.buyOrSell=="Sell"?"Buy":"Sell",quantity:t.quantity,strike:t.strike,expiry:t.expiry,legType:t.legType})}),o=i(n),r.strategyMapping[o]&&(console.log("Sell"),console.log(s),console.log(r.strategyMapping[o])),u="Short "+s.name,r.strategyMapping[o]={template:s,buyOrSell:"Sell",longOrShort:"Short",displayedName:u,iconName:u.replace(/ /g,"")},r.nameStrategyMap[u]=r.strategyMapping[o]),s.sellEigenvalue=o,r.strategyTemplates.push(s)}for(var a in r.sentimentStrategyNamesMap){var f=r.sentimentStrategyNamesMap[a];f.forEach(function(e){r.sentimentStrategyMap[a].push(r.nameStrategyMap[e])})}},this.setTempates=function(e){r.templates=e,r.initialize(e)},this.sentimentStrategyNamesMap={Bullish:["Long Call","Long Call Vertical","Short Put Vertical","Long Call Ratio 1x2","Long Synthetic Stock","Long Collar","Short Put","Long Call Diagonal"],Bearish:["Long Put","Long Put Vertical","Short Call Vertical","Long Put Ratio 1x2","Short Synthetic Stock","Short Collar","Short Call","Long Put Diagonal"],Neutral:["Long Call Butterfly","Long Put Butterfly","Long Call Condor","Long Put Condor","Short Iron Butterfly","Short Iron Condor","Short Straddle","Short Strangle","Long Call Calendar","Long Put Calendar"],"Sharp-Move":["Long Straddle","Long Strangle","Long Iron Butterfly","Long Iron Condor","Short Call Butterfly","Short Put Butterfly","Short Call Condor","Short Put Condor"],"All Strategies":["Long Stock","Long Call","Long Put","Long Call Vertical","Long Put Vertical","Long Call Ratio 1x2","Long Put Ratio 1x2","Long Call Ratio 2x3","Long Put Ratio 2x3","Long Straddle","Long Strangle","Long Call Butterfly","Long Put Butterfly","Long Iron Butterfly","Long Call Condor","Long Put Condor","Long Iron Condor","Long Covered Call","Long Synthetic Stock","Long Collar","Long Vertical Spread Spread","Long Call Calendar","Long Put Calendar","Long Call Diagonal","Long Put Diagonal","Long Double Diagonal","Long Financed Vertical","Short Call","Short Put","Short Call Vertical","Short Put Vertical","Short Call Ratio 1x2","Short Put Ratio 1x2","Short Call Ratio 2x3","Short Put Ratio 2x3","Short Straddle","Short Strangle","Short Call Butterfly","Short Put Butterfly","Short Iron Butterfly","Short Call Condor","Short Put Condor","Short Iron Condor","Short Synthetic Stock","Short Collar","Short Vertical Spread Spread","Short Financed Vertical","Short Stock"]},this.nameStrategyMap={},this.strategyNameSentimentMap=function(e){var t={};for(var n in e){var r=e[n];r.forEach(function(e){t[e]=n})}return t}(this.sentimentStrategyNamesMap),this.sentimentStrategyMap={Bullish:[],Bearish:[],Neutral:[],"Sharp-Move":[],"All Strategies":[]}},i=new r;return i}),define("defaultModel",["komapping"],function(e){function t(t,n){n=n||{},this.updateModel=function(t){e.fromJS(t,n,this)},this.updateModel(t)}return t}),define("modules/localizer",["knockout","i18next","kendo-zh-CN"],function(e,t){function i(){var i=this,s="zh-CN";t.init({detectLngFromHeaders:!1,lng:s,fallbackLng:r,resGetPath:n+"__lng__.json",useCookie:!0,supportedLngs:["en-US","zh-CN"],load:"current"});var o=e.observable(s);this.activeLocale=e.computed(function(){var e=o();return e}),kendo.culture(s),this.setLocale=function(e){kendo.culture(e);var n=t.setLng(e).then(function(){o(e)});return n},this.localize=this.t=t.t,this.waitForLocaleChange=e.observable(),this.activeLocale.subscribe(function(){i.waitForLocaleChange.notifySubscribers()})}var n="Content/Localization/",r="zh-CN",s=new i;return s}),define("modules/notifications",["modules/localizer"],function(e){function t(){function r(){}var t="app.notifications.success",n="app.notifications.error",i={success:r,error:r,warning:r,info:r,show:r};this.setNotificationModule=function(e){i=e},this.success=function(n){if(!n){i.success(e.localize(t));return}i.success(n)},this.error=function(t){if(!t){i.error(e.localize(n));return}if(t.responseJSON&&t.responseJSON.message){i.error(t.responseJSON.message);return}i.error(t)},this.warning=function(){i.warning.apply(this,arguments)},this.info=function(e){i.info(e)},this.show=function(){i.show.apply(this,arguments)}}var n=new t;return n}),define("cacheStores",[],function(){var e=function(){var e={},t={has:function(t){return typeof e[t]!="undefined"},get:function(t){return e[t]},set:function(t,n){e[t]=n},kill:function(t){delete e[t]}};return t},t=function(){var t="CacheJS_LS",n={has:function(e){return localStorage[t+e]!=null},get:function(e){return n.has(e)?JSON.parse(localStorage[t+e]):undefined},set:function(e,r){r===undefined?n.kill(e):localStorage[t+e]=JSON.stringify(r)},kill:function(e){localStorage.removeItem(t+e)}};return window.localStorage?n:e()},n={objectStore:e,localStorageStore:t};return n}),define("cache",["cacheStores"],function(e){function t(){function o(e,t){if(n.has(e)){var i=n.get(e);return typeof i[t]!="undefined"?i[t]:r}return r}function u(e){return e?e=new Date(e):e=!1,e}var t={setStore:function(e){return typeof e=="function"?(e=e(),e.get&&e.set&&e.kill&&e.has?(n=e,!0):!1):!1},has:function(e){return n.has(e)},kill:function(e){return n.kill(e),n.has(e)},getExpiry:function(e){var t=o(e,s);return t!=0&&t!=null&&(t=new Date(t)),t},setExpiry:function(e,i){if(n.has(e)){var o=n.get(e);return o[s]=u(i),n.set(e,o),t.getExpiry(e)}return r},get:function(e){return o(e,i)},expired:function(e){if(n.has(e)){var t=n.get(e),r=new Date;return t[s]&&Date.parse(t[s])<=r?!0:typeof t[i]!="undefined"?!1:!0}return!0},set:function(e,r,o){var a;return n.has(e)?(a=n.get(e),typeof o!="undefined"&&(a[s]=u(o))):(a=Array(),a[s]=u(o),n.set(e,a)),a[i]=r,n.set(e,a),t.get(e)}},n=e.objectStore(),r=null,i=0,s=1;return t}return t}),define("dataServices/dataServiceBase",["jquery","knockout","komapping","modules/notifications","cache","modules/localizer"],function(e,t,n,r,i,s){function o(o,u,a,f){function p(){var t=[];for(var n in c.subscriptions)if(l.expired(n)&&c.getValueFromCache(n)!=null&&!c.pullings[n]){var r=c.subscriptions[n];c.pullings[n]=!0,t.push(c.get.apply(c,r).always(function(){c.pullings[n]=!1}))}e.when.apply(c,t).always(function(){setTimeout(p,2e3)})}var l=i(),c=this,h={};o.slice(-1)!=="/"&&(o+="/"),this.serviceApiPrefix=o,this.mappingOptions=f,this.ModelConstructor=u,this.ignoreArrayResults=!1,this.cacheExpiration=a,this.pullings={},this.subscriptions={},this.get=function(t){var n,r,i;t===undefined&&(t="");if(e.isPlainObject(t))n="",r=t||{},i=!!arguments[1];else if(t=="historicalQuery"&&e.isArray(arguments[1]))n="",arguments[1].forEach(function(e){n+=e+"/"}),r={},i=!!arguments[2];else if(typeof t=="string")n=t,r=arguments[1]||{},i=!!arguments[2];else{if(!e.isArray(t))throw'Invalid arguments for "get" function';n="",r=t,i=!!arguments[1]}var s=c.generateCacheId(n,r);c.subscriptions[s]=arguments;var o=c.getValueFromCache(s);if(i||c.disconnected||l.expired(s)||o==null){var u=c.updateDate(n,r,s);if(i||o==null)return u}var a=new e.Deferred;return a.resolve(o),a.promise()},this.updateDate=function(t,n,r){function s(){delete h[r]}if(h.hasOwnProperty(r))return h[r];var i=e.get(c.serviceApiPrefix+t,n).then(c.getResultHandler(r),c.errorHandler);return h[r]=i,i.then(s,s),i},this.post=function(t,n){return e.post(c.serviceApiPrefix+t,n).then(null,c.errorHandler)},this.getValueFromCache=function(e){var t=l.get(e);return t},this.getResultHandler=function(r){function i(i){var s,o=c.getValueFromCache(r);if(typeof r!="undefined"){if(!c.ignoreArrayResults&&e.isArray(i))if(o==null)s=i.map(function(e){return c.createModel(e)}),s=t.observableArray(s);else{if(!c.mappingOptions||!c.mappingOptions.autoUpdate)i=i.map(function(e){return c.createModel(e)});s=n.fromJS(i,c.mappingOptions,o)}else o==null||typeof o.updateModel!="function"?s=c.createModel(i,o):(o.updateModel(i,o),s=o);return c.storeModelInCache(r,s),s}return o}return i},this.storeModelInCache=function(e,t){if(this.cacheExpiration<0)return;l.set(e,t,c.makeCacheExpiryDate())},this.makeCacheExpiryDate=function(){if(this.cacheExpiration==null||this.cacheExpiration===0)return undefined;var e=new Date;return this.cacheExpiration<0?e.setTime(e.getTime()-1):e.setTime(e.getTime()+1e3*this.cacheExpiration),e},this.createModel=function(e,t){return e==null||c.ModelConstructor==null?e:new c.ModelConstructor(e,c.mappingOptions,t)},this.errorHandler=function(e){return e.responseJSON?r.error(e.responseJSON.message):r.error(s.localize("app.common.systemError")),e},this.clearCache=function(e){e==null?l=i():l.kill(e)},this.generateCacheId=function(e,t){var n=c.serviceApiPrefix+e;return t?(n+=JSON.stringify(t),n):n},(!isNaN(a)||a>0)&&p()}return o}),define("events",["durandal/events"],function(e){var t={SIGNED_IN:"app:signed_in",SIGNED_OUT:"app:signed_out",PACE_DONE:"app:pace_done",ROUTE_ACTIVATING:"router:route:activating"};return t.Bottom={IS_SHOWN:"bottom:is_shown",INTRADAY_REFRESH:"bottom:intraday_refresh",INTRADAY_REFRESHED:"bottom:intraday_refreshed",HIST_ORDERS_TRADES_STRIKES:"bottom:hist_orders_trades_strikes",INTRADAY_EXERCISES_REFRESH:"bottom:intraday_exercises_refreshed"},t.Portfolio={REFRESH:"portfolio:refresh",LOCK_UNLOCK_SHARES:"portfolio:lockUnlock",HISTORICAL_INQUIRY:"portfolio:historicalInquiry"},t.OrderEntry={PREFILL_ORDER:"orderEntry:prefill_order",EXERCISE:"orderEntry:exercise"},t.Funnel={GO_TO_BOTTOM:"funnel:goToBottom",UL_CHANGED:"funnel:underlyingChanged"},t.Quotes={CHANGE_DETAILS:"quotes:detailsChanged"},t.How={TOGGLE_SENTIMENT:"how: toggleSentiment"},e.includeIn(t),t}),define("modules/session",["knockout"],function(e){function n(t,n){for(var r=0,i=t.length,s=[];r<i;r++){var o=t[r].cloneNode(!0);s.push(n?e.cleanNode(o):o)}return s}var t={};return t.isAuthenticated=e.observable(!1),t.userName=e.observable(),t.accountNumber=e.observable(),t.accountId=e.observable(),t.role=e.observable(),t.permissions=e.observableArray(),t.hasPermission=function(e){var n=t.permissions();return t.isAuthenticated()&&n&&n.indexOf(e)!==-1?!0:!1},t.setSecurityModel=function(e){e==null?(t.isAuthenticated(!1),t.userName(null),t.accountNumber(null),t.accountId(null),t.role(null),t.permissions(null)):(t.userName(e.userName),t.accountNumber(e.accountNumber),t.accountId(e.accountId),t.role(e.role),t.permissions(e.permissions),t.isAuthenticated(!0))},e.bindingHandlers.ifHasPermissions={init:function(r,i,s,o,u){var a,f;return e.computed(function(){var s=e.utils.unwrapObservable(i()),o=t.hasPermission(s),l=!f,c=l||o!==a;c&&(l&&e.computedContext.getDependenciesCount()&&(f=n(e.virtualElements.childNodes(r),!0)),o?(l||e.virtualElements.setDomNodeChildren(r,n(f)),e.applyBindingsToDescendants(u,r)):e.virtualElements.emptyNode(r),a=o)},null,{disposeWhenNodeIsRemoved:r}),{controlsDescendantBindings:!0}}},e.expressionRewriting.bindingRewriteValidators.ifHasPermissions=!1,e.virtualElements.allowedBindings.ifHasPermissions=!0,t}),define("dataServices/authenticationService",["jquery","knockout","events","modules/session","modules/notifications","dataServices/dataServiceBase"],function(e,t,n,r,i,s){function o(){var e=this;s.call(e,"api/authentication"),this.signIn=function(t){var i=e.post("signIn",t).then(function(e){return r.setSecurityModel(e),n.trigger(n.SIGNED_IN,e),e}).fail(function(){r.setSecurityModel(null)});return i},this.signOut=function(){var t=e.post("logOut").then(function(e){return r.setSecurityModel(null),n.trigger(n.SIGNED_OUT,e),e});return t},this.getSecurityModel=function(){return e.get("securityModel").then(function(e){return r.setSecurityModel(e),e})}}return o}),define("dataServices/configurationService",["jquery","knockout","dataServices/dataServiceBase"],function(e,t,n){function r(){var e=this;n.call(e,"api/configurations"),e.getClientConfiguration=function(){var t=e.get("clientConfiguration");return t}}return r}),define("hostResolver",[],function(){var e={},t=null;return e.host=function(){if(t===null){var e=location.protocol,n=e.concat("//"),r;t=n.concat(window.location.hostname),window.location.hostname==="localhost"?(r=window.location.pathname.split("/"),r.length>2&&(t=t+"/"+r[1])):(r=window.location.pathname.split("/"),r.length>2&&(t=t+"/"+r[1]))}return t}(),e.buildUrl=function(t){var n=e.host+"/"+t;return n},e}),define("dataServices/socketConnection",["jquery","hostResolver","durandal/events","jquery-signalr"],function(e,t,n){function i(i,s,o){if(typeof r[i]!="undefined"){var u=r[i];return e.extend(u,s),u.connectHubEvents(s),u.initHubEventHandlers(o),u}r[i]=this,s!=null&&e.extend(this,s),n.includeIn(this);var a=this,f=e.Deferred(),l=e.hubConnection(t.host+"/signalr",{useDefaultPath:!1});return a.isConnected=!1,l.disconnected(function(){a.isConnected&&(f=e.Deferred(),a.isConnected=!1),console.log(i+" connection disconnected "+l.id),setTimeout(a.connect,1e4)}),this.connect=function(){return a.isConnected?f:(l.start().fail(function(e){console.log(i+" connection failed"),f.fail(e)}).done(function(){a.isConnected=!0,console.log(i+" connected "+l.id),f.resolve()}),f.promise())},this.getEventProxy=function(e){var t=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift(e),a.trigger.apply(a,t)};return t},this.connectHubEvents=function(e){for(var t in e){if(!e.hasOwnProperty(t))continue;var n=e[t];a.hubProxy.on(n,a.getEventProxy(n))}},this.initHubEventHandlers=function(e){for(var t in e){if(!a.hasOwnProperty(t)||!e.hasOwnProperty(t))continue;var n=a[t];a.hubProxy.on(n,e[t])}},this.hubProxy=l.createHubProxy(i),this.invokeAction=function(t,n){var r=e.Deferred();return this.connect().then(function(){var s=[t];e.isArray(n)?e.merge(s,n):e.isPlainObject(n)||s.push(n),a.hubProxy.invoke.apply(a.hubProxy,s).then(function(e){r.resolve(e)}).fail(function(e){console.log("Request to hub: "+i+" action: "+t+" failed"),console.log(e),r.reject(e)})}),r.promise()},this.connectHubEvents(s),this.initHubEventHandlers(o),this}var r={};return i}),define("dataServices/signalrDataService",["jquery","dataServices/socketConnection","dataServices/dataServiceBase","jquery-signalr"],function(e,t,n){function r(e,r,i,s,o){var u=e.HubName,a=e.HubAction,f=e.HubEvents,l=e.HubEventHandlers,c=e.UpdateEvent,h=new n(u,r,i,s,o);return h.connection=new t(u,f,l),h.queriesInProggress={},h.updateHandler=null,h.disconnected=!0,h.updateDate=function(t,n,r){function o(){delete h.queriesInProggress[r]}if(h.queriesInProggress.hasOwnProperty(r))return h.queriesInProggress[r];typeof t!="undefined"&&t!=""&&(n=t);var i=h.getResultHandler(r),s=h.connection.invokeAction(a,n).then(i,h.errorHandler);return h.queriesInProggress[r]=s,h.disconnected=!1,s.always(o),e.hasOwnProperty("UpdateEvent")&&h.updateHandler==null&&(h.updateHandler=e.UpdateHandler||i,h.connection.on(c,h.updateHandler)),s},h.connection.hubProxy.connection.disconnected(function(){h.disconnected=!0}),h.generateCacheId=function(e,t){var n=u+"|"+a+"|"+e+JSON.stringify(t);return n},h}return r}),define("modules/formatting",["kendo"],function(){function c(e){return e=e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),e}function h(e){var t=parseInt(e);return t=c(t),t}function p(e,t){t==null&&(t=2);var n=w(e,t).toFixed(t);return n=c(n),n}function d(e){var t=e<0?"–":"",n=t+r+h(Math.abs(e));return n}function v(e,t){var n=e<0?"–":"",i=n+r+p(Math.abs(e),t);return i}function m(e,t,n){var r="";t&&(e>0?r="+":e<0?r="–":r="");var i=r+p(Math.abs(e),n);return i}function g(e,t,n){var r=m(e,t,n)+"%";return r}function y(e,t,n){var r=g(e*100,t,n);return r}function b(e){var t=1e9,n=1e6,r="亿",i="万",s,o;return e>=t?(o=w(e/t*10,1),o=o,s=o+r):e>=n?(o=w(e/n*100,1),o=o,s=o+i):s=e,s}function w(e,t){t==null&&(t=2);var n=Math.pow(10,t),r=Math.round(e*n)/n;return r}function E(e){e=w(e,0);while(e>999)e=w(e/1e3,0);return e==8||e==11||e==18||e>=80&&e<90?"an":"a"}function S(e,t){var n=kendo.toString(e,t||u);return n}function x(e,t){return kendo.parseDate(e,t||a)}function T(e){var t=5-e.getDay(),n=new Date;n.setDate(e.getDate()+t);var r=n.getDate(),i=Math.ceil(r/7);return i}function N(e,t){var n=S(e,t),r=T(e),i="";return r!==3&&r>=1&&r<=5&&(i=r.toString()),n+i}function C(e){return e==null||typeof e.getMonth!="function"?null:new Date(e.getFullYear(),e.getMonth(),e.getDate())}function k(e,t){var n=C(e)-C(t);return n}function L(e,t){var n=k(e,t)===0;return n}function A(e,t,n){var r=e-t;return Math.abs(r)<=n}function O(e){var t=e.charAt(0).toUpperCase()+e.slice(1);return t}function M(t,n){var r,i=n.type,s=n.signed||!1,o=n.dateFormat||"MMM dd yyyy",u=n.decimalPlace;typeof n=="string"&&(i=n);if(t==null)return e;switch(i){case"currency":r=v(t,u);break;case"percentage":r=g(t,s,u);break;case"percentage100":r=y(t,s,u);break;case"volume":r=b(t);break;case"date":r=S(t,o);break;case"fraction":r=p(t);break;default:typeof t=="number"&&t.toFixed(19)==0&&(t=0),r=l(t,i)}return r}function _(e){if(!e)return 0;var t=(new Date).getTime(),n=new Date(e.getTime());n.setHours(16),n.setMinutes(0),n.getDay()==6&&n.setTime(n.getTime()-864e5);var r=e.getTime()-t,i=r/1e3/3600/24;return i=i>0?Math.ceil(i):Math.floor(i),i}var e="N/A",t="# #",n="# #.00",r="¥",i=r+t,s="#,#.00\\%",o="+"+s+";-"+s+";0\\%",u="d",a="yyyy-MM-ddTHH:mm:ss",f="+08:00",l=kendo.toString,D={toIntString:h,toFractionalString:p,toIntCurrency:d,toFractionalCurrency:v,toPercentage:g,toPercentage100:y,aOrAn:E,toFormattedVolume:b,roundNumber:w,formatDate:S,customFormat:M,parseDate:x,CHINA_TIME_ZONE:f,daysFromNow:_,formatDateWithWeekNumber:N,sameDate:L,compareDates:k,closeTo:A,capitaliseFirstLetter:O,toSignedFractionalString:m};return D}),define("optionChainsModel",["komapping","modules/formatting"],function(e,t){function n(r,i,s){function l(e,n){typeof n!="string"&&(n=t.formatDate(n,o));var r=e+"|"+n;return r}var o="yyyyMMdd",u=this,a=["bid","bidVolume","ask","askVolume","volume","bid2","bidVolume2","ask2","askVolume2","bid3","bidVolume3","ask3","askVolume3","bid4","bidVolume4","ask4","askVolume4","bid5","bidVolume5","ask5","askVolume5","greeks.gamma","greeks.delta","greeks.vega","greeks.theta","greeks.rho","greeks.sigma","greeks.rhoFx","change","changePercentage","uncoveredPositionQuantity","auctionReferencePrice","auctionReferenceQuantity","highestPrice","lowestPrice","latestTradedPrice","previousClose","turnover","openingPrice","previousSettlementPrice"],f=a.map(function(e){return"callOption."+e}).concat(a.map(function(e){return"putOption."+e}));return this.rows=[],this.allRows=[],this.expiryStrikes={},this.optionsDictionary={},this.defaultMultiplier=1e3,this.flattenOptions={},this.multipliers=[],this.multipleChains={},this.hasMultiOptionUnit=!1,this.expirySelectOptions=[],this.updateOptions=function(t){t.forEach(function(t,n){u.flattenOptions.hasOwnProperty(t.optionNumber)&&e.fromJS(t,{ignore:["openInterest","optionCode"]},u.flattenOptions[t.optionNumber])})},this.updateModel=function(r,i){if(u.rows.length>0||typeof i!="undefined"&&i)return i=i||u,r.chains.forEach(function(t){e.fromJS(t,{observe:f},i.flattenOptions[t.optionNumber])}),i;u.strikePrices=r.strikePrices,u.expirationDates=r.expirationDates.map(function(e){var n=new Date(e.date+t.CHINA_TIME_ZONE);return{date:n,noOfDaysToExpiry:Math.floor(e.totalNumberOfDaysUntilExpiry),daysToExpiry:e.totalNumberOfDaysUntilExpiry,expiryKey:t.formatDate(n,o)}}),u.expiryStrikes={},u.expirySelectOptions=u.expirationDates.map(function(e){return{date:e.date,expiryStr:t.formatDate(e.date,"yyyy-MM-dd"),dateOnSelector:t.formatDate(e.date,"MMM dd yyyy")+" ("+t.daysFromNow(e.date)+")"}});var s={},a={},c=!1,h=!0;for(var p=0;p<r.chains.length;p++){var d=r.chains[p];s.hasOwnProperty(d.premiumMultiplier)||(s[d.premiumMultiplier]=[],a[d.premiumMultiplier]=[],h?h=!h:c=!0);var v=e.fromJS(d,{observe:f});v.noOfDaysToExpiry=v.expiry.totalNumberOfDaysUntilExpiry,v.expiryDate=new Date(v.expiry.date+t.CHINA_TIME_ZONE);var m=v.expiryKey=t.formatDate(v.expiryDate,o),g=v.strikePrice;u.optionsDictionary[l(g,v.expiryKey)]=v,u.flattenOptions[v.callOption.optionNumber]=v.callOption,u.flattenOptions[v.putOption.optionNumber]=v.putOption,u.defaultMultiplier=v.premiumMultiplier%1e3?u.defaultMultiplier:v.premiumMultiplier,v.premiumMultiplier%1e3||(u.expiryStrikes.hasOwnProperty(m)||(u.expiryStrikes[m]=[]),u.expiryStrikes[m].indexOf(g)<0&&u.expiryStrikes[m].push(g),u.rows.push(v)),u.allRows.push(v),s[d.premiumMultiplier].push(v),a[d.premiumMultiplier].push(d)}return c?(u.hasMultiOptionUnit=!0,$.each(a,function(e,t){u.multipliers.push(parseInt(e)),u.multipleChains[e]=new n({chains:t,strikePrices:r.strikePrices,expirationDates:r.expirationDates}),u.multipleChains[e].rows=s[e]})):u.multipliers.push(u.defaultMultiplier),u},this.findOption=function(e){return u.flattenOptions[e]},this.findRow=function(e,t){var n,r,i=null;if(arguments.length==1){n=e,u.rows.some(function(e){return e.callOption.optionNumber==n||e.putOption.optionNumber==n?(i=e,!0):!1});if(u.multipliers.length>1&&i===null)for(var s in u.multipleChains)i=u.multipleChains[s].findRow(n)||i}else r=e,i=u.optionsDictionary[l(r,t)];return i},this.findStrike=function(e,t,n){var r=u.findExpiry(t,0,0),i=u.expiryStrikes[r.expiryKey],s=0;for(;s<i.length;s++){var o=i[s];if(e<=o)break}return n=n?n:0,s+n<0?i[0]:s+n<i.length?i[s+n]:i[i.length-1]},this.findExpiry=function(e,t,n){n=n||0,t=t||1;var r=u.expirationDates,i=0;for(;i<r.length;i++)if(r[i].date.valueOf()-e.valueOf()>(n-1)*24*36e5)break;var s=i+t-1;return s<0?r[0]:s>=r.length?r[r.length-1]:r[i+t-1]},this.strikeListExpiry=function(e){typeof e!="string"&&(e=t.formatDate(e,o));var n=u.expiryStrikes[e];return n},this.impliedVolatility=function(n){n=u.findExpiry(n,0,0),n=n&&n.date;var r=u.findStrike(u.last,n,-1),i=u.findStrike(u.last,n,1),s=u.findRow(r,n),o=u.findRow(i,n),a=(s.putOption.greeks.sigma()+o.callOption.greeks.sigma())/2*100;return t.roundNumber(a)},this.updateModel(r,s)}return n}),define("portfolioItemModel",["knockout","komapping","modules/enums","modules/localizer"],function(e,t,n){function r(r,i){var s=this;i=i||{},this.updateModel=function(e){t.fromJS(e,{},s)},t.fromJS(r,{},this),this.alertVisible=e.computed(function(){return!0}),this.optionTypeEnum=e.computed(function(){switch(s.optionType()){case"C":return s.isCovered()?n.COVERED:n.CALL;case"P":return n.PUT;case"S":return n.SECURITY;default:return null}}),this.optionTypeStyle=e.computed(function(){switch(s.optionType()){case"C":return{color:s.isCovered()?"gold":"red"};case"P":return{color:"green"};case"S":return{color:"blue"};default:return null}}),this.optionSideEnum=e.computed(function(){switch(s.optionSide()){case"L":return n.BUY;case"S":return n.SELL;case"C":return n.SELL;default:return null}}),this.expanded=e.observable(!0),this.collapsed=e.computed(function(){return!s.expanded()})}return r}),define("portfolioItemGroupModel",["knockout","komapping","portfolioItemModel","modules/enums","modules/localizer"],function(e,t,n,r){function i(r,i){var s=this;i={};var o={key:function(t){return e.unwrap(t.underlyingCode)+"|"+e.unwrap(t.isStockGroup)},items:{key:function(t){return e.unwrap(t.optionNumber)+"|"+e.unwrap(t.optionSide)},update:function(e){return e.target?(typeof e.target.updateModel=="function"&&e.target.updateModel(e.data),e.target):new n(e.data)}}};this.initModel=function(e){t.fromJS(e,o,this)},this.updateModel=function(e,n,r){s.items&&(e.isStockGroup?s.id(e.id):(s.anyExpiresInTwoDaysNotToday(e.anyExpiresInTwoDaysNotToday),s.closeVisible(e.closeVisible),s.strategyName(e.strategyName),s.strategy(e.strategy),s.quantity(e.quantity),s.quantityFormatted(e.quantityFormatted),s.realtimeCostBasis(e.realtimeCostBasis),s.mark(e.mark),s.floatingPL(e.floatingPL),s.margin(e.margin),s.marketValue(e.marketValue),s.generatePremiumVisible(e.generatePremiumVisible),s.id(e.id),s.greeks.gamma(e.greeks.gamma),s.greeks.delta(e.greeks.delta),s.greeks.theta(e.greeks.theta),s.greeks.vega(e.greeks.vega),s.greeks.rho(e.greeks.rho),s.greeks.rhoFx(e.greeks.rhoFx),s.greeks.sigma(e.greeks.sigma),s.isStockGroup(e.isStockGroup)),t.fromJS(e.items,o.items,s.items))},this.initModel(r),this.expanded=e.observable(!0),this.collapsed=e.computed(function(){return!s.expanded()})}return i}),define("standardDeviationModel",["knockout","komapping","modules/formatting"],function(e,t,n){function r(e){var t="yyyyMMdd",r=this;this.stdDevs=[],this.stdDevsMap={},this.updateModel=function(e){r.stdDevs=e.map(function(e){var i=new Date(e.dateAndNumberOfDaysUntil.date+n.CHINA_TIME_ZONE);e.dateAndNumberOfDaysUntil.date=i,e.dateAndNumberOfDaysUntil.noOfDaysToExpiry=Math.floor(e.dateAndNumberOfDaysUntil.totalNumberOfDaysUntilExpiry);var s=n.formatDate(i,t);return e.dateAndNumberOfDaysUntil.expiryKey=s,r.stdDevsMap[s]=e,e})},this.getStdDevsByExpiry=function(e){var i=n.formatDate(e,t);return r.stdDevsMap[i]},this.getStdDevsByNoOfDays=function(e){e=parseInt(e);var t=null;return r.stdDevs.some(function(n){return Math.abs(n.dateAndNumberOfDaysUntil.totalNumberOfDaysUntilExpiry-e)<=2?(t=n,!0):!1}),t},this.updateModel(e)}return r}),define("predictionsModel",["knockout"],function(e){function r(e,t){var n=0,r=0;for(var i=0;i<e.probabilities.length;i++){var s=e.probabilities[i],o=e.prices[i];s>1e-4&&(t.probs.push(s),t.prices.push(o),i&&s>r&&(r=s,n=t.probs.length-1))}t.midIndex=n,t.ready(!0)}var t=function(t,n,i){var s=this;s.symbol=t,s.days=n,s.probs=[],s.prices=[],s.ready=e.observable(!1),s.midIndex=501,s.price=function(t){if(!t||!s.probs.length||t<s.probs[0])return 0;var n=0,r=s.probs.length-1,i=Math.floor(r/2);while(i!==n||i!==r){var o=i<=s.midIndex?s.prices[i]:1-s.prices[i],u=s.probs[i];if(u.toFixed(2)==t.toFixed(2))return o;if(i===n||i===r){var a=s.probs[i-1],f=i-1<=s.midIndex?s.prices[i-1]:1-s.prices[i-1];i===n&&(a=s.probs[i+1],f=i+1<=s.midIndex?s.prices[i+1]:1-s.prices[i+1]);var l=(t-a)*(o-f)/(u-a)+f;return l}u>t?r=i:n=i,i=Math.floor((n+r)/2)}return 1},s.prob=function(t){if(!t||!s.prices.length||t<s.prices[0])return 0;var n=0,r=s.prices.length-1,i=Math.floor(r/2);while(i!==n||i!==r){var o=i<=s.midIndex?s.probs[i]:1-s.probs[i],u=s.prices[i];if(u.toFixed(2)==t.toFixed(2))return o;if(i===n||i===r){var a=s.prices[i-1],f=i-1<=s.midIndex?s.probs[i-1]:1-s.probs[i-1];i===n&&(a=s.prices[i+1],f=i+1<=s.midIndex?s.probs[i+1]:1-s.probs[i+1]);var l=(t-a)*(o-f)/(u-a)+f;return l}u>t?r=i:n=i,i=Math.floor((n+r)/2)}return 1},s.probBetween=function(e,t){return e==undefined?0:t==undefined?s.prob(e):s.prob(Math.max(e,t))-s.prob(Math.min(e,t))},s.getSymmetricPrice=function(e){var t=s.prob(e),n=1-t,r=s.prices[s.prices.length-1],i=s.prices[0],o=(i+r)/2;while(o.toFixed(3)!=i.toFixed(3)&&o.toFixed(3)!=r.toFixed(3)){var u=s.prob(o);if(u.toFixed(4)==n.toFixed(4))return o;u>n?r=o:i=o,o=(i+r)/2}return o},r(i,s)},n=function(e){var n=this;this.probs={},this.getProb=function(e){return n.probs[e.toString()]||n.probs[(e-1).toString()]||n.probs[(e+1).toString()]},$.each(e,function(e,r){var i=r.daysInFuture.toFixed(0),s=new t(n.symbol,i,r);n.probs[i]=s}),this.getSymmetricPrice=function(e,t){if(!n.probs)return 0;var r=n.getProb(t);return r?r.getSymmetricPrice(e):0}};return n}),define("modules/orderEnums",[],function(){var e=Object.freeze({BuyStockBizes:{400:!0,403:!0,405:!0},SellStockBizes:{401:!0,402:!0,404:!0},ExerciseStockBizes:{406:!0,407:!0},OpenStockBizes:{400:!0,402:!0,404:!0},CloseStockBizes:{401:!0,403:!0,405:!0,406:!0,407:!0},CoveredStockBizes:{404:!0,405:!0},OrderStatuses:{0:"trade.orderStatus.notOffered",1:"trade.orderStatus.offering",2:"trade.orderStatus.offered",3:"trade.orderStatus.toWithdraw",4:"trade.orderStatus.mathedToWithdraw",5:"trade.orderStatus.partialyToWithdraw",6:"trade.orderStatus.withdrawn",7:"trade.orderStatus.partialyWithdrawn",8:"trade.orderStatus.matched",9:"trade.orderStatus.discardedOrder",A:"trade.orderStatus.toOffer"},WithdrawableOrderStatuses:{0:!0,1:!0,2:!0,A:!0},StockBusinessDic:{400:"stockBizOptions.buyToOpen",401:"stockBizOptions.sellToClose",402:"stockBizOptions.sellToOpen",403:"stockBizOptions.buyToClose",404:"stockBizOptions.openCoveredCall",405:"stockBizOptions.closeCoveredCall",406:"stockBizOptions.exerciseCall",407:"stockBizOptions.exercisePut",408:"stockBizOptions.lockSecurity",409:"stockBizOptions.unlockSecurity"},OrderTypeDic:{130:"orderTypeOptions.limitGFD",131:"orderTypeOptions.limitFOK",132:"orderTypeOptions.marketToLimitGFD",133:"orderTypeOptions.marketFOK",134:"orderTypeOptions.marketIOC",100:"orderTypeOptions.submitOrder",101:"orderTypeOptions.withdraw"},OrderTypes:{SUBMIT_ORDER:"100",LIMIT_GFD:"130",LIMIT_FOK:"131",MARKET_LEFT_LIMIT:"132",MARKET_FOK:"133",MARKET_IOC:"134",CANCEL_ORDER:"101"},StockBusinesses:{EXERCISE_CALL:"406",EXERCISE_PUT:"407"}});return e}),define("models/intradayTradeModel",["knockout","modules/orderEnums","modules/formatting"],function(e,t,n){function r(r){var i=this;this.updateModel=function(s){var o=s.matchedTime,u=s.tradeDate,a=s.optionNumber,f=s.optionName,l=s.optionCode,c=s.matchedPrice,h=s.matchedQuantity,p=s.orderPrice,d=s.matchedAmount,v=s.orderId,m=s.matchedSerialNo,g=s.stockBusiness,y=s.stockBusinessAction;i.tradeDate(u.constructor==Date?u:new Date(u+n.CHINA_TIME_ZONE)),i.matchedTime(o.constructor==Date?o:new Date(o+n.CHINA_TIME_ZONE)),i.orderId=e.observable(v),i.optionNumber(a&&a.trim()),i.optionName(f&&f.trim()),i.optionCode(l),i.optionType(l.indexOf("C")>=0?"trade.call":l.indexOf("P")>=0?"trade.put":"trade.unknown"),i.buyOrSell(r.isWithdraw?"trade.withdraw":g in t.BuyStockBizes?"trade.buy":g in t.SellStockBizes?"trade.sell":"trade.unknown"),i.optionSide(g in t.BuyStockBizes?"L":g in t.SellStockBizes?"S":"U"),g in t.OpenStockBizes?i.openOrClose("trade.open"):g in t.CloseStockBizes?i.openOrClose("trade.close"):g=="408"?i.openOrClose("trade.stockBizOptions.lockSecurity"):g=="409"?i.openOrClose("trade.stockBizOptions.unlockSecurity"):i.openOrClose("trade.unknown"),i.stockBusiness(t.StockBusinessDic[g]),i.orderType(t.OrderTypeDic[y]),i.orderPrice(p),i.matchedPrice(c),i.matchedQuantity(h),i.matchedAmount(d),i.isCovered(g in t.CoveredStockBizes),i.matchedSerialNo(m),i.offerReturnMessage(s.offerReturnMessage)},this.tradeDate=e.observable(),this.matchedTime=e.observable(),this.orderId=e.observable(),this.optionNumber=e.observable(),this.optionName=e.observable(),this.optionCode=e.observable(),this.optionType=e.observable(),this.buyOrSell=e.observable(),this.optionSide=e.observable(),this.openOrClose=e.observable(),this.stockBusiness=e.observable(),this.orderType=e.observable(),this.orderPrice=e.observable(),this.matchedPrice=e.observable(),this.matchedQuantity=e.observable(),this.matchedAmount=e.observable(),this.isCovered=e.observable(),this.matchedSerialNo=e.observable(),this.offerReturnMessage=e.observable(),this.updateModel(r)}return r}),define("models/intradayOrderModel",["knockout","modules/orderEnums","modules/formatting"],function(e,t,n){function r(r){var i=this;this.updateModel=function(s){var o=s.orderTime,u=s.orderDate,a=s.orderId,f=s.optionNumber&&s.optionNumber.trim(),l=s.optionName&&s.optionName.trim(),c=s.optionCode,h=s.optionUnderlyingCode&&s.optionUnderlyingCode.trim(),p=s.optionUnderlyingName&&s.optionUnderlyingName.trim(),d=s.matchedQuantity,v=s.orderQuantity,m=s.orderPrice,g=s.underlyingFrozenQuantity,y=s.offerReturnMessage,b=s.stockBusiness,w=s.stockBusinessAction,E=s.orderStatus;i.orderDate(u.constructor==Date?u:new Date(u+n.CHINA_TIME_ZONE)),i.orderTime(o.constructor==Date?o:new Date(o+n.CHINA_TIME_ZONE)),i.orderId=e.observable(a),i.optionNumber(f||h),i.optionName(l||p),i.optionCode(c),i.optionType(c.indexOf("C")>=0?"trade.call":c.indexOf("P")>=0?"trade.put":"trade.unknown"),i.buyOrSell(r.isWithdraw?"trade.withdraw":b in t.BuyStockBizes?"trade.buy":b in t.SellStockBizes?"trade.sell":b=="408"?"trade.stockBizOptions.lockSecurity":b=="409"?"trade.stockBizOptions.unlockSecurity":b=="406"?"trade.close":b=="407"?"trade.close":"trade.unknown"),i.optionSide(b in t.BuyStockBizes?"L":b in t.SellStockBizes?"S":"U"),b in t.OpenStockBizes?i.openOrClose("trade.open"):b in t.CloseStockBizes?i.openOrClose("trade.close"):b=="408"?i.openOrClose("trade.stockBizOptions.lockSecurity"):b=="409"?i.openOrClose("trade.stockBizOptions.unlockSecurity"):i.openOrClose("trade.unknown"),i.stockBusiness(t.StockBusinessDic[b]),i.orderType(t.OrderTypeDic[w]),i.orderPrice(m),i.orderQuantity(v||g),i.matchedQuantity(d),i.orderStatusValue(E),i.orderStatus(t.OrderStatuses[E]),i.isCovered(g>0),i.comments(y),i.isWithdraw(s.isWithdraw),i.lastRefresh(new Date)},this.orderDate=e.observable(),this.orderTime=e.observable(),this.orderId=e.observable(),this.optionNumber=e.observable(),this.optionName=e.observable(),this.optionCode=e.observable(),this.optionType=e.observable(),this.buyOrSell=e.observable(),this.optionSide=e.observable(),this.openOrClose=e.observable(),this.stockBusiness=e.observable(),this.orderType=e.observable(),this.orderPrice=e.observable(),this.orderQuantity=e.observable(),this.matchedQuantity=e.observable(),this.orderStatusValue=e.observable(),this.orderStatus=e.observable(),this.isCovered=e.observable(),this.comments=e.observable(),this.isWithdraw=e.observable(),this.lastRefresh=e.observable(),this.updateModel(r)}return r}),define("models/historicalTradeModel",["knockout","modules/orderEnums","modules/formatting"],function(e,t,n){function r(r){var i=this;this.updateModel=function(s){var o=s.matchedTime,u=s.tradeDate,a=s.optionNumber,f=s.optionName,l=s.optionCode,c=s.matchedPrice,h=s.matchedQuantity,p=s.orderPrice,d=s.matchedAmount,v=s.orderId,m=s.matchedSerialNo,g=s.stockBusiness,y=s.stockBusinessAction;i.tradeDate(u.constructor==Date?u:new Date(u+n.CHINA_TIME_ZONE)),i.matchedTime(o.constructor==Date?o:new Date(o+n.CHINA_TIME_ZONE)),i.orderId=e.observable(v),i.optionNumber(a&&a.trim()),i.optionName(f&&f.trim()),i.optionCode(l),i.buyOrSell(r.isWithdraw?"trade.withdraw":g in t.BuyStockBizes?"trade.buy":g in t.SellStockBizes?"trade.sell":"trade.unknown"),i.optionSide(g in t.BuyStockBizes?"L":g in t.SellStockBizes?"S":"U"),g in t.OpenStockBizes?i.openOrClose("trade.open"):g in t.CloseStockBizes?i.openOrClose("trade.close"):g=="408"?i.openOrClose("trade.stockBizOptions.lockSecurity"):g=="409"?i.openOrClose("trade.stockBizOptions.unlockSecurity"):i.openOrClose("trade.unknown"),i.stockBusiness(t.StockBusinessDic[g]),i.orderType(t.OrderTypeDic[y]),i.orderPrice(p),i.matchedPrice(c),i.matchedQuantity(h),i.matchedAmount(d),i.isCovered(g in t.CoveredStockBizes),i.matchedSerialNo(m),i.lastRefresh(new Date)},this.tradeDate=e.observable(),this.matchedTime=e.observable(),this.orderId=e.observable(),this.optionNumber=e.observable(),this.optionName=e.observable(),this.optionCode=e.observable(),this.optionType=e.observable(),this.buyOrSell=e.observable(),this.optionSide=e.observable(),this.openOrClose=e.observable(),this.stockBusiness=e.observable(),this.orderType=e.observable(),this.orderPrice=e.observable(),this.matchedPrice=e.observable(),this.matchedQuantity=e.observable(),this.matchedAmount=e.observable(),this.isCovered=e.observable(),this.matchedSerialNo=e.observable(),this.lastRefresh=e.observable(),this.updateModel(r)}return r}),define("models/historicalOrderModel",["knockout","modules/orderEnums","modules/formatting"],function(e,t,n){function r(r){var i=this;this.updateModel=function(s){var o=s.orderTime,u=s.orderDate,a=s.orderId,f=s.optionNumber&&s.optionNumber.trim(),l=s.optionName&&s.optionName.trim(),c=s.optionCode,h=s.optionUnderlyingCode&&s.optionUnderlyingCode.trim(),p=s.optionUnderlyingName&&s.optionUnderlyingName.trim(),d=s.matchedQuantity,v=s.orderQuantity,m=s.orderPrice,g=s.underlyingFrozenQuantity,y=s.offerReturnMessage,b=s.stockBusiness,w=s.stockBusinessAction,E=s.orderStatus;i.orderDate(u.constructor==Date?u:new Date(u+n.CHINA_TIME_ZONE)),i.orderTime(o.constructor==Date?o:new Date(o+n.CHINA_TIME_ZONE)),i.orderId=e.observable(a),i.optionNumber(f||h),i.optionName(l||p),i.optionCode(c),i.optionType(c.indexOf("C")>=0?"trade.call":c.indexOf("P")>=0?"trade.put":"trade.unknown"),i.buyOrSell(r.isWithdraw?"trade.withdraw":b in t.BuyStockBizes?"trade.buy":b in t.SellStockBizes?"trade.sell":"trade.unknown"),i.optionSide(b in t.BuyStockBizes?"L":b in t.SellStockBizes?"S":"U"),b in t.OpenStockBizes?i.openOrClose("trade.open"):b in t.CloseStockBizes?i.openOrClose("trade.close"):b=="408"?i.openOrClose("trade.stockBizOptions.lockSecurity"):b=="409"?i.openOrClose("trade.stockBizOptions.unlockSecurity"):i.openOrClose("trade.unknown"),i.stockBusiness(t.StockBusinessDic[b]),i.orderType(t.OrderTypeDic[w]),i.orderPrice(m),i.orderQuantity(v||g),i.matchedQuantity(d),i.orderStatusValue(E),i.orderStatus(t.OrderStatuses[E]),i.isCovered(g>0),i.comments(y),i.isWithdraw(s.isWithdraw)},this.orderDate=e.observable(),this.orderTime=e.observable(),this.orderId=e.observable(),this.optionNumber=e.observable(),this.optionName=e.observable(),this.optionCode=e.observable(),this.optionType=e.observable(),this.buyOrSell=e.observable(),this.optionSide=e.observable(),this.openOrClose=e.observable(),this.stockBusiness=e.observable(),this.orderType=e.observable(),this.orderPrice=e.observable(),this.orderQuantity=e.observable(),this.matchedQuantity=e.observable(),this.orderStatusValue=e.observable(),this.orderStatus=e.observable(),this.isCovered=e.observable(),this.comments=e.observable(),this.isWithdraw=e.observable(),this.updateModel(r)}return r}),define("models/historicalStrikeModel",["knockout","modules/orderEnums","modules/formatting"],function(e,t,n){function r(t){var r=this;this.updateModel=function(e){var t=new Date(e.occurDate.toString().replace(/^(\d{4})(\d{2})(\d{2})$/,"$1/$2/$3")),i=e.optionCode,s=e.optionNumber&&e.optionNumber.trim(),o=e.optionName&&e.optionName.trim(),u=e.optionType,a=e.optionUnderlyingCode,f=e.optionEffect,l=e.stockEffect,c=e.fundEffect,h=e.exercisePrice,p=e.exerciseSide;r.occurDate(t.constructor==Date?t:new Date(t+n.CHINA_TIME_ZONE)),r.optionCode(i),r.optionNumber(s),r.optionName(o),r.optionType(u.indexOf("C")>=0?"trade.call":u.indexOf("P")>=0?"trade.put":"trade.unknown"),r.optionUnderlyingCode(a),r.optionEffect(f),r.stockEffect(l),r.fundEffect(c),r.execPrice(h),r.execSide(p=="S"?"trade.execSides.S":"trade.execSides.B")},this.occurDate=e.observable(),this.optionCode=e.observable(),this.optionNumber=e.observable(),this.optionName=e.observable(),this.optionType=e.observable(),this.optionUnderlyingCode=e.observable(),this.optionEffect=e.observable(),this.stockEffect=e.observable(),this.fundEffect=e.observable(),this.execPrice=e.observable(),this.execSide=e.observable(),this.updateModel(t)}return r}),define("dataContext",["jquery","modules/context","modules/configurations","modules/strategyTemplates","defaultModel","dataServices/dataServiceBase","dataServices/authenticationService","dataServices/configurationService","dataServices/signalrDataService","optionChainsModel","portfolioItemGroupModel","portfolioItemModel","standardDeviationModel","predictionsModel","models/intradayTradeModel","models/intradayOrderModel","models/historicalTradeModel","models/historicalOrderModel","models/historicalStrikeModel"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){function w(e){return b.Controllers.ENTRY+e+"/"}var b={};b.Controllers=Object.freeze({ENTRY:"api/",AUTO_EXERCISE:"portfolio/autoExerciseData",LOCK_UNLOCK_SHARES:"order/shares",CONFIGURATION:"configuration",OPTION_CHAINS:"optionChains",QUOTATION:"quotation",STOCK_QUOTE_PER_MINUTE:"marketdata/stockQuotesPerMinute",OPTIONABLES:"optionables/quotes",PREDICTION:"prediction",STDDEVS:"prediction/stddevs",OPTION_BASIC:"marketdata/optionBaisc",OPTION_TRADING_INFO:"marketdata/getoptiontradinginfo",PORTFOLIO:"portfolio",STRATEGIES:"strategies",STRATEGYGROUPS:"strategygroups",ORDER:"order",INTRADAY_TRADES:"order/intradayTrades",INTRADAY_ORDERS:"order/intradayOrders",HISTORICAL_TRADES:"order/historicalTrades",HISTORICAL_ORDERS:"order/historicalOrders",HISTORICAL_STRIKES:"order/historicalExerciseDetail",TRADING_STRATEGIES:"suggestion/tradingStrategies",COVEREDCALL:"suggestion/coveredCall",FUND:"portfolio/fund",HISTORICALQUOTES:"marketdata/historicalQuotes",SIGNALS:"signals/supres",TECHNICALRANK:"signals/technicalRank",SENTIMENTS:"signals/sentiments",HISTORICALBANKTRANSFER:"portfolio/fundTransferHistory",BANKCODE:"portfolio/bankCode",BANKTRANSFER:"portfolio/bankTransfer",INDEXVALUE:"marketdata/getstockmarketindex",INTRADAY_EXERCISES:"order/intradayExercises"}),b.Hubs=Object.freeze({PORTFOLIO:{HubName:"PortfolioHub",HubAction:"subscribePortfolio",HubEvents:{UPDATE_PORTFOLIO:"updatePortfolio"},UpdateEvent:"updatePortfolio"},FUND:{HubName:"PortfolioHub",HubAction:"subscribeFund",HubEvents:{UPDATE_FUND:"updateFund"},UpdateEvent:"updateFund"},INTRADAY_ORDERS:{HubName:"PortfolioHub",HubAction:"subscribeIntradayOrders",HubEvents:{UPDATE_FUND:"updateIntradayOrders"},UpdateEvent:"updateIntradayOrders"},INTRADAY_TRADES:{HubName:"PortfolioHub",HubAction:"subscribeIntradayTrades",HubEvents:{UPDATE_FUND:"updateIntradayTrades"},UpdateEvent:"updateIntradayTrades"},OPTION_CHAINS:{HubName:"MarketDataHub",HubAction:"getOptionChains",HubEvents:{UPDATE_OPTION_CHAINS:"updateOptionChains",UPDATE_OPTION_QUOTES:"updateOptionQuotes"}},STOCK_QUOTE:{HubName:"MarketDataHub",HubAction:"getQuote",HubEvents:{UPDATE_QUOTES:"updateQuote"}},OPTIONABLE_QUOTES:{HubName:"MarketDataHub",HubAction:"getOptionableQuotes",HubEvents:{UPDATE_QUOTES:"updateOptionableQuotes"},UpdateEvent:"updateOptionableQuotes"}});var E={observe:[""]},S={key:function(e){return ko.unwrap(e.securityCode)||ko.unwrap(e.optionNumber)},copy:["stockExchange","tradeSector","securityCode","hasOptions","securityName","securityClass","underlyingSecurityCode"]},x={key:function(e){return ko.unwrap(e.underlyingCode)+"|"+ko.unwrap(e.isStockGroup)},update:function(e){return e.target?(e.target.updateModel(e.data),e.target):new l(e.data)},autoUpdate:!0},T={key:function(e){return ko.unwrap(e.orderId)+ko.unwrap(e.matchedSerialNo)},update:function(e){return e.target?(e.target.updateModel(e.data),e.target):new d(e.data)},autoUpdate:!0},N={key:function(e){return ko.unwrap(e.orderId)},update:function(e){return e.target?(e.target.updateModel(e.data),e.target):new v(e.data)},autoUpdate:!0},C=function(){var c=this,C=1,k=1;this.authentication=new o,this.optionTradingInfo=new s(w(b.Controllers.OPTION_TRADING_INFO),i),this.optionChains=new a(b.Hubs.OPTION_CHAINS,f,21600),this.optionBasic=new s(w(b.Controllers.OPTION_BASIC),null,21600),this.portfolio=new s(w(b.Controllers.PORTFOLIO),l,15,x),this.autoExerciseData=new s(w(b.Controllers.AUTO_EXERCISE),i),this.lockableUnlockableShares=new s(w(b.Controllers.LOCK_UNLOCK_SHARES),i),this.fund=new s(w(b.Controllers.FUND),i),this.strategies=new s(w(b.Controllers.STRATEGIES)),this.strategyGroups=new s(w(b.Controllers.STRATEGYGROUPS)),this.historicalQuotes=new s(w(b.Controllers.HISTORICALQUOTES)),this.signals=new s(w(b.Controllers.SIGNALS)),this.technicalRank=new s(w(b.Controllers.TECHNICALRANK)),this.sentiments=new s(w(b.Controllers.SENTIMENTS)),this.quotation=new a(b.Hubs.STOCK_QUOTE,i,C,S),this.stockQuotePerMin=new s(w(b.Controllers.STOCK_QUOTE_PER_MINUTE),null,60),this.stockQuotePerMin.ignoreArrayResults=!0,this.indexValue=new s(w(b.Controllers.INDEXVALUE),null,60),this.order=new s(w(b.Controllers.ORDER),null,15),this.intradayTrades=new s(w(b.Controllers.INTRADAY_TRADES),d,15,T),this.intradayOrders=new s(w(b.Controllers.INTRADAY_ORDERS),v,15,N),this.intradayExercises=new s(w(b.Controllers.INTRADAY_EXERCISES),v,15,N),this.historicalTrades=new s(w(b.Controllers.HISTORICAL_TRADES),m,0),this.historicalOrders=new s(w(b.Controllers.HISTORICAL_ORDERS),g,0),this.historicalStrikes=new s(w(b.Controllers.HISTORICAL_STRIKES),y,0),this.coveredCall=new s(w(b.Controllers.COVEREDCALL),null,60,E),this.bankCode=new s(w(b.Controllers.BANKCODE),null,60,E),this.fundTransferHistory=new s(w(b.Controllers.HISTORICALBANKTRANSFER),null),this.bankTransfer=new s(w(b.Controllers.BANKTRANSFER),null,3600),this.configurations=new u,this.tradingStrategies=new s(w(b.Controllers.TRADING_STRATEGIES),null,0,E),this.tradingStrategies.ignoreArrayResults=!0,this.standardDeviations=new s(w(b.Controllers.STDDEVS),h,3600),this.standardDeviations.ignoreArrayResults=!0,this.predictions=new s(w(b.Controllers.PREDICTION),p,3600),this.predictions.ignoreArrayResults=!0,this.optionChains.connection.on(b.Hubs.OPTION_CHAINS.HubEvents.UPDATE_OPTION_QUOTES,function(e){console.log("Update Options Chain at "+new Date);if(e&&e.length>0){var t={};e.forEach(function(e){t.hasOwnProperty(e.securityCode)||(t[e.securityCode]=!0)});for(var n in t)c.optionChains.get(n).done(function(t){t.updateOptions(e)})}}),this.quotation.connection.on(b.Hubs.STOCK_QUOTE.HubEvents.UPDATE_QUOTES,function(e){console.log("Update Quotation at "+new Date),e&&e.length>0&&e.forEach(function(e){if(e.securityCode){var t=c.quotation.generateCacheId(e.securityCode,{});c.quotation.getResultHandler(t)(e)}})}),this.apllicationStartupDataPreload=function(){var i=e.Deferred(),s=c.quotation.get(),o=c.configurations.getClientConfiguration(),u=c.strategies.get();return e.when(s,o,u).done(function(e,s,o){t.optionables(ko.unwrap(e)),n.updateConfiguration(ko.unwrap(s)),r.setTempates(ko.unwrap(o)),i.resolve()}).fail(function(){i.reject()}),i.promise()}},k=new C;return t.ulCode.subscribe(function(e){k.quotation.get(e).done(function(e){t.quote(ko.unwrap(e))})}),k}),define("koBindings/translate",["knockout","modules/localizer"],function(e,t){e.bindingHandlers.translate=e.bindingHandlers.t={init:function(n){var r=arguments,i=this,s=t.activeLocale.subscribe(function(){e.bindingHandlers.t.update.apply(i,r)});e.utils.domNodeDisposal.addDisposeCallback(n,function(){s.dispose()}),e.bindingHandlers.text.init.apply(this,arguments)},update:function(n,r,i,s){function a(){var e=t.localize(o,u);return e}var o=e.utils.unwrapObservable(r()),u=i().i18nOptions||{};e.bindingHandlers.text.update.call(this,n,a,i,s)}},e.virtualElements.allowedBindings.translate=e.virtualElements.allowedBindings.t=!0,e.bindingHandlers.translateTitle=e.bindingHandlers.tt={init:function(n){var r=arguments,i=this,s=t.activeLocale.subscribe(function(){e.bindingHandlers.tt.update.apply(i,r)});e.utils.domNodeDisposal.addDisposeCallback(n,function(){s.dispose()})},update:function(n,r,i){var s=e.utils.unwrapObservable(r()),o=i().i18nOptions||{},u=t.localize(s,o);n.title=u}}}),define("koBindings/textFormatted",["knockout","modules/formatting"],function(e,t){return e.bindingHandlers.textFormatted={init:e.bindingHandlers.text.init,update:function(n,r,i,s){function f(){return a}var o=e.utils.unwrapObservable(r()),u=i().format||{},a=t.customFormat(o,u);e.bindingHandlers.text.update.call(this,n,f,i,s)}},e.virtualElements.allowedBindings.textFormatted=!0,e}),define("koBindings/fadeBackdropVisible",["knockout"],function(e){function t(t,n){var r=n();$(t).hasClass("fixed")||($(t).width($(t).parent().width()),$(t).height($(t).parent().height())),e.unwrap(r)?($(t).removeClass("invisible"),$(t).addClass("in")):($(t).removeClass("in"),$(t).addClass("invisible"))}return e.bindingHandlers.fadeBackdropVisible={init:function(e,n){function r(){t(e,n)}$(e).addClass("fade"),window.Pace&&Pace.on("done",r)},update:t},e}),define("modules/validation",["knockout","modules/localizer","knockout-validation"],function(e,t){e.validation.configure({registerExtenders:!0,messagesOnModified:!0,messageTemplate:"defaultValidationMessageTemplate",insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",grouping:{deep:!1,observable:!0}});var n={};n["en-US"]={required:"This field is required.",min:"Please enter a value greater than or equal to {0}.",max:"Please enter a value less than or equal to {0}.",minLength:"Please enter at least {0} characters.",maxLength:"Please enter no more than {0} characters.",pattern:"Please check this value.",step:"The value must increment by {0}",email:"This is not a proper email address",date:"Please enter a proper date",dateISO:"Please enter a proper date",number:"Please enter a number",digit:"Please enter a digit",phoneUS:"Please specify a valid phone number",equal:"Values must equal",notEqual:"Please choose another value.",unique:"Please make sure the value is unique."},n["zh-CN"]={required:"必填字段",min:"输入值必须大于等于 {0}",max:"输入值必须小于等于 {0}",minLength:"至少输入 {0} 个字符",maxLength:"输入的字符数不能超过 {0} 个",pattern:"请检查此值",step:"每次步进值是 {0}",email:"email地址格式不正确",date:"日期格式不正确",dateISO:"日期格式不正确",number:"请输入一个数字",digit:"请输入一个数字",phoneUS:"请输入一个合法的手机号(US)",equal:"输入值不一样",notEqual:"请选择另一个值",unique:"此值应该是唯一的"},t.activeLocale.subscribe(function(t){n[t]!==undefined&&e.validation.localize(n[t])})}),function(){function l(e){var t=e.substring(0,e.length-1);return t}var e="../Scripts/",t="../Scripts/durandal/",n="../App/",r="../App/modules/",i="../App/dataServices/",s="../App/dataServices/models/",o="../App/modules/knockoutBindings/",u="../App/modules/cache/",a="../Scripts/jquery.validate/",f="../Scripts/chartIQ/";requirejs.config({waitSeconds:0,paths:{requireLib:"../Scripts/require-2.1.11",text:"../Scripts/text",durandal:"../Scripts/durandal",plugins:"../Scripts/durandal/plugins",transitions:"../Scripts/durandal/transitions",komapping:"../Scripts/knockout.mapping-2.4.1","knockout-kendo":"../Scripts/knockout-kendo","kendo-zh-CN":"../Scripts/kendo/kendo.culture.zh-CN.min","kendo-plugins":"../Scripts/kendo/kendo.web.plugins",i18next:"../Scripts/i18next.amd.withJQuery-1.7.2",jstat:"../Scripts/jstat-0.1.0.min","jquery-signalr":"../Scripts/jquery.signalR-2.1.2.min","jquery-ui":"../Scripts/jquery-ui-1.10.4.custom.min","jquery-ui-touch-punch":"../Scripts/jquery.ui.touch-punch.min","jquery-placeholder":"../Scripts/jquery.placeholder","jquery-cookie":"../Scripts/jquery.cookie",toastr:"../Scripts/toastr",highstock:"../Scripts/highstock",highstockCopy:"../Scripts/highstock-copy",isotope:"../Scripts/isotope.pkgd",pace:"../Scripts/pace",perfectScrollbar:"../Scripts/perfect-scrollbar",bootstrap:"../Scripts/bootstrap","bootstrap-datepicker":"../Scripts/bootstrap-datepicker","jquery-validate":"../Scripts/jquery.validate/jquery.validate","jquery-validate-unobtrusive":"../Scripts/jquery.validate/jquery.validate.unobtrusive","jquery-hotkeys":"../Scripts/jquery.hotkeys",autoNumeric:"../Scripts/autoNumeric-1.9.25","knockout-validation-clear":"../Scripts/knockout.validation.debug",modules:"../App/modules","modules/strategyTemplates":"../App/modules/strategies/strategyTemplates","modules/combinationViewModel":"../App/modules/combination/combinationViewModel","modules/combinationChart":"../App/modules/combination/combinationChart","modules/combinationEditor":"../App/modules/combination/combinationEditor","modules/combinationHelpers":"../App/modules/combination/combinationHelpers","modules/strategyHelpers":"../App/modules/combination/strategyHelpers","modules/enums":"../App/modules/combination/enums",addToValidationContext:"../App/modules/validation/addToValidationContext",loader:"../App/modules/loader",events:"../App/modules/events",cache:"../App/modules/cache/cache",cacheStores:"../App/modules/cache/stores",models:"../App/dataServices/models",defaultModel:"../App/dataServices/models/defaultModel",optionChainsModel:"../App/dataServices/models/optionChainsModel",portfolioItemGroupModel:"../App/dataServices/models/portfolioItemGroupModel",portfolioItemModel:"../App/dataServices/models/portfolioItemModel",standardDeviationModel:"../App/dataServices/models/standardDeviationModel",predictionsModel:"../App/dataServices/models/predictionsModel",dataServices:"../App/dataServices/",dataContext:"../App/dataServices/dataContext",hostResolver:"../App/dataServices/hostResolver","dataServices/traceDataService":"../App/dataServices/traceDataService",koBindings:"../App/modules/knockoutBindings",koExtenders:"../App/modules/knockoutBindings/koExtenders"},shim:{"knockout-validation-clear":["addKnockoutAsGlobalVariable"],"knockout-kendo":["kendo"],"kendo-plugins":["kendo"],"amcharts-serial":["amcharts"],"amcharts-xy":["amcharts"],"kendo-zh-CN":["kendo"],"jquery-hotkeys":["jquery"],"jquery-validate":["jquery"],"jquery-ui":["jquery"],"jquery-ui-touch-punch":["jquery-ui"],"bootstrap-datepicker":["jquery-ui"],"jquery-validate-unobtrusive":["jquery-validate"]}})}(),define("jquery",function(){return jQuery}),define("kendo",function(){return kendo}),define("knockout",function(){return ko}),define("addKnockoutAsGlobalVariable",["knockout"],function(e){window.ko=e}),define("knockout-validation",["knockout","knockout-validation-clear"],function(){var e=ko.validation.group;ko.validation.group=function(t,n){e(t,n),t.isValid=ko.computed(function(){return t.errors().length===0})}}),define("main",["dataContext","durandal/system","durandal/app","durandal/viewLocator","pace","durandal/composition","koBindings/translate","koBindings/textFormatted","koBindings/fadeBackdropVisible","modules/validation"],function(e,t,n,r,i){t.debug(!0),n.configurePlugins({router:!0,widget:!0}),n.start().then(function(){r.useConvention("viewmodels"," DurandalViewsProvider/GetView?name="," DurandalViewsProvider/GetView?name="),e.authentication.getSecurityModel().then(function(){n.setRoot("viewmodels/shell","entrance")})})}),define("loader",[],function(){function r(e){return e.preventDefault(),!1}var e={},t="#loader",n="#routerIsNavigatingIndicator";return e.show=function(){$(document.activeElement).blur(),$(window).on("keydown",r),$(t).show()},e.hide=function(){$(window).off("keydown",r),$(t).hide()},e.showUnobtrusive=function(){$(n).show()},e.hideUnobtrusive=function(){$(n).hide()},e}),define("modules/browserDetection",[],function(){var e={};return e.ie=function(){var e,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");while(n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",r[0]);return t>4?t:e}(),e}),define("koBindings/kendoExt",["jquery","knockout","modules/notifications","kendo","kendo-plugins","knockout-kendo"],function(e,t,n){t.bindingHandlers.kendoExtContextMenu={init:function(n,r){var i=t.utils.unwrapObservable(r());e(n).kendoExtContextMenu(i)}},t.virtualElements.allowedBindings.kendoExtContextMenu=!0,t.bindingHandlers.kendoGlobalNotification={init:function(r,i){var s=t.utils.unwrapObservable(i()),o=e(r).kendoNotification(s).data("kendoNotification");n.setNotificationModule(o)}},t.bindingHandlers.kendoSpinner={update:function(n,r){var i=t.utils.unwrapObservable(r());window.setTimeout(function(){kendo.ui.progress(e(n),!i)})}};var r=t.bindingHandlers.kendoMenu;return t.bindingHandlers.kendoMenu={init:function(t){r.init.apply(this,arguments),setTimeout(function(){e(t).show();var n=e(t).data("kendoMenu");n.bind("select",function(){n.close()})})},update:r.update},t}),define("viewmodels/signIn",["knockout","plugins/router","loader","modules/notifications","modules/session","modules/localizer","dataContext","modules/browserDetection","koBindings/kendoExt"],function(e,t,n,r,i,s,o,u){function a(){var a=this,f,l;this.isAuthenticated=i.isAuthenticated,this.login=e.observable(null).extend({required:!0}),this.password=e.observable(null).extend({required:!0}),this.rememberMe=e.observable(!0),this.loginWays=e.observableArray(["资金账号","客户账号"]),this.selectedLoginValue=e.observable("资金账号"),this.signIn=function(){if(l||!a.isValid()||a.isAuthenticated()){a.login.isValid()||r.error(s.localize("signInPage.loginEmpty")),a.password.isValid()||r.error(s.localize("signInPage.passwordEmpty"));return}var e={login:a.login(),password:a.password(),loginAccountType:a.selectedLoginValue()=="客户账号"?"U":"Z",rememberMe:a.rememberMe()};l=!0,o.authentication.signIn(e).done(function(){t.navigate(f)}).always(function(){n.hide(),l=!1})},this.canReuseForRoute=function(){return!1},this.activate=function(e){f=e||"#"},this.login.subscribe(function(){$("#password").trigger("change")}),e.validation.group(this),this.browserCompatibilityWarningVisible=e.computed(function(){var e=u.ie;return e<10})}return a}),define("modules/dropDownList",["knockout","modules/localizer"],function(e,t){var n=function(){var n={};return n.control=null,n.changeLanguageSubscription=t.activeLocale.subscribe(function(){n.control&&n.control.setDataSource(n.control.dataSource._data)}),n.baseOptions=function(){return{dataTextField:"option",dataValueField:"value",async:!0,dataBound:function(t){n.control=t.sender,e.utils.domNodeDisposal.addDisposeCallback(n.control.ul,function(){changeLanguageSubscription.dispose()})},dataBinding:function(e){var n=e.sender.dataSource._data;n.length>0&&$.each(n,function(e,n){n.key&&(n.option=t.localize(n.key))})}}},n};return n}),define("modules/kendoWindow",["jquery"],function(e){var t={};return t.centralizeWindow=function(e){var t=e.sender.wrapper,n=t.width();if(n){var r=t.height()+100;t.css("margin-left",-n/2),t.css("margin-top",-r/2)}},t.baseOptions=function(){var e={visible:!1,actions:["Close"],modal:!0,position:{left:"50%",top:"50%"},open:t.centralizeWindow};return e},t}),define("modules/grid",["knockout","modules/configurations","modules/notifications"],function(e,t,n){var r={};return r.showLabelIfEmpty=function(t){var n=t.sender,i=n.tbody;if(n.dataSource.total()===0&&n.options.noDataTemplate){i.empty();var s=$("#"+n.options.noDataTemplate).html(),o=i.prepend(s);e.applyBindings(r,o.children()[0])}},r.baseOptions=function(){var e={useKOTemplates:!0,async:!0,noDataTemplate:"noDataTemplate",dataBound:function(e){r.showLabelIfEmpty(e)}};return e},r.kendoGridWithPagingOptions=function(e,n){var r=n?n:"data",i={data:[],dataSource:{transport:{read:e},schema:{data:r,total:"total"},pageSize:t.App.gridPageSize(),serverPaging:!0},rowTemplate:"rowTemplate",pageable:!0,scrollable:!1,useKOTemplates:!0};return i},r.deleteRow=function(e,t,r){var i=e.target||e.srcElement,s=$(i).closest("[data-role=grid]"),o=s.find("> tbody > tr:not(.details-row)");for(var u=0;u<o.length;u++){var a=$(o[u]);if(a.find(i).length){var f=s.data("kendoGrid"),l=f.dataSource,c=l.at(u);l.remove(c),n.success(r+" <strong>"+t.name+"</strong> has been deleted");break}}c===undefined&&n.error(r+"<strong>"+t.name+"</strong> has not been found")},r}),define("modules/help",["knockout","jquery","kendo"],function(e,t){var n="help-marker",r=function(e,r,i){var s=this,o=(Math.floor(Math.random()*10+1)*20).toFixed(0)+"ms";this.selector=e,this.title=r,this.content=i,this.instance=t("<div>").addClass(n).append(t('<img src="~/../Content/images/helpFlag.png">')).click(function(){return!1}).css("-o-animation-delay",o).css("-webkit-animation-delay",o).css("-moz-animation-delay",o).css("animation-delay",o).kendoTooltip({html:!0,position:"top",width:180,content:s.content}),this.append=function(){var r=t(e),i=t(e+" ."+n);return r.length&&(i.length===0||!i.is(":visible"))?(r.css("position","relative").append(s.instance),e.match(/support-anchor/i)&&r.css("position","absolute"),!0):!1},this.detach=function(){s.instance.detach()}},i=function(i){function u(){e.utils.arrayForEach(s.tooltips(),function(e){e.append()})}function a(){e.utils.arrayForEach(s.tooltips(),function(e){e.detach()})}function f(e){var r=t(e.target);o&&r.is("div")&&!r.hasClass(n)&&u()}var s=this,o=!1;this.tooltips=e.observableArray(),this.currentTooltip=e.observable(null),this.bindEvents=function(e){e.instance.on("show.bs.popover",function(){var t=s.currentTooltip();t&&t!==e.instance&&t.trigger("click"),s.currentTooltip(e.instance)}),e.instance.on("hide.bs.popover",function(){var t=s.currentTooltip();t&&t===e.instance&&s.currentTooltip(null)})},this.toggleMarkers=function(){t("#applicationHost").toggleClass("help-active"),o=!o,o?u():a();var e=s.currentTooltip();e&&e.trigger("click")},this.addHelpTooltip=function(e,t,n){var i=new r(e,t,n);s.bindEvents(i),s.tooltips.push(i)},this.updateViewModel=function(t){e.utils.arrayForEach(t,function(e){s.addHelpTooltip(e.selector,e.title,e.content)})},i&&this.updateViewModel(i),document.addEventListener("animationstart",f,!0),document.addEventListener("MSAnimationStart",f,!0),document.addEventListener("webkitAnimationStart",f,!0)},s=[{selector:".flagLocationCarousel2",title:"",content:"输入您愿意承担风险的金额，OptionsPlay会调整每个策略的股数与合同数"},{selector:".flagLocationCarousel1",title:"",content:"输入您想要投资的金额，OptionsPlay将会调整您能买到的股数和匹配相对应的策略"},{selector:".flagLocation-strategiesSentences",title:"",content:"这里用于解释您使用的策略类型，所要承受的风险，和可能获得的收益"},{selector:"#whatifDetailsPane",title:"",content:"这里用于显示，当股票价格按照预期进行增长或是下跌，所带来的盈亏情况，并图示您的实际收益情况如何随着股票价格浮动"},{selector:".optionsplay-score-round",title:"",content:"OptionsPlay的评分是我们专业化指标，用以评估和权衡您使用的策略所要承受的风险和可能的收益。评分超过100说明潜在的风险太大，调整交易幅度或可调节评分"},{selector:".modify-btn-help ",title:"",content:"点击这里改变您的股票和合同数量，行权价和到期日，让您能够个性化设计自己专属的策略"},{selector:".trade-btn-help",title:"",content:"点击这里引导您进入股票交易界面"},{selector:"#sentimentBtnGroup",title:"",content:"OptionsPlay会根据预期进行策略推荐,您可以自行选择查看相应的策略"},{selector:"#monthControl",title:"",content:"您可以选择1,3,6个月股票历史数据，可以放大缩小，也可以扩大图表进行查看"},{selector:"#techScore",title:"",content:"技术得分是数字化指标，用于短期、中期、长期，股票风险评估。分为10个等级，10级安全系数最高，1级最弱。1-3：弱，总体熊市；4-6：缺少活力，有趋弱的势头；7-10：强，总体牛市"},{selector:"#symbolInput",title:"",content:"输入任何一个上市公司的股票代码或者指数基金，OptionsPlay建议您选择基于我们分析后的安全策略。"},{selector:"#sentiment",title:"",content:"这是OptionsPlay对股票的展望，绿色箭头代表熊市，红色箭头代表牛市"},{selector:"#technicalRank",title:"",content:"技术得分是数字化指标，用于短期、中期、长期，股票风险评估。分为10个等级，10级安全系数最高，1级最弱。1-3：弱，总体熊市；4-6：缺少活力，有趋弱的势头；7-10：强，总体牛市"},{selector:"#companyName",title:"",content:"以下所有代号都是由OptionsPlay一个或多个扫描触发，产生不同的交易方式。竖线条代表着六个月的趋势，绿色代表熊市，红色代表牛市，黄色代表整盘"},{selector:"#sectorsDropdown",title:"",content:"所有可交易的特色行业都被罗列在以下列表，请选择过滤"},{selector:"#sentimentFilterButtons",title:"",content:"市场关闭后，OptionsPlay会运用专业的后台技术，扫描成千上万的股票和指数基金，分析出处于上升和下降趋势的股票"},{selector:"#marketCapFilterButtons",title:"",content:"交易方式可以通过市值的大小进行过滤。"},{selector:"#lookup",title:"",content:"输入您想查看得股票代码"},{selector:".chains-toolbox-strategy",title:"",content:"选择您想查看得交易策略，我们将自动为您呈现所有可能的该策略组合，您可以通过右边的参数调整组合。"},{selector:".chains-toolbox-option",title:"dksal;kdl;sakd;s",content:"显示最接近标的物价格的实（虚）值期权或组合。"}],o=new i(s);return o}),define("viewmodels/shell",["knockout","durandal/app","plugins/router","modules/dropDownList","dataContext","modules/localizer","modules/session","modules/kendoWindow","modules/grid","modules/formatting","modules/help","modules/notifications","events","pace","modules/context","kendo","koBindings/kendoExt"],function(ko,app,router,DropDownList,dataContext,localizer,session,kendoWindow,grid,formatting,help,notifications,events,pace,context){function updateDocumentTitle(e){if(e){var t=localizer.localize(e);app.title?document.title=t+" | "+app.title:document.title=t}else app.title&&(document.title=app.title)}function signOut(){dataContext.authentication.signOut().done(function(){router.navigate("#signIn"),dataPreloaded=!1}).always(function(){window.location.reload()})}function activate(){var e=[{route:"signIn(/:returnRoute)",title:"pages.signIn",moduleId:"viewmodels/signIn",notAuthenticatedAccess:!0},{route:"",title:"首页",moduleId:"viewmodels/index",nav:!0,showPace:!0},{route:"quotes",title:"pages.quotes",moduleId:"viewmodels/quotes",nav:!0,showPace:!0},{route:"portfolio",title:"pages.portfolio",moduleId:"viewmodels/portfolio",nav:!0,showPace:!0},{route:"strategy/all",title:"manageStrategies.all",moduleId:"viewmodels/strategy/all",requiredPermission:"ManageStrategies"},{route:"strategy/new",title:"manageStrategies.new",moduleId:"viewmodels/strategy/new",requiredPermission:"ManageStrategies"},{route:"strategy/edit/:id",title:"manageStrategies.edit",moduleId:"viewmodels/strategy/edit",requiredPermission:"ManageStrategies"},{route:"strategy/group/all",title:"manageStrategies.group.all",moduleId:"viewmodels/strategy/group/all",requiredPermission:"ManageStrategies"},{route:"strategy/group/new",title:"manageStrategies.group.new",moduleId:"viewmodels/strategy/group/new",requiredPermission:"ManageStrategies"},{route:"strategy/group/edit/:id",title:"manageStrategies.group.edit",moduleId:"viewmodels/strategy/group/edit",requiredPermission:"ManageStrategies"}];router.map(e).buildNavigationModel();var t=router.activate();return t}function getFirstOfMonthDate(){var date=new Date;with(date)var year=getFullYear(),month=getMonth()+1;month<10&&(month="0"+month),startDay=year+"-"+month+"-"+"01";var formatBox=new Date(startDay);return formatBox}function getCurrentDate(){var date=new Date;with(date)var year=getFullYear(),month=getMonth()+1,day=getDate();month<10&&(month="0"+month),endDay=year+"-"+month+"-"+day;var formatBox=new Date(endDay);return formatBox}function pullBankCode(){bankComboChoices([]),dataContext.bankCode.get().done(function(e){e().forEach(function(e){bankComboChoices.push({key:e.bankName,value:e.bankCode})}),e().length>=1&&selectedBank(e()[0].bankCode)})}function loadFundInfo(){dataContext.fund.get().done(function(e){portfolioFund(e),gotFundOrNot=1,showFund()})}app.title=localizer.localize("app.title"),router.updateDocumentTitle=function(e,t){updateDocumentTitle(t.config.title)},localizer.activeLocale.subscribe(function(){var e=router.activeInstruction();e&&e.config&&updateDocumentTitle(e.config.title)});var dataPreloaded=!1;router.guardRoute=function(e,t,n){var r,i=session.isAuthenticated();typeof t.config.requiredPermission!="undefined"?(r=session.hasPermission(t.config.requiredPermission),!r):r=t.config.notAuthenticatedAccess?!i:i;var s;r||(s=i?"#":"#signIn/"+t.config.hash);var o=r||s;if(!dataPreloaded&&i){var u=$.Deferred();return dataContext.apllicationStartupDataPreload().done(function(){dataPreloaded=!0,u.resolve(o)}).fail(function(){dataPreloaded=!1,u.reject()}),u.promise()}return o};var fundTransferHistoryList=ko.observableArray(),gridReady=ko.observable(!1),transactionDate=ko.observable(),transactionDateStart=ko.observable(),transactionDateEnd=ko.observable(),showDefaultDate=function(){transactionDateStart(getFirstOfMonthDate()),transactionDateEnd(getCurrentDate());if(transactionDateStart()==null||transactionDateEnd()==null)return;var e=transactionDateStart(),t=transactionDateEnd(),n=formatting.formatDate(e,"yyyyMMdd")+"/"+formatting.formatDate(t,"yyyyMMdd");console.log(n),dataContext.fundTransferHistory.get(n).done(function(e){e&&(fundTransferHistoryList(e()),gridReady(!0))})},pullFundTransferHistory=function(){if(transactionDateStart()==null||transactionDateEnd()==null)return;var e=transactionDateStart();console.log(e);var t=transactionDateEnd(),n=formatting.formatDate(e,"yyyyMMdd")+"/"+formatting.formatDate(t,"yyyyMMdd");console.log(n),dataContext.fundTransferHistory.get(n).done(function(e){e&&(fundTransferHistoryList(e()),gridReady(!0))})};transactionDateStart.subscribe(function(e){pullFundTransferHistory()}),transactionDateEnd.subscribe(function(e){pullFundTransferHistory()});var bankComboChoices=ko.observableArray([]),selectedBank=ko.observable(),isTFVisible=ko.observable(!1),transferFundsOptions=$.extend(kendoWindow.baseOptions(),{title:localizer.localize("pages.transferFunds"),isOpen:isTFVisible,width:870}),transfer=function(e){isTFVisible(!0),pullBankCode(),transactionDate(new Date),transferNum(null),$("#fundValueInBox").val(""),showDefaultDate(),fundHasOrNot(1),warningInfo("")},isCPVisible=ko.observable(!1),changePasswordWindow=$.extend(kendoWindow.baseOptions(),{title:localizer.localize("pages.changePassword"),isOpen:isCPVisible}),isBKVisible=ko.observable(!1),excuteBankPassword=function(){console.log("单纯查看银行资金")},bankPasswordWindow=$.extend(kendoWindow.baseOptions(),{title:localizer.localize("请输入银行密码"),isOpen:isBKVisible}),activeBankPasswordWindow=function(){isBKVisible(!0)},isFundPasswordVisible=ko.observable(!1),excuteFundPassword=function(){console.log("直接显示资金密码")},fundPasswordWindow=$.extend(kendoWindow.baseOptions(),{title:localizer.localize("请输入资金密码"),isOpen:isFundPasswordVisible}),activeFundPasswordWindow=function(){isFundPasswordVisible(!0)},isToWindowVisible=ko.observable(!1),excuteBankToBrokeWindow=function(){console.log(" 从银行到券商")},bankToBrokeWindow=$.extend(kendoWindow.baseOptions(),{title:localizer.localize("请输入银行密码"),isOpen:isToWindowVisible}),activeBankToBrokeWindow=function(){transferNum()!==null&&transferNum()!==""?(fundPassword(""),isToWindowVisible(!0),fundHasOrNot(1),warningInfo("")):(fundHasOrNot(-1),warningInfo("！请输入转账资金"))},isBrokeToWindowVisible=ko.observable(!1),excuteBankToBrokeWindow=function(){console.log(" 从银行到券商"),transferFunds(2)},bankToBrokeWindow=$.extend(kendoWindow.baseOptions(),{title:localizer.localize("请输入银行密码"),isOpen:isToWindowVisible}),isBrokeToBankVisible=ko.observable(!1),excuteBrokeToBankWindow=function(){console.log(" 从券商到银行"),transferFunds(1)},BrokeToBankWindow=$.extend(kendoWindow.baseOptions(),{title:localizer.localize("请输入资金密码"),isOpen:isBrokeToBankVisible}),fundHasOrNot=ko.observable(1),warningInfo=ko.observable(""),activeBrokeToBankWindow=function(){transferNum()!==null&&transferNum()!==""?(fundPassword(""),isBrokeToBankVisible(!0),fundHasOrNot(1),warningInfo("")):(fundHasOrNot(-1),warningInfo("！请输入转账资金"))},gotFundOrNot=0,showFund=function(){gotFundOrNot==0?(console.log("show Fund"),loadFundInfo()):($("#fundValueInBox").val(portfolioFund().availableFund()),gotFundOrNot=0)},portfolioFund=ko.observable(),changePW=function(){isCPVisible(!0)},bankDropDownList=new DropDownList,bankOptions=$.extend(bankDropDownList.baseOptions(),{data:bankComboChoices,value:selectedBank}),hisotoricalFundTransferGridOptions=$.extend(grid.baseOptions(),{data:fundTransferHistoryList,rowTemplate:"historicalFundTransferRowTemplate",height:280,resizable:!0,scrollable:!0,dataBound:function(e){gridReady()&&grid.showLabelIfEmpty(e)}}),fundPassword=ko.observable(""),bankPassword=ko.observable(""),transferNum=ko.observable(null),colorWarning=ko.observable(-5),transferFunds=function(e){dataContext.bankTransfer.post("",{bankCode:selectedBank(),fundPassword:fundPassword(),bankPassword:bankPassword(),transferAmount:transferNum(),dir:e}).done(function(){isToWindowVisible(!1),isBrokeToBankVisible(!1),pullFundTransferHistory()})},passwordTypeCandidates=[{key:"pages.tradePassword",value:"4"},{key:"pages.capitalPassword",value:"5"}],chosenPasswordType=ko.observable("4"),kendoPasswordTypes=$.extend((new DropDownList).baseOptions(),{data:passwordTypeCandidates,value:chosenPasswordType}),currentPassword=ko.observable(""),newPassword=ko.observable(""),newPasswordAgain=ko.observable(""),changePassword=function(){if(self.newPassword()!==self.newPasswordAgain())return;$.post("api/portfolio/changePassword",{oldPassword:currentPassword(),newPassword:newPassword(),useScope:chosenPasswordType()}).done(function(){isCPVisible(!1),notifications.info(localizer.localize("pages.passwordChanged"))}).fail(function(e){notifications.error(e.responseJSON.message)})},expandTrade=function(){events.trigger(events.Bottom.IS_SHOWN)},self={kendoNotification:{position:{top:20,right:20},stacking:"down",width:300},currentPassword:currentPassword,newPassword:newPassword,newPasswordAgain:newPasswordAgain,chosenPasswordType:chosenPasswordType,changePassword:changePassword,signOut:signOut,router:router,session:session,activate:activate,transferFundsOptions:transferFundsOptions,transfer:transfer,changePasswordWindow:changePasswordWindow,changePW:changePW,kendoPasswordTypes:kendoPasswordTypes,bankOptions:bankOptions,gridReady:gridReady,hisotoricalFundTransferGridOptions:hisotoricalFundTransferGridOptions,fundPassword:fundPassword,bankPassword:bankPassword,transferNum:transferNum,transferFunds:transferFunds,transactionDateStart:transactionDateStart,selectedBank:selectedBank,transactionDate:transactionDate,transactionDateEnd:transactionDateEnd,help:help,expandTrade:expandTrade,activeFundPasswordWindow:activeFundPasswordWindow,fundPasswordWindow:fundPasswordWindow,activeBankPasswordWindow:activeBankPasswordWindow,excuteBankPassword:excuteBankPassword,bankPasswordWindow:bankPasswordWindow,excuteFundPassword:excuteFundPassword,excuteBankToBrokeWindow:excuteBankToBrokeWindow,bankToBrokeWindow:bankToBrokeWindow,activeBankToBrokeWindow:activeBankToBrokeWindow,excuteBrokeToBankWindow:excuteBrokeToBankWindow,BrokeToBankWindow:BrokeToBankWindow,activeBrokeToBankWindow:activeBrokeToBankWindow,showFund:showFund,loadFundInfo:loadFundInfo,showDefaultDate:showDefaultDate,colorWarning:colorWarning,fundHasOrNot:fundHasOrNot,warningInfo:warningInfo,context:context};return self}),define("modules/helpers",[],function(){var e=function(e,t){var n=t.split("."),r=e,i=undefined;for(var s=0;s<n.length;s++){if(r==null)return null;i=r[n[s]],r=i}return i},t={getValue:e};return t.uniqueArray=function(e){e=e||[];var t={},n,r=e.length;for(n=0;n<r;n++){var i=e[n];typeof t[i]=="undefined"&&(t[i]=i)}e.length=0;for(n in t)e[e.length]=t[n];return e},t.getParameterFromHash=function(e){var t=new RegExp("#.*[?&]?"+e+"=([^&]+)(&|$)"),n=location.hash.match(t),r=n?n[1]:null;return r},t.partial=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);return function(){return e.apply(this,n.concat(t.call(arguments,0)))}},t.partialRight=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);return function(){return e.apply(this,t.call(arguments,0).concat(n))}},t.removeNullOrEmpty=function(e){e=e||[];var t=e.map(function(e){return e&&e.trim()}).filter(function(e){return!!e});return t},t.extend=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.superclass=t.prototype},t}),define("viewmodels/tradeIdeas/tradeIdeaGrid",["knockout","dataContext","modules/formatting","modules/context","modules/helpers"],function(e,t,n,r,i){var s=function(){function o(e){return function(t,n){return t[e]===n}}function u(){t.scrollTop(0),t.scrollTop.valueHasMutated()}function a(e){var n=t.filteredItems(),r=n.indexOf(e);if(r==-1)return;var i=r*t.rowHeight;t.scrollTop(i)}function f(n){var r=t.selectedItem(),i,s;return r&&r.securityCode===n?!0:(i=e.utils.arrayFirst(t.items(),function(e){return e.securityCode.toUpperCase()===n.toUpperCase()}),t.selectedItem(i),a(i),s=i!=null,s)}var t=this;this.items=e.observableArray([]),this.activeFilters=e.observableArray([]);var n=function(t,n,r){this.title=t,this.sortPropertyName=n,this.sortingAsc=e.observable(null),this.cssClass=r};this.headers=[new n("公司名称","securityName","company-name-cell"),new n("价格","lastPrice","last-price-cell"),new n("评级","technicalRank","technical-rank-cell"),new n("趋势","sentiment","sentiment-cell")],this.updateTradeIdeas=function(n,i,s){e.isObservable(n)&&(n=e.unwrap(n)),e.isObservable(i)&&(i=e.unwrap(i)),e.isObservable(s)&&(s=e.unwrap(s));var o=i,u=s,a=n.map(function(e,t){return{securityName:e.securityName,securityCode:e.securityCode,lastPrice:e.lastPrice,change:e.change,changePercentage:e.changePercentage,sentiment:u[t].sentiment,sentimentGradientCssClass:u[t].sentiment,sector:e.securityClass,rules:[],marketCap:e.turnover(),technicalRank:o[t].value}});t.items(a),r.trendSentiment(u[0].sentiment),f(r.ulCode())};var s={security:function(e,t){var n=t.toUpperCase(),r=e.securityCode.indexOf(n)==0,i=t.length>3&&e.companyName.toUpperCase().indexOf(n)!=-1;return r||i},sector:o("sector"),sentiment:o("sentiment"),reason:function(t,n){if(n===configuration.MULTIPLE_SCANS_VALUE){var r=t.rules.length>1;return r}var i=e.utils.arrayFirst(t.rules,function(e){return e.reason===n});return!!i},marketCap:function(e,t){var n,r,i;if(!t||t.length==0)return!0;i=e.marketCap;for(n=0;n<t.length;n++){r=t[n];if(i<=r.to&&i>r.from)return!0}return!1}};this.filter=function(e){var n,r,o=[],a;for(a in e){n=e[a];if(n==null||n==""||n==[])continue;r=s[a];if(!r)throw"Filter is not specified";o.push(i.partialRight(r,n))}t.activeFilters(o),u()},this.selectedItem=r.selectedTradeIdea,this.selectTradeIdea=function(e){!e&&t.selectedItem()&&t.selectedItem(null);if(!e||r.ulCode()===e.securityCode.toUpperCase())return;r.trendSentiment(e.sentiment),r.isWhyPanelLoading(!0),r.isHowPanelLoading(!0),r.isTradeIdPanelLoading(!1),t.selectedItem(e)},this.headers[0].sortingAsc(!0),this.activeSortHeader=e.observable(this.headers[0]),this.activeSortFunction=e.observable(function(){return 0}),this.sort=function(n){var r,i,s,o,a=n.sortingAsc();a!=null?n.sortingAsc(!a):(e.utils.arrayForEach(t.headers,function(e){e.sortingAsc(null)}),n.sortingAsc(!0)),r=n.sortPropertyName,i=function(t,n){var i=e.utils.unwrapObservable(t[r]),s=e.utils.unwrapObservable(n[r]);return i<s?-1:i>s?1:i==s?0:0},s=function(e,t){return i(t,e)},o=n.sortingAsc()?i:s,t.activeSortHeader(n),t.activeSortFunction(o),u()},this.filteredItems=e.computed(function(){var n=t.activeSortFunction(),r,i,s=t.activeFilters();return s.length==0?r=t.items():(i=function(e){var t,n;for(t=0;t<s.length;t++){n=s[t];if(!n(e))return!1}return!0},r=e.utils.arrayFilter(t.items(),i)),r.sort(n)}),this.rowHeight=36,this.scrollTop=e.observable(0),this.isTradePanelVisible=e.observable(!0),this.visibleItemIndexes=e.observable(),r.ulCode.subscribe(f)};return s}),define("koBindings/redGreen",["knockout"],function(e){return e.bindingHandlers.redGreen={update:function(t,n,r,i){var s=e.utils.unwrapObservable(n());return e.bindingHandlers.css.update.call(this,t,function(){return{"bullish-red":s>0,"bearish-green":s<0,black:s==0}},r,i)}},e.virtualElements.allowedBindings.textFormatted=!0,e}),define("viewmodels/tradeIdeas/tradeIdeas",["knockout","dataContext","modules/formatting","modules/help","kendo","modules/context","viewmodels/tradeIdeas/tradeIdeaGrid","koBindings/fadeBackdropVisible","koBindings/redGreen","bootstrap"],function(e,t,n,r,i,s,o){var u=function(){function l(){var e=n.selectedSentiment();e&&e.checked(!1)}function c(){for(var e=0;e<n.marketCapFilters.length;e++)n.marketCapFilters[e].checked(!1)}function h(){var e=n.selectedSentiment(),t=e?e.name:"",r=n.sector(),s=r!==i?r:"",o=$.grep(n.marketCapFilters,function(e){return e.checked()});n.tradeIdeasGrid.filter({sentiment:t,sector:s,marketCap:o})}var n=this,r="全部",i="所有版块",s="所有扫描",u=1e9;this.backdrop=e.observable(!0);var a={name:"Bullish",text:"牛市",checked:e.observable(!1)},f={name:"Bearish",text:"熊市",checked:e.observable(!1)};this.sentiments=[a,f],this.selectSentiment=function(e){e.checked()?e.checked(!1):a==e&&f.checked()?f.checked(!1):f==e&&a.checked()?a.checked(!1):e.checked(!0)},this.marketCapFilters=[{name:"小盘",from:-Infinity,to:2*u,checked:e.observable(!1)},{name:"中盘",from:2*u,to:10*u,checked:e.observable(!1)},{name:"大盘",from:10*u,to:200*u,checked:e.observable(!1)},{name:"超大盘",from:200*u,to:Infinity,checked:e.observable(!1)}],this.tradeIdeasGrid=new o,this.sectors=e.observableArray([i]),this.sector=e.observable(i),this.sector.subscribe(h),this.isFilterActive=function(e){var t=e!==s&&e!==i;return t},this.tradeIdeasCount=e.computed(function(){return n.tradeIdeasGrid.filteredItems().length}),t.quotation.get().done(function(r){t.technicalRank.get().done(function(i){t.sentiments.get().done(function(t){n.tradeIdeasGrid.updateTradeIdeas(r,i,t),e.utils.arrayForEach(n.tradeIdeasGrid.items(),function(e){var t;t=e.sector,t&&n.sectors().indexOf(t)===-1}),n.backdrop(!1)})})}),this.selectedSentiment=e.computed(function(){var e;for(e=0;e<n.sentiments.length;++e)if(n.sentiments[e].checked())return n.sentiments[e];return null}).extend({rateLimit:10}),this.selectedSentiment.subscribe(function(){h()}),this.selectMarketCap=function(e){var t;e&&e.checked(!e.checked()),t=!$(n.marketCapFilters).is(function(e){return!n.marketCapFilters[e].checked()}),t&&c(),h()},this.initializeUI=function(){$(".dropdown-toggle").dropdown()}};return new u}),define("modules/sentimentsModel",["knockout"],function(e){function i(t){var n=this;this.caption=t,this.value=e.observable(null),this.cssClass=e.observable(""),this.name=e.observable(r),this.secondary=e.observable(null),e.computed(function(){var e=n.value(),t=o(e);n.cssClass(t.cssClass),n.name(t.name),n.secondary(t.secondary)})}function s(r,s){var o=this;this.syrahSentimentLongTerm=new i(t),this.syrahSentimentShortTerm=new i(n),this.longTermValue=this.syrahSentimentLongTerm.value,this.shortTermValue=this.syrahSentimentShortTerm.value,this.longTermValue(r),this.shortTermValue(s),this.combinedCssClass=e.computed(function(){var e=o.syrahSentimentLongTerm.cssClass();if(e)return e;var t=o.syrahSentimentShortTerm.cssClass();return t}),this.updateSentiments=function(e){o.longTermValue(e.syrahLongSentiment),o.shortTermValue(e.syrahShortSentiment)}}function o(e){function n(e,t,n){this.name=e||"N/A",this.cssClass=t,this.secondary=n}var t;switch(e){case-4:t=new n("Bearish","bearish","Overextended");break;case-3:t=new n("Bearish","bearish");break;case-2:t=new n("Bearish","bearish");break;case-1:t=new n("Neutral","neutral");break;case 0:t=new n("Mildly Bearish","bearish");break;case 1:t=new n("Mildly Bullish","bullish");break;case 2:t=new n("Neutral","neutral");break;case 3:t=new n("Bullish","bullish");break;case 4:t=new n("Bullish","bullish");break;case 5:t=new n("Bullish","bullish","Overextended");break;default:t=new n}return t}var t="6M Trend",n="1M Trend",r="N/A";return s}),define("viewmodels/tradeIdeas/quoteWidget",["knockout","modules/sentimentsModel","dataContext","modules/context"],function(e,t,n,r){function i(){function s(e){return!e||/^\s*$/.test(e)}function o(e){if(!s(e)){var t=["/","\\","*","&","%","#",":","<",">",",","[","]",";","`","=","-"];for(var n=0,r=t.length;n<r;n++)if(e.indexOf(t[n])>=0)return!1}return!0}function u(t){n.quotation.get(t).done(function(t){i.quote(e.unwrap(t))})}var i=this;this.securityCode=r.ulCode,this.securitySearch=e.observable(this.securityCode()).extend({characterCase:"upper"}),this.securitySearch.subscribe(function(e){e&&(o(e)?i.securityCode(e):setTimeout(function(){i.securitySearch(i.securityCode())}))}),this.securityCode.subscribe(function(e){i.securitySearch(e)}),this.lookupButtonClick=function(){i.securityCode.notifySubscribers(i.securityCode())},this.selectTextBoxContent=function(e,t){var n=t.target||t.srcElement;setTimeout(function(){$(n).select()})},this.loseFocusOnEnter=function(e,t){if(t.which===13){var n=t.target||t.srcElement;$(n).blur()}return!0},this.isSymbolTradeIdea=e.computed(function(){return!!r.selectedTradeIdea()}),this.quote=e.observable(),u(this.securityCode()),this.securityCode.subscribe(u),this.syrahSentiments=new t,this.isSentimentTextLong=e.computed(function(){var e,t=i.syrahSentiments.syrahSentimentLongTerm.name(),n=i.syrahSentiments.syrahSentimentShortTerm.name();return e=t&&t.length>10||n&&n.length>10,e}),this.updateSentiments=function(e,t){i.syrahSentiments.updateSentiments({syrahLongSentiment:t?t.value:null,syrahShortSentiment:e?e.value:null}),r.symbolSentiments(i.syrahSentiments)}}return i}),define("modules/combinationHelpers",["knockout","modules/enums","dataContext","jstat"],function(e,t){function n(){this.buildCombinationLegs=function(e,n,r,i,s,o){var u=r.toUpperCase()===t.BUY,a=n.map(function(e){var n=e.buyOrSell.toUpperCase()===t.BUY,r=s.findExpiry(o,e.expiry,0).date,a=s.findStrike(i.lastPrice(),r,e.strike),f=e.quantity;e.legType.toUpperCase()==t.SECURITY&&(f=f/1e3*s.defaultMultiplier);var l={buyOrSell:u^n?t.SELL:t.BUY,quantity:f,legType:e.legType,expiry:r,strikePrice:a};return l});return a},this.cloneCombination=function(e){var n=require("modules/combinationViewModel"),r=e.extractedPositions(),i=r.map(function(e){return{buyOrSell:e.quantity<0?t.SELL:t.BUY,quantity:Math.abs(e.quantity),legType:e.type,expiry:e.expiry,strikePrice:e.strikePrice}});return new n(e.ulCode,i)},this.extractPositions=function(e){var n=e.positions(),r=[],i;for(var s=0;s<n.length;s++){var o=n[s],u=!1;for(i=0;i<r.length;i++){var a=r[i];a.type==o.type()&&(o.type().toUpperCase()==t.SECURITY||o.expiry()==a.expiry&&o.strikePrice()==a.strikePrice)&&(a.quantity+=o.quantity(),a.ownedQuantity+=o.isOwned()?o.quantity():0,u=!0,a.repeated=!0)}u||r.push({code:o.quotation().code,quantity:o.quantity(),expiry:o.expiry(),strikePrice:o.strikePrice(),type:o.type().toUpperCase(),multiplier:o.quotation().multiplier,repeated:!1,price:o.price(),costBasis:o.costBasis(),ownedQuantity:o.isOwned()?o.quantity():0})}return r.sort(function(e,n){if(e.type==t.SECURITY)return-1;if(n.type==t.SECURITY)return 1;var r=e.strikePrice-n.strikePrice;return r||(r=e.expiry.getTime()-n.expiry.getTime()),r||(r=e.type==t.CALL?-1:1),r}),r},this.combinationEigenvalue=function(e){var n=e.extractedPositions(),r="",i=e.multiplier();for(var s=0;s<n.length;s++){var o=n[s],u=n[s-1],a=1,f=o.quantity;u&&(u.type==t.SECURITY?a=u.quantity/i:a=u.quantity),o.type==t.SECURITY&&(f=o.quantity/i),r+=((u?f/a:f>0?1:-1)*100).toFixed(0),r+=!u||u.type==t.SECURITY?2:u.expiry.toDateString()==o.expiry.toDateString()?0:u.expiry.getTime()<o.expiry.getTime()?-1:1,r+=!u||u.type==t.SECURITY?2:o.strikePrice==u.strikePrice?0:1,r+=o.type==t.SECURITY?0:o.type==t.CALL?1:2,r+="|"}return r},this.extractOrderEntries=function(e){var n=[];return e.extractedPositions().forEach(function(r){if(r.type!=t.SECURITY){var i=r.code,s="133",o=Math.abs(r.quantity),u=e.strategyName()=="Covered Call",a=u?"404":r.quantity>0?"400":"402";i.length<7,n.push({optionNumber:i,orderType:s,orderQuantity:o,orderPrice:r.price,isCovered:u,stockBiz:a})}}),n},this.uniqueArray=function(e){e=e||[];var t={},n,r=e.length;for(n=0;n<r;n++){var i=e[n];typeof t[i]=="undefined"&&(t[i]=i)}e.length=0;for(n in t)e[e.length]=t[n];return e}}return new n}),define("koBindings/customExtenders",["jquery","knockout","modules/formatting"],function(e,t,n){t.extenders.customFormat=function(e,r){var i=r.positive||!1,s=r.writable||!1,o=r.element||undefined,u=t.computed({read:function(){return n.customFormat(e(),r)},write:s?function(t){var n=e(),r=u(),s=isNaN(t)&&isFinite(t)?parseFloat(t.replace(/[^0-9.-–]/g,"")):t;isNaN(s)?s=n:s<0&&i&&(s=0),s!==n?e(s):t!==r&&(e.notifySubscribers(),u.notifySubscribers())}:null,disposeWhenNodeIsRemoved:o});return u},t.extenders.characterCase=function(e,n){var r=t.computed({read:e,write:function(t){var r=e(),i=null;if(t){t=t.trim();switch(n){case"upper":i=t.toUpperCase();break;case"lower":i=t.toLowerCase();break;default:throw"invalid characters' case specified"}}i!==r?e(i):t!==r&&e.notifySubscribers(i)}});return r(e()),r},t.extenders.numberMinMax=function(e,n){var r=n.min,i=n.max,s=t.computed({read:e,write:function(t){var n=e(),s=isNaN(t)?0:parseFloat(+t),o=s;r&&s<r&&(o=r),i&&s>i&&(o=i),o!==n?e(o):t!==n&&e.notifySubscribers(o)}});return s(e()),s},t.extenders.numberRounded=function(e,r){var i=r,s=t.computed({read:function(){return n.roundNumber(e(),i)},write:function(t){var r=n.roundNumber(e(),i),s=isNaN(t)?0:parseFloat(+t),o=n.roundNumber(s,i);o!==r&&e(o)}});return s(e()),s},t.extenders.nullValue=function(e,n){var r=t.computed({read:e,write:function(t){var r=e(),i=t?t:n;i!==r&&e(i)}});return r(e()),r},t.extendedComputed=function(n,r,i,s){if(n==null)throw new Error("evaluator function must be specified");i=i||{};var o=typeof n=="object"?n:i;return e.extend(o,s),t.computed(n,r,i)},t.deferredComputed=function(e,n,r){return t.extendedComputed(e,n,r,{deferEvaluation:!0})}}),define("modules/disposableViewModel",["knockout","koBindings/customExtenders"],function(e){var t=function(){function r(){return n}var t=[],n=!1;this.destroy=this.dispose=function(){for(var e=0;e<t.length;e++)t[e].dispose();t=[],n=!0},this.computed=function(n,i,s){var o=e.extendedComputed(n,i,s,{disposeWhen:r});return t.push(o),o},this.deferredComputed=function(n,i,s){var o=e.extendedComputed(n,i,s,{deferEvaluation:!0,disposeWhen:r});return t.push(o),o},this.subscribe=function(e,n,r,i){var s=e.subscribe(n,r,i);t.push(s)}};return t}),define("modules/combinationViewModel",["knockout","modules/strategyTemplates","modules/enums","modules/configurations","dataContext","modules/formatting","modules/combinationHelpers","jquery","modules/localizer","modules/disposableViewModel","modules/helpers","koBindings/customExtenders","jstat"],function(e,t,n,r,i,s,o,u,a,f,l){var c=new NormalDistribution(0,1),h=r.TechnicalAnalysis.riskFreeRate,p=r.TechnicalAnalysis.defaultDividendYield(),d=n.LegType.SECURITY,v=n.LegType.CALL,m=n.BuyOrSell.BUY,g=n.BuyOrSell.SELL,y=function(t,r,o,u,a,l,v,m){var g=this;f.call(this),this.ulCode=t,this.chain=m;var y=r.toUpperCase()==n.BUY?o:-o;this.originalLeg={quantity:y,type:u,expiry:a,strikePrice:l,strike:l,costBasis:v},this.buyOrSell=e.observable(y>0?n.BuyOrSell.BUY:n.BuyOrSell.SELL),this.buySellFlag=this.computed({read:function(){return g.buyOrSell()===n.BuyOrSell.BUY},write:function(e){g.buyOrSell(e?n.BuyOrSell.BUY:n.BuyOrSell.SELL)}}),this.absQuantity=e.observable(Math.abs(o)).extend({numberMinMax:{min:1,max:99999}}),this.quantity=this.computed({read:function(){var e=g.absQuantity(),t=g.buySellFlag()?e:-e;return t},write:function(e){if(e==0)return;g.absQuantity(Math.abs(e)),g.buySellFlag(e>0)}}),this.type=e.observable(u.toUpperCase()),this.expiry=e.observable(a),this.expirySub=this.expiry.subscribe(function(e){typeof e=="string"&&g.expiry(new Date(e))}),this.strike=this.strikePrice=e.observable(l),this.strikePriceSub=this.strikePrice.subscribe(function(e){typeof e=="string"&&g.strikePrice(parseFloat(e))}),this.strikeList=this.computed(function(){if(g.type()!=d){var e=g.expiry();return g.chain?g.chain.strikeListExpiry(e,g.optionType):null}return[]}),this.expiryStr=e.observable(s.formatDate(g.expiry(),"yyyy-MM-dd")),this.expiryStr.subscribe(function(e){g.expiry(new Date(e))}),this.callOrPut=this.callPutFlag=e.computed({read:function(){return g.type()===n.CALL},write:function(e){e?g.type(n.CALL):g.type(n.PUT)}},this),this.costBasis=e.observable(typeof v=="undefined"?null:v),this.isOwned=e.observable(v!=null);var b={code:g.ulCode,last:e.observable(0),bid:e.observable(0),ask:e.observable(0),volume:e.observable(0),openInterest:0,impliedVolatility:e.observable(0),multiplier:1,dividendYield:p};this.quotation=e.observable(b),this.quotationDependency=e.computed(function(){return g.type(),g.expiry(),g.strikePrice(),g.type()!==n.SECURITY?i.optionChains.get(g.ulCode).done(function(t){var n=t.findRow(g.strikePrice(),g.expiry());if(typeof n=="undefined"){var r=t.strikeListExpiry(g.expiry());g.strike(r[0]),n=t.findRow(g.strike(),g.expiry())}var i;g.callPutFlag()?i=n.callOption:i=n.putOption;var s=i.latestTradedPrice()==0?i.previousSettlementPrice:i.latestTradedPrice,o={code:i.optionNumber,last:s,bid:i.bid,ask:i.ask,volume:i.volume,openInterest:i.openInterest,impliedVolatility:i.greeks&&i.greeks.sigma||e.observable(0),multiplier:n.premiumMultiplier,dividendYield:p};g.quotation(o)}):i.quotation.get(g.ulCode).done(function(e){g.quotation({code:e.securityCode,last:e.lastPrice,bid:e.currentBidPrice,ask:e.currentAskPrice,volume:b.volume,openInterest:b.openInterest,impliedVolatility:b.impliedVolatility,multiplier:1,dividendYield:p})}),null},this),this.price=e.computed(function(){return g.quotation()?g.buySellFlag()?g.quotation().ask()||g.quotation().last():g.quotation().bid()||g.quotation().last():null},this),this.sellPrice=e.computed(function(){return g.quotation()?g.buySellFlag()?g.quotation().bid()||g.quotation().last():g.quotation().ask()||g.quotation().last():null},this),this.payoff=function(e,t,n){t=typeof t=="undefined"?0:t;var r=g.bsPrice(e,t,n);return g.costBasis()!=null?r-g.costBasis():r-g.price()},this.d1=function(e,t,n){n=n||g.quotation().impliedVolatility();var r=g.quotation().dividendYield,i=Math.log(e/g.strikePrice())+(h()-r+n*n*.5)*t;return i/=n*Math.sqrt(t),i},this.d2=function(e,t,n,r){n=n||g.quotation().impliedVolatility();var i=g.quotation().dividendYield;r=r||g.d1(e,t,h(),n,i);var s=r-n*Math.sqrt(t);return s},this.bsPrice=function(e,t,r){if(t<=0||g.type()===n.SECURITY)switch(g.type().toUpperCase()){case n.CALL:return Math.max(0,e-g.strikePrice());case n.PUT:return Math.max(0,g.strikePrice()-e);case n.SECURITY:default:return e}var i;r=r||g.quotation().impliedVolatility();var s=g.quotation().dividendYield,o=g.d1(e,t,r),u=g.d2(e,t,r,o);switch(g.type()){case n.CALL:i=e*Math.exp(-s*t)*c._cdf(o)-g.strikePrice()*Math.exp(-h()*t)*c._cdf(u);break;case n.PUT:i=g.strikePrice()*Math.exp(-h()*t)*c._cdf(-u)-e*Math.exp(-s*t)*c._cdf(-o);break;default:return 0}return i},this.delta=function(e,t,r){if(g.type()===n.SECURITY)return 1;r=r||g.quotation().impliedVolatility();var i=g.quotation().dividendYield,s=g.d1(e,t,r);switch(g.type()){case n.CALL:return Math.exp(-i*t)*c._cdf(s);case n.PUT:return Math.exp(-i*t)*-c._cdf(-s);default:return 0}},this.gamma=function(e,t,r){if(g.type()===n.SECURITY)return 0;r=r||g.quotation().impliedVolatility();var i=g.quotation().dividendYield,s=g.d1(e,t,r);return Math.exp(-i*t)*c._pdf(s)/(e*r*Math.sqrt(t))},this.vega=function(e,t,r){if(g.type()===n.SECURITY)return 0;r=r||g.quotation().impliedVolatility();var i=g.quotation().dividendYield,s=g.d1(e,t,r);return e*Math.exp(-i*t)*c._pdf(s)*Math.sqrt(t)/100},this.theta=function(e,t,r){if(g.type()===n.SECURITY)return 0;r=r||g.quotation().impliedVolatility();var i=g.quotation().dividendYield,s=g.d1(e,t,r),o=g.d2(e,t,r,s),u=0;switch(g.type()){case n.CALL:u-=e*Math.exp(-i*t)*c._pdf(s)*r/(2*Math.sqrt(t)),u-=h()*g.strikePrice()*Math.exp(-h()*t)*c._cdf(o),u+=i*e*Math.exp(-i*t)*c._cdf(s);break;case n.PUT:u-=e*Math.exp(-i*t)*c._pdf(s)*r/(2*Math.sqrt(t)),u+=h()*g.strikePrice()*Math.exp(-h()*t)*c._cdf(-o),u-=i*e*Math.exp(-i*t)*c._cdf(-s);break;default:return 0}return u/365},this.rho=function(e,t,r){if(g.type()===n.SECURITY)return 0;r=r||g.quotation().impliedVolatility();var i=g.d1(e,t,r),s=g.d2(e,t,r,i),o;switch(g.type()){case n.CALL:o=g.strikePrice()*t*Math.exp(-h()*t)*c._cdf(s);break;case n.PUT:o=-g.strikePrice()*t*Math.exp(-h()*t)*c._cdf(-s);break;default:return 0}return o}},b=function(r,c){function E(){var e=null,t=h.extractedPositions();if(t.length==2){var n=t.filter(function(e){return e.legType==d})[0],r=t.filter(function(e){return e.legType==v})[0];n&&r&&n.quantity>0&&r.quantity<0&&n.quantity/h.multiplier()>=-r.quantity&&(e={strategyName:"Covered Call",absQuantity:-r.quantity},n.ownedQuantity/h.multiplier()>=-r.quantity?e.buyOrSell="Sell":e.buyOrSell="Buy")}return e}function S(e,t){if(!e||!t||typeof e.getTime!="function")return 0;if(s.compareDates(e,t)===0)return 0;var n=(t.getTime()-e.getTime())/31536e6;return n}function x(e,t,n,r,i){t=t==null?h.stockLastPrice():t,n=n||(i?h.expiration():new Date);var s=0;return h.positions().forEach(function(i){var o=i.expiry(),u=S(n,o);s+=i[e].call(i,t,u,r)*i.quantity()*i.quotation().multiplier}),s}function T(e,t){return function(n,r,i){return x(e,n,r,i,t)}}function N(e){return function(){var t=e();return t==="Unlimited"?"无限":s.toFractionalCurrency(Math.abs(t))}}var h=this;f.call(this),h.ready=u.Deferred(),this.ulCode=r,this.stockPriceLowerBound=e.observable(0),this.stockPriceHigherBound=e.observable(100),this.stockLastPrice=e.observable(50),this.chartPriceRangeReady=e.observable(!1),this.outlookPriceLowerBound=e.observable(0),this.outlookPriceHigherBound=e.observable(0),this.outlookBoundChangedFlag=e.observable(!1),this.outlookBoundChanged=function(){h.outlookBoundChangedFlag(!h.outlookBoundChangedFlag())},this.positions=e.observableArray(),this.originalLegs=[],h.initCombination=function(){h.addPosition=function(e,t,n,r,i,s){var o=new y(h.ulCode,e,t,n,r,i,s,h.chain);return h.positions.push(o),h},h.removePosition=function(e){for(var t in e)e.hasOwnProperty(t)&&typeof e[t].dispose=="function"&&e[t].dispose();h.positions.remove(e)},h.initPositions=function(e,t){if(e&&e.length){u.each(e,function(e,n){t&&h.originalLegs.push({buyOrSell:n.buyOrSell,quantity:n.quantity,legType:n.legType,expiry:n.expiry,strikePrice:n.strikePrice,costBasis:n.costBasis})});var n=e.map(function(e){return new y(h.ulCode,e.buyOrSell,e.quantity,e.legType,e.expiry,e.strikePrice,e.costBasis,h.chain)});h.positions(n),h.updateStockPriceRange()}},h.multiplier=h.computed(function(){var e=h.positions().map(function(e){return e.quotation().multiplier}),t=Math.max.apply(this,e);return t||1}),h.extractedPositions=h.computed(function(){return o.extractPositions(h)}),h.matchedTemplate=h.computed(function(){var e=o.combinationEigenvalue(h),n=t.templateMap[e];return n||null}),h.buyOrSell=h.computed(function(){var e=E();return e?e.buyOrSell:h.matchedTemplate()?h.matchedTemplate().buyOrSell:n.BUY}),h.absQuantity=e.computed({read:function(){var e=h.extractedPositions().map(function(e){return Math.abs(e.quantity)}),t=Math.min.apply(h,e);if(!isFinite(t)||isNaN(t))t=0;var n=1;for(var r=2;r<=t;r++){var i=!0;for(var s=0;s<e.length;s++)e[s]%r!==0&&(i=!1);i&&(n=r)}return n},write:function(e){e=parseInt(e);if(e<1)return;var t=h.absQuantity();h.positions().forEach(function(n){var r=n.absQuantity();n.absQuantity(parseInt(r*e/t))})}},h).extend({rateLimit:0}),h.quantityDisplayed=this.computed(function(){return h.absQuantity()===1&&h.extractedPositions().length===1&&h.extractedPositions()[0].legType!==d?"":h.absQuantity()}),this.expiry=e.observable(null),this.expiration=h.computed(function(){var e=h.expiry();return e||h.chain&&(e=h.chain.findExpiry(new Date,0,b.defaultDays||0).date),e}),h.expiries=e.computed(function(){h.expiry(null);var e=h.extractedPositions().map(function(e){if(e.type.toUpperCase()===n.SECURITY)return null;a.activeLocale();if(!h.expiry()||e.expiry.getTime()<h.expiry().getTime())h.expiry(e.expiry),h.updateStockPriceRange();return e.expiry});return o.uniqueArray(e.filter(function(e){return e!=null}))},h),h.strikes=e.computed(function(){var e=h.extractedPositions().map(function(e){return e.type.toUpperCase()===n.SECURITY?null:e.strikePrice});return e=o.uniqueArray(e.filter(function(e){return e!=null})),e.sort(function(e,t){return e-t})},h),h.strategyName=e.computed(function(){var e=E();return e?e.strategyName:h.matchedTemplate()?h.matchedTemplate().template.name.replace("Stock",h.absQuantity()==1?"Share":"Shares"):"Custom Strategy"},h),h.expiriesStrikes=this.computed(function(){var e=h.expiries().map(function(e){var t=s.formatDate(e,"MMM");return t}).join("/"),t=h.strikes().join("/");return e+" "+t}),h.summary=e.computed(function(){return JSON.stringify(h.extractedPositions())},h).extend({rateLimit:1}),h.updateStockPriceRange=function(){i.quotation.get(h.ulCode).done(function(){i.standardDeviations.get(h.ulCode).done(function(e){var t=h.expiry(),n=e.getStdDevsByExpiry(t);if(n){var r=n.stdDevPrices;h.stockPriceLowerBound(r[1]),h.stockPriceHigherBound(r[4])}else i.quotation.get(h.ulCode).done(function(e){var t=e.lastPrice();h.stockPriceLowerBound(t*.25),h.stockPriceHigherBound(t*1.25)});h.chartPriceRangeReady(!0)})})},h.initPositions(c,!0),h.payoff=T("payoff",!0),h.delta=T("delta"),h.gamma=T("gamma"),h.vega=T("vega"),h.theta=T("theta"),h.rho=T("rho"),h.defaultGreeks={delta:h.deferredComputed(function(){return h.delta()}),gamma:h.deferredComputed(function(){return h.gamma()}),theta:h.deferredComputed(function(){return h.theta()}),vega:h.deferredComputed(function(){return h.vega()})},h.breakevenDisplayed=e.observable(),h.breakeven=this.computed(function(){h.extractedPositions();var e=h.strikes().slice(0);e.unshift(.01),e.push(h.stockLastPrice()*10);var t=[],n=h.expiries().length<=1,r=h.expiry();for(var i=1;i<e.length;i++){var o=e[i],u=e[i-1]||.01,a=h.payoff(u,r),f=h.payoff(o,r);if(a*f<0){var c;if(n){var p=(f-a)/(o-u);c=u-a/p}else{var d=(u+o)/2,v=h.payoff(d,r),m=u,g=o;while(g-m>.01){if(v*a<0)g=d;else{if(!(v*f<0))break;m=d}d=(m+g)/2,a=h.payoff(m,r),f=h.payoff(g,r),v=h.payoff(d,r)}c=d}t.push(s.roundNumber(c))}else f==0?t.push(s.roundNumber(o)):a==0&&t.push(s.roundNumber(u))}var y=h.stockPriceLowerBound.peek(),b=h.stockPriceHigherBound.peek();t=t.filter(function(e){return e>=y&&e<=b}),t=l.uniqueArray(t);var w=t.map(function(e){return s.toFractionalCurrency(e)}).join(", ");return h.breakevenDisplayed(w),t},h),h.breakevenDesc=e.observable(""),h.breakevenLabel=this.computed(function(){var e=h.breakeven().length;return e<=1?"Breakeven: ":e===2?"Breakevens: ":"B/E: "},h),h.sentimentProfile=e.observable(""),h.sentiment=e.computed(function(){var e=h.payoff(.1),t=h.payoff(h.highSpotBound),n=h.breakeven().length===2?h.payoff((h.breakeven()[0]+h.breakeven()[1])/2):0;return e>1&&t>1?"sharp-move":e>=1&&t<1?"bearish":e<1&&t>=1?"bullish":n>=1?"neutral":"unknown"},h),h.sentiments=e.computed(function(){var e=h.matchedTemplate();return e?e.buyOrSell==n.BUY?[e.template.buyDetails.firstSentiment,e.template.buyDetails.secondSentiment,e.template.buyDetails.thirdSentiment]:[e.template.sellDetails.firstSentiment,e.template.sellDetails.secondSentiment,e.template.sellDetails.thirdSentiment]:[]},h),h.sentiments=this.computed(function(){var e=h.stockLastPrice(),t=[],n=h.payoff(.1),r=h.payoff(h.highSpotBound),i=h.breakeven(),o=i.length===2?h.payoff((i[0]+i[1])/2,h.expiration()):0;o=i.length===4?h.payoff((i[1]+i[2])/2,h.expiration()):o;var u=h.expiration(),f=h.stdDev.getStdDevsByExpiry(u);return f=f&&f.stdDevPrices,i.length===2&&n>1&&r>1?(t.push("sharp-move"),Math.min.apply(this,i)>=e?h.sentimentProfile("bearish sharp-move"):Math.max.apply(this,i)<=e?h.sentimentProfile("bullish sharp-move"):h.sentimentProfile("sharp move"),h.breakevenDesc("低于"+s.toFractionalCurrency(i[0])+"或高于"+s.toFractionalCurrency(i[1]))):n>=1&&r<1?(t.push("bearish"),f?e-i[0]<=(e-f[2])*.75?h.sentimentProfile("bearish"):h.sentimentProfile("very bearish"):h.sentimentProfile("bearish"),h.breakevenDesc("低于"+s.toFractionalCurrency(i[0]))):n<1&&r>=1?(t.push("bullish"),f?i[0]-e<=(f[3]-e)*.75?h.sentimentProfile("bullish"):h.sentimentProfile("very bullish"):h.sentimentProfile("bullish"),h.breakevenDesc("高于"+s.toFractionalCurrency(i[0]))):o>=1&&(t.push("neutral"),Math.min.apply(this,i)>=e?h.sentimentProfile("bullish neutral"):Math.max.apply(this,i)<=e?h.sentimentProfile("bearish neutral"):h.sentimentProfile("neutral"),h.breakevenDesc("介于"+s.toFractionalCurrency(i[0])+"到"+s.toFractionalCurrency(i[1])+"之间")),h.sentimentProfile(a.localize("strategies."+h.sentimentProfile())),t},h),h.riskProfile=e.observable(),h.rewardProfile=e.observable(),h.riskDesc=e.observable(),h.rewardDesc=e.observable(),h.maxRisk=h.computed(function(){var e=h.payoff(.1),t=h.payoff(.2),n=h.payoff(h.highSpotBound),r=h.payoff(h.highSpotBound+.1);if(r-n<-0.5&&r<.01)return h.riskProfile("无限"),h.riskDesc("无限损失"),"Unlimited";if(e-t<-0.01&&e<-0.01){h.riskProfile("实质");var i=h.payoff(0);return h.riskDesc("实质损失"+s.toIntCurrency(Math.abs(i))),i}h.riskProfile("有限");var o=h.strikes().slice(0);o.push(0),o.push(h.highSpotBound);var u=o.map(function(e){return h.payoff(e)});u.push(0);var a=Math.abs(Math.min.apply(this,u));return h.riskDesc("有限损失"+s.toIntCurrency(Math.abs(a))),a}),h.maxReward=h.computed(function(){var e=h.payoff(.1),t=h.payoff(.2),n=h.payoff(h.highSpotBound),r=h.payoff(h.highSpotBound+.1);if(r-n>.5&&r>.01)return h.rewardProfile("无限"),h.rewardDesc("无限收益"),"Unlimited";if(e-t>.01&&e>.01){h.rewardProfile("实质");var i=h.payoff(0);return h.rewardDesc("实质收益"+s.toIntCurrency(i)),i}h.rewardProfile("有限");var o=h.strikes().slice(0);o.push(0),o.push(h.highSpotBound);var u=o.map(function(e){return h.payoff(e)});u.push(0);var a=Math.max.apply(this,u);return h.rewardDesc("有限收益"+s.toIntCurrency(a)),a}),h.maxRewardDisplayed=h.computed(N(this.maxReward)),h.maxRiskDisplayed=h.computed(N(this.maxRisk)),h.rr=e.computed(function(){return h.riskProfile()=="无限"||h.rewardProfile()=="无限"?"N/A":s.toFractionalString(Math.abs(h.maxReward()/h.maxRisk()))},h).extend({rateLimit:0}),h.ask=e.computed(function(){var e=0;return h.positions().forEach(function(t){e+=t.price()*t.quantity()}),e/h.absQuantity()},h).extend({rateLimit:0}),this.bid=e.computed(function(){var e=0;return h.positions().forEach(function(t){e+=t.sellPrice()*t.quantity()}),e/h.absQuantity()},h).extend({rateLimit:0}),h.currentPrice=e.computed(function(){var e=0;return h.positions().forEach(function(t){e+=t.price()*t.quantity()*t.quotation().multiplier}),e},h).extend({rateLimit:0}),h.askPrice=h.computed(function(){var e=Math.max(Math.abs(h.ask()),Math.abs(h.bid()));return e}),h.bidPrice=h.computed(function(){var e=Math.min(Math.abs(h.bid()),Math.abs(h.ask()));return e}),h.midPrice=h.computed(function(){var e=(h.askPrice()+h.bidPrice())/2;return e}),h.cost=e.computed(function(){var e=0;return h.positions().forEach(function(t){var n=t.costBasis()||t.price();e+=n*t.quantity()*t.quotation().multiplier}),e},h).extend({rateLimit:0}),h.debitOrCredit=e.computed(function(){return h.currentPrice()>0?"debit":"credit"},this).extend({rateLimit:0}),h.costWithoutOwned=h.computed(function(){var e=0;return h.extractedPositions().forEach(function(t){e+=t.price*(t.quantity-t.ownedQuantity)*t.multiplier}),e}),h.whatifValatility=e.observable(),h.fullName=h.computed(function(){var e=a.localize("trade."+h.buyOrSell())+" "+h.absQuantity()+" "+h.ulCode+" "+h.expiriesStrikes()+" "+a.localize("strategies."+h.strategyName());return e.replace(/[ ]+/g," ").trim()}),h.longName=h.computed(function(){return h.fullName().replace("Buy ","").replace("Sell ","")}),h.profitProbVal=h.computed(function(){var e=h.breakeven().slice(0),t=h.expiration(),n=s.daysFromNow(t),r=h.predictions.getProb(n);if(r){e.push(0),e.push(r.prices[r.prices.length-1]*3),e.sort(function(e,t){return e-t});var i=0;for(var o=0;o<e.length-1;o++){var u=(e[o]+e[o+1])/2,a=h.payoff(u,t);a>0&&(i+=r.probBetween(e[o],e[o+1]))}return i}return null}),h.profitProb=h.computed(function(){var e=h.profitProbVal();return typeof e!="number"?"--":(e*=100,e.toFixed(2)+"%")}),h.isCalendar=h.computed(function(){return h.expiries().length>1}),h.daysToExpire=h.computed(function(){var e=h.expiry();if(h.positions().length<1||h.positions().length==1&&h.positions()[0].type()==d||!e)return"N/A";var t=s.daysFromNow(e);return t}),h.openInt=h.computed(function(){var e=0;return h.positions().forEach(function(t){t.type()!==n.LegType.SECURITY&&(e+=t.quotation().openInterest)}),e}),h.volume=h.computed(function(){var e=0;return h.positions().forEach(function(t){t.type()!==n.LegType.SECURITY&&(e+=t.quotation().volume())}),e}),h.hasStock=e.observable(!1),h.hasStxAndOpt=h.computed(function(){var e=!1,t=!1;return u.each(h.positions(),function(r,i){i.type()===n.LegType.CALL||i.type()===n.LegType.PUT?t=!0:i.type()===n.LegType.SECURITY&&(e=!0)}),h.hasStock(e),e&&t}),h.hasOnlyStx=h.computed(function(){var e=!0;return u.each(h.positions(),function(t,r){r.type()!==n.LegType.SECURITY&&(e=!1)}),e}),h.spread=h.computed(function(){var e=h.askPrice(),t=h.bidPrice();return e-t}),h.spreadPercent=h.computed(function(){return(h.spread()/h.askPrice()*100).toFixed(2)+"%"}),h.deltaDetails=h.computed(function(){var e={};if(h.positions().length>0){var t=h.defaultGreeks.delta(),n=h.defaultGreeks.theta();return e.sentiment=h.sentiments().length>0?s.capitaliseFirstLetter(h.sentiments()[0]):"Unknown Sentiment",e.riskProfile=h.riskProfile()+"风险",e.symbol=h.ulCode,e.stockDirection=t>=0?"涨":"跌",t=Math.abs(t),e.deltaAOrAn=s.aOrAn(t),e.formattedDelta=s.toFractionalCurrency(Math.abs(t)),e.dotOrComma=h.matchedTemplate()&&h.matchedTemplate().template.name=="Stock",e.andOrBut=n<0?"但是":"并且",e.lossOrGain=n<0?"损失":"获利",e.formattedTheta=s.toFractionalCurrency(Math.abs(n)),e.breakeventDesc=h.breakevenDesc(),e}return null}),h.opScore=h.deferredComputed(function(){h.outlookBoundChangedFlag();var e=h.outlookPriceLowerBound(),t=h.outlookPriceHigherBound();if(!h.chain)return 100;if(h.outlookLowPercent&&h.outlookLowPercent()){var n=s.daysFromNow(h.expiration()),r=h.predictions.getProb(n);e=r.price(h.outlookLowPercent()),t=r.getSymmetricPrice(e)}var i=h.strikes().filter(function(n){return n>=e&&n<=t});i.push(e),i.push(t);var o=i.map(function(e){return h.payoff(e,h.expiration())}),u=Math.min.apply(h,o);u=u>0?0:Math.abs(u);var a=Math.max.apply(h,o);a=a<0?0:a;var f=a!=0&&u!=0?(1+a/u)*h.profitProbVal()*100:a==0?0:100;return f>200?200:f}).extend({rateLimit:100}),h.opScoreCssClass=h.deferredComputed(function(){var e=Math.round(h.opScore());return e>=100?"good":e>=80?"not-bad":"poor"}),h.opScoreFormatted=h.deferredComputed(function(){var e=h.opScore().toFixed(0);return e}),h.opScoreExplanation=h.deferredComputed(function(){var e=Math.round(h.opScore());return e>=100?"Good":e>=80?"Not Bad":"Poor"}),h.extransicValue=h.computed(function(){var e=0;return h.strategyName().match(/put/i)?e=h.extractedPositions()[0].price:h.strategyName().match(/covered call/i)&&h.extractedPositions().length==2&&(e=h.extractedPositions()[1].price),e}),h.rawReturn=h.computed(function(){var e=h.extransicValue();if(e>0){var t=e/h.quote.last();t*=100;if(!isNaN(t))return t}return 0}),h.annualizedReturn=h.computed(function(){var e=h.extransicValue(),t=h.quote.last()?h.quote.last():1;if(e>0){var n=e/t;n=n/(h.daysToExpire()/365)*100;if(!isNaN(n))return n}return 0}),h.worthlessProb=h.computed(function(){if(h.strategyName().match(/covered call/i)){var e=s.daysFromNow(h.expiration()),t=h.predictions.getProb(e);return t.prob(h.strikes()[0])}return h.strategyName().toUpperCase()==="PUT"&&h.buyOrSell().toUpperCase()==="SELL"?(e=s.daysFromNow(h.expiration()),t=h.predictions.getProb(e),1-t.prob(h.strikes()[0])):0}),h.returnSentence=h.computed(function(){var e=h.annualizedReturn(),t="",n=null;e=e.toFixed(2)+"%";var r=h.extractedPositions(),i=0,o=null;for(;i<r.length;i++)if(r[i].legType!=d&&r[i].quantity<0){o=r[i];break}if(o){var u=Math.abs(o.price*o.quantity*o.multiplier);n={},n.expiry=o.expiry,n.strike=o.strikePrice,n.type=o.legType+(Math.abs(o.quantity)>1?"S":""),n.premium=u,n.quantityDesc=Math.abs(o.quantity)>1?". ":" for each contract sold. ",n.aOrAn=s.aOrAn(h.annualizedReturn()),n.annualizedReturn=e,n.anOrAnProb=s.aOrAn(parseFloat(h.worthlessProb()*100)),n.pow=s.roundNumber(h.worthlessProb()*100),t+="Selling the <b>"+s.formatDate(o.expiry)+" "+s.toFractionalCurrency(o.strikePrice)+" "+o.legType+(Math.abs(o.quantity)>1?"S":"")+"</b>",t+=" will generate <b>"+s.toFractionalCurrency(u)+"</b> in premium"+(Math.abs(o.quantity)>1?". ":" for each contract sold. "),t+="They  produce "+s.aOrAn(h.annualizedReturn())+" <b>"+e+"</b> annualized return and based on historical volatility have "+s.aOrAn(parseFloat(h.worthlessProb()*100))+" ",t+="<b>"+s.roundNumber(h.worthlessProb()*100)+"%</b> chance of expiring worthless."}return t}),h.width=h.computed({read:function(){if(!h.expiry())return 0;var e,t;switch(h.strikes().length){case 2:e=h.strikes()[0],t=h.strikes()[1];break;case 4:e=h.strikes()[1],t=h.strikes()[2];break;default:return 0}var n=h.chain.strikeListExpiry(h.expiry()),r=0;return n&&n.forEach(function(n){e<=n&&n<t&&r++}),r}}),h.wingspanLeft=h.computed({read:function(){if(!h.expiry())return 0;var e,t;switch(h.strikes().length){case 3:case 4:e=h.strikes()[0],t=h.strikes()[1];break;default:return 0}var n=h.chain.strikeListExpiry(h.expiry()),r=0;return n&&n.forEach(function(n){e<=n&&n<t&&r++}),r}}),h.wingspanRight=h.computed({read:function(){if(!h.expiry())return 0;var e,t;switch(h.strikes().length){case 3:e=h.strikes()[1],t=h.strikes()[2];break;case 4:e=h.strikes()[2],t=h.strikes()[3];break;default:return 0}var n=h.chain.strikeListExpiry(h.expiry()),r=0;return n&&n.forEach(function(n){e<=n&&n<t&&r++}),r}}),h.canCustomizeWidth=h.computed(function(){var e=h.matchedTemplate()&&h.matchedTemplate().template.canCustomizeWidth;return e}),h.canShrinkWidth=h.computed(function(){var e=h.matchedTemplate()&&h.matchedTemplate().template.canCustomizeWidth;return e&&h.width()>1}),h.canExpandWidth=h.computed(function(){var e=h.matchedTemplate()&&h.matchedTemplate().template.canCustomizeWidth;if(e&&h.expiry()){var t=h.strikes(),n=h.chain.strikeListExpiry(h.expiry());return n.indexOf(t[0])==0&&n.indexOf(t[t.length-1])==n.length-1?!1:!0}return e}),h.canCustomizeWingspan=h.computed(function(){var e=h.matchedTemplate()&&h.matchedTemplate().template.canCustomizeWingspan;return e}),h.canShrinkWingspan=h.computed(function(){var e=h.canCustomizeWingspan();return e&&(h.wingspanLeft()>1||h.wingspanRight()>1)}),h.canExpandWingspan=h.computed(function(){var e=h.canCustomizeWingspan(),t=h.extractedPositions();return e&&h.expiry()?(t.forEach(function(t){var n=t.expiry;if(n){var r=t.strikePrice,i=h.chain.strikeListExpiry(n);if(i.indexOf(r)==0||i.indexOf(r)==i.length-1)e=!1}}),e):e});var r=h.dispose;h.dispose=function(){for(var e=0;e<h.positions();e++)h.positions()[e].dispose();r()},h.ready.resolve()};var p=i.quotation.get(h.ulCode),m=i.standardDeviations.get(h.ulCode),g=i.predictions.get(h.ulCode),w=i.optionChains.get(this.ulCode);u.when(p,m,g,w).done(function(e,t,n,r){typeof e.last=="undefined"&&(e.last=e.lastPrice),h.quote=e,h.stockLastPrice=e.lastPrice,h.highSpotBound=e.last()*10,h.stdDev=t,h.predictions=n,h.chain=r,h.initCombination()})};return b}),define("modules/strategyHelpers",["knockout","modules/enums","dataContext","modules/combinationViewModel","modules/formatting","modules/strategyTemplates","jstat"],function(e,t,n,r,i,s){var o=t.LegType.SECURITY,u=t.BuyOrSell.BUY,a=t.BuyOrSell.SELL,f=function(){function e(e,t,n,i,s,o){var u=e.legs.map(function(e){return{buyOrSell:e.buyOrSell.toUpperCase(),legType:e.legType.toUpperCase(),expiry:e.expirationDate?new Date(e.expirationDate.futureDate):null,strikePrice:e.strikePrice,quantity:e.quantity}}),a=new r(n.symbol,u,t,n,i,s,o);return a.tradingStrategy=e,a}function t(t,n,r,i,s,o,u){var a=0,f=null;u&&(a=u.shares,f=u.costBasis),a=a||100;var l=Math.floor(a/100)||1,c={strategyName:t.legType,fullStrategyName:"Sell "+t.legType,buyOrSell:t.legType.match(/call/i)?"Buy":"Sell",legs:[{legType:t.legType,buyOrSell:"Sell",strikePrice:t.strike,quantity:l,expirationDate:{expiration:t.expiry}}]};t.legType=="Call"&&(c.legs.push({legType:"Security",buyOrSell:"Buy",strikePrice:null,quantity:a,expirationDate:null}),c.strategyName="Covered Call",c.fullStrategyName="Buy Covered Call");var h=e(c,n,r,i,s,o);if(f!==null&&t.legType=="Call"){var p=h.positions()[1];p.costBasis(f),p.isOwned(!0)}return h.incomeStrategy=t,h.originalShares=u.shares,h}function n(e){var t=parseFloat(e.spreadPercent());return t<10?"mid-price":e.buyOrSell().match(/buy/i)?"bid-price":"ask-price"}function s(e){var t=[];return t;var n,r,g,y,b,w}function f(e,t,n,r,i,s){var f=t.toUpperCase()===u,l=[];for(var c=0;c<e.length;c++){var h=e[c],p=s.findExpiry(n,h.expiry,0,r).date,d=s.findStrike(i.last(),p,h.strike,r),v=h.buyOrSell.toUpperCase()===u,m=h.quantity,g=s.findRow(d,p,r);h.legType.toUpperCase()==o&&(m=m*g.callPremiumMult/100);var y={buyOrSell:f^v?a:u,quantity:m,legType:h.legType,expiry:p,strikePrice:d};l.push(y)}return l}function l(e,t,n,r,i,s){var o=f.apply(this,arguments);for(var u=1;u<o.length;u++){var a=o[u],l=o[u-1],c=e[u],h=e[u-1],p=c.strike-h.strike,d=a.strikePrice-l.strikePrice;Math.sign(p)!=Math.sign(d)&&(a.strikePrice=s.findStrike(l.strikePrice,a.expiry,p,r));if(p==0&&d>.001){var v=s.strikeListExpiry(a.expiry,r),m=s.strikeListExpiry(l.expiry,r),g=v.filter(function(e){return m.indexOf(e)!=-1});a.strikePrice=l.strikePrice=s.findStrike(l.strikePrice,null,0,r,g)}}return o}function c(e,t,n,i,s,o,u){var a=s.findExpiry(e.expiration(),-1,0,n).date,f=l(t.template.legs,t.buyOrSell,a,n,i,s,o,u),c=new r(i.symbol,f,n,i,s,o,u),h=c.matchedTemplate();return c.dispose(),h&&h.displayedName==t.displayedName?(e.initPositions(f),!0):!1}function h(e,t){if(e.canCustomizeWidth()){var n=e.extractedPositions(),r=[];switch(n.length){case 2:n[0].quantity*n[1].quantity<0?n[0].quantity<0?(r.push(n[0]),e.lastHigherChanged=!1):(r.push(n[1]),e.lastHigherChanged=!0):e.lastHigherChanged?(r.push(n[0]),e.lastHigherChanged=!1):(r.push(n[1]),e.lastHigherChanged=!0);break;case 3:case 4:e.lastHighersChanged?(r.push(n[0]),r.push(n[1]),e.lastHighersChanged=!1):(r.push(n[n.length-2]),r.push(n[n.length-1]),e.lastHighersChanged=!0);break;default:}var s=0;t?e.canExpandWidth()&&(r.length==1?s=e.lastHigherChanged?1:-1:s=e.lastHighersChanged?1:-1):e.canShrinkWidth()&&(r.length==1?s=e.lastHigherChanged?-1:1:s=e.lastHighersChanged?-1:1),s&&(s>0&&r.reverse(),r.forEach(function(t){e.positions().forEach(function(n){if(n.expiry()&&n.strike()==t.strikePrice&&i.sameDate(n.expiry(),t.expiry)){var r=e.chain.findStrike(t.strikePrice,t.expiry,s,e.optionType);n.strike(r)}})}))}}function p(e,t){if(t&&e.canExpandWingspan()||!t&&e.canShrinkWingspan()){var n=e.strikes().filter(function(e){return typeof e=="number"}),r=Math.min.apply(self,n),s=Math.max.apply(self,n),o=e.extractedPositions().filter(function(e){return e.strikePrice==r||e.strikePrice==s});o.sort(function(e,t){return e.strikePrice-t.strikePrice}),o.forEach(function(n){var o=0;n.strikePrice==r&&(o=t?-1:1),n.strikePrice==s&&(o=t?1:-1),e.positions().forEach(function(t){if(t.expiry()&&t.strike()==n.strikePrice&&i.toExpiryKey(t.expiry())==i.toExpiryKey(n.expiry)){var r=e.chain.findStrike(n.strikePrice,n.expiry,o,e.optionType);t.strike(r)}})})}}this.assembleCombination=e,this.assembleIncomeCombination=t,this.getRecommendedPrice=n,this.checkCombination=s,this.buildCombinationLegs=l,this.changeWidth=h,this.changeWingspan=p,this.rebuildCombination=c};return new f}),define("modules/combinationChart",["knockout","modules/formatting","modules/combinationHelpers","modules/combinationViewModel","modules/localizer","modules/enums","modules/disposableViewModel","highstock"],function(e,t,n,r,i,s,o){var u="red",a="green",f=0,l=function(e,t){this.filledArea=0,this.name=e,this.area=t,this.isSuitable=!0},c=function(n,r){function h(e){var t=c.combination.strikes().slice(0),n=t[0],r=c.stockPriceHigherBound(),i=c.stockPriceLowerBound(),s=[],o=[],u=c.combination.expiry();if(n===undefined){var a=c.combination.payoff(i,u),l=c.combination.payoff(r,u),h=(l-a)/(r-i);n=i-a/h;var p=r-i;Math.abs(n-i)>Math.abs(n-r)?r=n+.5*p:i=n-.5*p}else n<i?(i=n-(r-n)*.6,r+=(r-n)*.6):n>r&&(i-=(n-i)*.6,r=n+(n-i)*.6);i<0&&(i=0),t.push(i),t.push(r),t.sort(function(e,t){return e-t});var d=[];for(var v=1;v<t.length;v++){var m=t[v],g=t[v-1]||0,y=(m-g)/c.noOfPoints(),a=c.combination.payoff(g,u),l=c.combination.payoff(m,u),b=y*(l-a)/(m-g),w=0,E;while((E=g+y*w)<m){var S=a+b*w++;s.push([E,S]),o.push([E,c.combination.payoff(E,c.whatIfDateTime(),c.whatIfVolatility())])}d.push(c.combination.payoff(m,c.whatIfDateTime(),c.whatIfVolatility())),s.push([m,l]),o.push([m,c.combination.payoff(m,c.whatIfDateTime(),c.whatIfVolatility())])}d.sort(function(e,t){return Math.abs(e)-Math.abs(t)}),f=Math.abs(d[d.length-1])*1.5||100,c.combination.expiries().length>1&&(s=o,o=[]),c.terminalPayoffPoints(s),c.whatIfPayoffPoints(o)}function p(){function m(e){return e.y>0?e.x<n?d[0]:d[1]:e.x<n?d[2]:d[3]}function k(t,n,r){var s=Math.abs((i.max-t.y)/N);s<e&&(d[n].isSuitable=!1),1-s<e&&(d[r].isSuitable=!1)}var e=.3,t=c.chart;if(!t||!t.series||!t.series[0])return null;var n=c.stockLastPrice.peek(),r=t.axes[0],i=t.axes[1],o=n-r.min,u=r.max-n,a=Math.abs(o*i.max),f=Math.abs(u*i.max),h=Math.abs(u*i.min),p=Math.abs(o*i.min),d=[new l(s.Quadrant.TOP_LEFT,a),new l(s.Quadrant.TOP_RIGHT,f),new l(s.Quadrant.BOTTOM_LEFT,p),new l(s.Quadrant.BOTTOM_RIGHT,h)],v=t.series[0].points;if(v.length<1)return null;for(var g=0;g<v.length-1;g++){var y=v[g],b=v[g+1],w=Math.abs(b.x-y.x),E=(y.y+b.y)/2,S=Math.abs(E),x=w*S,T=m(y);T.filledArea+=x}var N=Math.abs(i.max-i.min),C=Math.abs(i.max/N);C<e?d[0].isSuitable=d[1].isSuitable=!1:C>1-e&&(d[2].isSuitable=d[3].isSuitable=!1),k(v[0],0,2),k(v[v.length-1],1,3);var L=d.filter(function(e){return e.isSuitable});return L}function v(){var e=c.freeQuadrants(),t=Math.min.apply(Math,e.map(function(e){return e.filledArea})),n=e.filter(function(e){return e.filledArea===t}),r=n[0];for(var i=1;i<n.length;i++)n[i].area>r.area&&(r=n[i]);return r&&r.name}var c=this;o.call(this),this.combination=n,this.stockPriceLowerBound=n.stockPriceLowerBound,this.stockPriceHigherBound=n.stockPriceHigherBound,this.stockLastPrice=n.stockLastPrice,this.chartPriceRange=e.observableArray([n.stockPriceLowerBound(),n.stockPriceHigherBound()]),this.chartPriceRangeReady=n.chartPriceRangeReady,this.whatIfDateTime=e.observable(new Date),this.whatIfVolatility=e.observable(null),this.noOfPoints=e.observable(r||200),this.terminalPayoffPoints=e.observableArray([]),this.whatIfPayoffPoints=e.observableArray([]),this.freeQuadrants=e.observableArray();var d=e.observable();this.freeChosenQuadrandName=this.computed({read:function(){var e=d()||v();return e},write:function(e){var t=c.freeQuadrants().some(function(t){return t.name===e});t?d(e):d(v())}}),this.chartOptions=e.computed(function(){var e=c.terminalPayoffPoints(),n=c.whatIfPayoffPoints(),r=c.combination.stockLastPrice(),s=c.stockPriceLowerBound(),o=c.stockPriceHigherBound(),l=c.chartPriceRange()[0],h=c.chartPriceRange()[1],p=o-s,d=l-s,v=h-s,m=u,g=a;return{chart:{alignTicks:!1,spacingLeft:5,spacingRight:5,spacingTop:10,spacingBottom:5,zoomType:"x",animation:!1,borderWidth:0,resetZoomButton:{relativeTo:"chart"}},plotOptions:{area:{marker:{enabled:!1},shadow:!1,states:{hover:{lineWidth:2}},threshold:0},line:{shadow:!1}},title:{text:""},legend:{enabled:!1},xAxis:[{plotLines:[{color:c.combination.payoff(r)>0?u:a,width:1,value:r}],labels:{enabled:!0}}],yAxis:[{title:{text:null},labels:{align:"left",enabled:!1,formatter:function(){return t.toFractionalString(this.value)},x:0,y:-2},showFirstLabel:!0,max:f,min:-f,plotLines:[{color:"#000000",width:2,value:0,zIndex:1}]}],tooltip:{crosshairs:!0,enabled:!0,formatter:function(){var e=i.localize("strategies.underlyingPrice")+": <b>"+t.toFractionalCurrency(this.x)+"</b><br>";return e+=i.localize("strategies.terminalPL")+t.toFractionalCurrency(this.points[0].y)+"<br>",this.points[1]&&(e+=i.localize("strategies.whatIfPL")+t.toFractionalCurrency(this.points[1].y)+"<br>"),e},shared:!0},series:[{type:"area",name:"Terminal PL",data:e,zIndex:50,marker:{enabled:!1,states:{hover:{enabled:!1}}},lineColor:"#0033CC",lineWidth:1,showInLegend:!1,fillColor:m,negativeFillColor:g,animation:!1},{type:"line",name:"What-If PL",data:n,zIndex:95,marker:{enabled:!1},lineColor:"rgb(40, 70, 120)",lineWidth:1.5,showInLegend:!1,animation:!1}],credits:{enabled:!1}}}).extend({rateLimit:0}),this.destroyChart=function(){c.chart&&(typeof c.chart.destroy=="function"&&c.chart.destroy(),c.chart=null)},this.destroy=function(){c.destroyChart(),c.chartOptions.dispose()};var m=this.dispose;this.dispose=function(){c.destroy(),c.chartPriceRange=null,m()},this.renderChartTo=function(e){h();var t=c.chartOptions();e=e||c.element,t.chart.renderTo=e,c.destroyChart(),c.chart=new Highcharts.Chart(t),c.element=e,c.freeQuadrants(p())},this.updateChart=function(){if(c.chart){var e=Date.now();h(),c.chartOptions().series.forEach(function(e,t){c.chart.series[t].update(e,!1,!1,!1)}),c.chart.redraw(),c.freeQuadrants(p())}}};return{createChartViewModel:function(e,t){var n=new c(e,t);return n},createChartViewModelExpanded:function(e,t){var n=new c(e,t);return e.chartVM&&(n.chartPriceRange=e.chartVM.chartPriceRange),n.showLabels=!0,n.enableTooltips=!0,n}}}),define("modules/combinationEditor",["knockout","modules/combinationHelpers","modules/strategyHelpers","modules/formatting","modules/enums","modules/disposableViewModel"],function(e,t,n,r,i,s){var o=i.LegType,u=function(t){function f(){var e=i.combination.positions();for(var t=0;t<e.length;t++){var n=e[t];n.detailStrikeList=i.computed(function(){return i.convertStrikeList(this)},n),n.removePos=function(e){if(i.combination.positions().length<=1)return;i.combination.removePosition(e),e.type()==o.SECURITY&&i.hasSecurityLeg(!1)}}}var i=this;s.call(this),this.combination=t;var u=t.chain,a=t.quote;this.template=[],this.bindReady=e.observable(!1),this.hasSecurityLeg=e.observable(!1),this.convertStrikeList=function(e){var t=0,n=0,r=0,s=0,o=0,u=0,a=function(e,i,a){var f=e.toFixed().length,l=e.toString().length-f,c=i.toFixed().length,h=i.toString().length-c,p=a.toFixed().length,d=a.toString().length-p;f>t&&(t=f),l>n&&(n=l),c>r&&(r=c),h>s&&(s=h),p>o&&(o=p),d>u&&(u=d)},f=function(e,t,n){var r="",i=Math.floor(e),s=e-i;for(var o=0;o<t-i.toString().length;o++)r+="&nbsp;&nbsp;";r+=i.toString();if(s!=0){r+=s.toFixed(n-1).substring(1);for(var o=0;o<n-s.toString().length+1;o++)r+="&nbsp;&nbsp;"}else for(var o=0;o<n;o++)o==0?r+=".":r+="0";return r};if(e.strikeList()&&e.strikeList()!=[]){var l=[];for(var c=0;c<e.strikeList().length;c++){var h=e.chain.findRow(e.strikeList()[c],e.expiry(),e.optionType);e.callOrPut()?(l.push({strike:e.strikeList()[c],bid:h.callOption.bid(),ask:h.callOption.ask()}),a(e.strikeList()[c],h.callOption.bid(),h.callOption.ask())):(l.push({strike:e.strikeList()[c],bid:h.putOption.bid(),ask:h.putOption.ask()}),a(e.strikeList()[c],h.putOption.bid(),h.putOption.ask()))}var p=[],d=i.combination.stdDev.getStdDevsByExpiry(i.combination.expiration());if(d)var v=d[3],m=d[2],g=!1,y=d[4],b=!1;for(var c=0;c<l.length;c++){var w=l[c].strike,E=l[c].bid,S=l[c].ask,x=f(w,t,n)+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$"+(e.buySellFlag()?f(S,o,u):f(E,r,s)),T={strike:w,strikeStr:x,strikeClass:"strike-below-last"};d&&(v<w&&(T.strikeClass="strike-over-last"),m<=w&&!g&&(p.push({strike:w,strikeStr:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1SD",strikeClass:"strike-of-sd"}),g=!0),y<w&&!b&&(p.push({strike:w,strikeStr:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+1SD",strikeClass:"strike-of-sd"}),b=!0)),p.push(T)}return p}return null},$.each(t.positions(),function(e,t){i.template.push({legType:t.type(),buyOrSell:t.buyOrSell(),expiry:t.expiry(),strike:t.strike(),quantity:t.quantity()}),t.type()==o.SECURITY&&i.hasSecurityLeg(!0)}),this.expiryList=[],u&&(this.expiryList=u.expirySelectOptions),this.expiryList.findIndex=function(e){for(var t=0;t<i.expiryList.length;t++){var n=i.expiryList[t].date;if(r.sameDate(e,n))return t}return-1},this.expiryList.findIndexByExpiryStr=function(e){for(var t=0;t<i.expiryList.length;t++){var n=i.expiryList[t].expiryStr;if(e==n)return t}return-1},f(),this.expiryChange=function(n){e.utils.arrayForEach(t.positions(),function(e){var t=i.expiryList.findIndex(e.expiry())+(n?1:-1);t>=0&&t<=i.expiryList.length-1&&e.expiry(i.expiryList[t].date)})},this.strikeChange=function(n){e.utils.arrayForEach(t.positions(),function(e){var t=e.strikeList().indexOf(e.strike())+(n?1:-1);t>=0&&t<=e.strikeList().length-1&&e.strike(e.strikeList()[t])})},this.quantityChange=function(e){var n=e?1:-1;t.absQuantity(t.absQuantity()+n)},this.flipBS=function(){for(var n=0;n<t.positions().length;n++){var r=t.positions()[n];r.buySellFlag(!r.buySellFlag())}},this.reset=function(){i.bindReady(!1),i.combination.initPositions(i.combination.originalLegs),f(),i.bindReady(!0)},this.addNewLeg=function(e){var n=t.positions(),r=0;for(var s=0;s<n.length;s++)n[s].isOwned()||r++;if(r>=4)return null;e=e||o.CALL;if(e==o.SECURITY)for(var s=0;s<n.length;s++)if(n[s].type()==o.SECURITY&&!n[s].isOwned())return null;var f=t.expiration(),l=u.findStrike(a.last(),f,0,t.optionType),c=1;e==o.SECURITY&&(c=t.multiplier());var h=t.addPosition("BUY",c,e,f,l);return h==null?null:(e==o.SECURITY&&i.hasSecurityLeg(!0),h)},this.subscribe(t.positions,function(e){for(var n=0;n<e.length;n++){var r=e[n];r.detailStrikeList=r.detailStrikeList||i.computed(function(){return i.convertStrikeList(r)}),r.removePos=r.removePos||function(e){if(t.positions().length<=1)return;t.removePosition(e),e.type()==o.SECURITY&&i.hasSecurityLeg(!1)}}}),this.lessAggressive=function(){},this.moreAggressive=function(){},this.qtySpinUp=function(e,t){e.absQuantity(e.absQuantity()+1),t.preventDefault(),t.stopPropagation()},this.qtySpinDown=function(e,t){e.absQuantity(e.absQuantity()==1?1:e.absQuantity()-1),t.preventDefault(),t.stopPropagation()},this.buySellEvent=function(e){e.buyOrSell(e.buyOrSell()=="BUY"?"SELL":"BUY")},this.callPutType=function(e){e.type(e.type()=="CALL"?"PUT":"CALL")},this.flipCP=function(t){var n=t.type().toUpperCase();n===o.CALL?t.type(o.PUT):n===o.PUT&&t.type(o.CALL)},this.typeSpinUp=function(e){var t=e.type().toUpperCase();t===o.CALL?e.type(o.SECURITY):t===o.PUT?e.type(o.CALL):t===o.SECURITY&&e.type(o.Put)},this.typeSpinDown=function(e){var t=e.type().toUpperCase();t===o.CALL?e.type(o.PUT):t===o.PUT?e.type(o.SECURITY):t===o.SECURITY&&e.type(o.CALL)},this.selectExpiry=function(e,t,n){e.expiry(t.date),$(n.target).parent().parent().scrollLeft($(n.target).position().left-170)},this.selectStrike=function(e,t,n){e.strike(t),$(n.target).parent().parent().scrollLeft($(n.target).position().left-170)},this.shrinkWidth=function(){n.changeWidth(i.combination,!1)},this.expandWidth=function(){n.changeWidth(i.combination,!0)},this.shrinkWingspan=function(){n.changeWingspan(i.combination,!1)},this.expandWingspan=function(){n.changeWingspan(i.combination,!0)},this.detached=function(){i.dispose()},this.bindReady(!0)};return u}),define("koBindings/bootstrapDatePicker",["knockout","bootstrap-datepicker"],function(e){function t(e,t,n){var r=new Date(e);return t=n?t+1:t,r.setDate(e.getDate()+t),r}function n(n,r,i){var s=n();if(!e.isObservable(s)||!r.data().datepicker)return;var o=r.data().datepicker._o,u=o.defaultOffset,a=o.endDate;if(isNaN(+i)){if(!u){s(null);return}i=t(new Date,u)}else a&&i>a&&(i=a);i=new Date(i.setHours(0,0,0,0)),s(i),(r.datepicker("getDate")===""||r.datepicker("getDate").getTime()!==i.getTime())&&r.datepicker("setDate",i)}e.bindingHandlers.datepicker={init:function(r,i,s){function u(e){var t=e.date||new Date(r.value);n(i,$(r),t)}var o=e.computed(function(){var o={autoclose:!0,format:"mm/dd/yyyy",todayHighlight:!0},u=$.extend({},o),a=s().datepickerOptions;for(var f in a)u[f]=e.unwrap(a[f]);(!u.endDate||!Object.prototype.toString.call(u.endDate)==="[object Date]")&&delete u.endDate,u.availablePeriod&&typeof u.availablePeriod=="number"&&(u.endDate=t(new Date,u.availablePeriod)),u.endDate&&(u.endDate=new Date(u.endDate.setHours(0,0,0,0))),u.startDate&&(u.startDate=new Date(u.startDate.setHours(0,0,0,0))),u.displayFormat&&(u.format=u.displayFormat,delete u.displayFormat);var l=$(r);l.datepicker(u);var c=e.utils.unwrapObservable(i());return n(i,l,c),u});e.utils.registerEventHandler(r,"changeDate",u),e.utils.registerEventHandler(r,"change",u),e.utils.domNodeDisposal.addDisposeCallback(r,function(){o.dispose()})},update:function(t,r){var i=$(t),s=e.utils.unwrapObservable(r());s&&n(r,i,s)}}}),define("koBindings/chartBindings",["knockout","jquery","isotope","modules/combinationChart","highstock"],function(e,t,n){e.bindingHandlers.plChart={init:function(t,n,r){var i=e.unwrap(n()),s=r().updating;i.renderChartTo(t);var o=i.combination.summary.subscribe(function(){i.renderChartTo(t)}),u=null;e.isObservable(s)&&(u=s.subscribe(function(){i.updateChart()})),e.utils.domNodeDisposal.addDisposeCallback(t,function(){i.destroy(),o.dispose(),u&&u.dispose()})}};var r=["filter","sortBy","sortAscending","layoutMode","itemSelector"];e.bindingHandlers.isotope={init:function(t,r){var i=e.unwrap(r()),s={};for(var o in i)i.hasOwnProperty(o)&&(s[o]=e.unwrap(i[o]));t.isotopeObj=new n(t,s);var u;e.isObservable(i.items)&&(u=i.items.subscribe(function(){var r={};for(var s in i)i.hasOwnProperty(s)&&(r[s]=e.unwrap(i[s]));t.isotopeObj.destroy(),t.isotopeObj=new n(t,r)})),e.utils.domNodeDisposal.addDisposeCallback(t,function(){t.isotopeObj.destroy(),u&&u.dispose(),delete t.isotopeObj})},update:function(t,n){var r=e.unwrap(n()),i={};for(var s in r)r.hasOwnProperty(s)&&(i[s]=e.unwrap(r[s]));t.isotopeObj.arrange(i)}}}),define("koBindings/customControls",["jquery","knockout","bootstrap","jquery-ui","autoNumeric","perfectScrollbar"],function(e,t){function n(e,t,n){for(var r in t)n[r]&&e.on(t[r],n[r])}function r(t,n){var r=n.value,i=e(t.currentTarget),s=i.slider("option","max"),o=i.slider("option","min"),u=i.find(".red-green-range"),a=i.data("anchorValue");u.removeClass(r>a?"bg-green":"bg-red"),u.addClass(r<a?"bg-green":"bg-red"),u.css("left",(Math.min(a,r)-o)/(s-o)*100+"%"),u.css("width",Math.abs(a-r)/(s-o)*100+"%")}return t.bindingHandlers.customSlider={init:function(n,i,s,o,u){var a=i(),f={step:.01};for(var l in a)f[l]=t.unwrap(a[l]);var c=e('<div class="ui-slider"></div>').appendTo(n).slider(f),h=c.slider("option","max"),p=c.slider("option","min"),d=s.get("sliderTicks");if(d){e(n).css("position","relative");var v=t.unwrap(d);n.sliderTicks=v,e.each(v,function(t,r){if(r>=p&&r<=h){var i=(r-p)/(h-p)*100+"%",s=e('<a class="ui-slider-tick"></a>').appendTo(n);s.css("left",i),s.attr("title",r),s.on("click",r,function(e){var t=e.data;c.slider("option","range")===!0?c.slider("values",Math.abs(t-p)<=Math.abs(t-h)?0:1,t):c.slider("value",t)})}});var m=c.find(".ui-slider-tick");m[0]&&e(m[0]).css("opacity",0),m.length&&e(m[m.length-1]).css("opacity",0)}var g=s.get("anchor");if(g){e(n).css("position","relative");var y=g(),b=e('<a class="ui-slider-anchor" title="'+y+'"><i class="fa fa-chevron-up"></i></a>').appendTo(n);e('<div class="ui-slider-range red-green-range"></div>').appendTo(c),c.data("anchorValue",y),c.on("slide",r),c.on("slidechange",r),r({currentTarget:c},{value:c.slider("value")});var w=function(){return function(){c.slider("value",g())}};t.bindingHandlers.click.init(b[0],w,s,o,u),b.css("left",(y-p)/(h-p)*100+"%"),b.attr("title",y),y<p&&y>h?b.css("display","none"):b.css("display","block")}t.utils.domNodeDisposal.addDisposeCallback(n,function(){c.off("slide"),c.off("slidechange");if(c.data("ui-slider")){c.slider("destroy");var e=c.find(".ui-slider-tick");e.off("click")}})},update:function(n,i,s,o,u){var a=i(),f=e(n).find(".ui-slider"),l=!1;for(var c in a){var h=t.unwrap(a[c]);if(h!==f.slider("option",c)){if(c=="min"||c=="max")l=!0;!c=="value"&&!c=="values"&&(f.slider("option","slide",null),f.slider("option","change",null));if(c!="values")f.slider("option",c,h);else{var p=f.slider("values");(!p[0]||h[0].toFixed(2)!=p[0].toFixed(2))&&f.slider("values",0,h[0]),(!p[1]||h[1].toFixed(2)!=p[1].toFixed(2))&&f.slider("values",1,h[1])}!c=="value"&&!c=="values"&&(f.slider("option","slide",a.slide&&t.unwrap(a.slide)),f.slider("option","change",a.change&&t.unwrap(a.change)))}}var d=f.slider("option","max"),v=f.slider("option","min"),m=s.get("sliderTicks");if(m){var g=t.unwrap(m);if(l||g!==n.sliderTicks){n.sliderTicks=g;var y=e(n).find(".ui-slider-tick"),b=0;e.each(g,function(t,r){if(r>=v&&r<=d){var i=(r-v)/(d-v)*100+"%",s=y[b]?e(y[b]):e('<a class="ui-slider-tick"></a>').appendTo(n);b++,s.css("left",i),s.css("opacity",1),s.attr("title",r),s.off("click"),s.on("click",r,function(e){var t=e.data;f.slider("option","range")===!0?f.slider("values",Math.abs(t-v)<=Math.abs(t-d)?0:1,t):f.slider("value",t)})}}),y[0]&&e(y[0]).css("opacity",0),y.length&&e(y[y.length-1]).css("opacity",0)}}var w=s.get("anchor");if(w){var E=w();r({currentTarget:f},{value:f.slider("value")});var S=f.data("anchorValue");if(l||E!==S){f.data("anchorValue",E),n.anchorValue=E;var x=e(n).find(".ui-slider-anchor");x.css("left",(E-v)/(d-v)*100+"%"),x.attr("title",E),E<v&&E>d?x.css("display","none"):x.css("display","block")}}var T=s.get("supportAndResistance");if(T){e(n).find(".ui-slider-anchor.support-anchor, .ui-slider-anchor.resist-anchor").remove();var N=T(),C=N[0],k=N[1];for(var L=0;L<C.length;L++){var A=e('<a class="ui-slider-anchor support-anchor" title="'+C[L]+'"><i class="fa fa-chevron-up"></i></a>').appendTo(n),O=function(){return function(t,r,i){var s=parseFloat(e(r.target).parent().attr("title"));f.slider("values",0,s),e(n).find("button").removeClass("btn-active")}};t.bindingHandlers.click.init(A[0],O,s,o,u);var M=(C[L]-v)/(d-v),_=(1+M*(e(n).width()-2))/e(n).width()*100;A.css("left",_+"%"),A.attr("title",C[L]),C[L]<v||C[L]>d?A.css("display","none"):A.css("display","block")}for(var L=0;L<k.length;L++){var D=e('<a class="ui-slider-anchor resist-anchor" title="'+k[L]+'"><i class="fa fa-chevron-up"></i></a>').appendTo(n),P=function(){return function(t,r,i){var s=parseFloat(e(r.target).parent().attr("title"));f.slider("values",1,s),e(n).find("button").removeClass("btn-active")}};t.bindingHandlers.click.init(D[0],P,s,o,u);var M=(k[L]-v)/(d-v),_=(1+M*(e(n).width()-2))/e(n).width()*100;D.css("left",_+"%"),D.attr("title",k[L]),k[L]<v||k[L]>d?D.css("display","none"):D.css("display","block")}}}},t.bindingHandlers.autoNumeric={init:function(n,r,i){function f(){a(parseFloat(s.autoNumeric("get"),10))}function l(e){e.which==13&&(f(),s.autoNumeric("update"))}var s=e(n),o=i(),u=o.settings,a=r();s.autoNumeric(u),s.autoNumeric("set",parseFloat(t.utils.unwrapObservable(a()),10)),n.tagName=="INPUT"&&(s.change(f),s.keypress(l)),t.utils.domNodeDisposal.addDisposeCallback(n,function(){s.off("change"),s.off("keypress"),s.autoNumeric("destroy")})},update:function(n,r,i){var s=e(n),o=parseFloat(t.utils.unwrapObservable(r()),10),u=parseFloat(s.autoNumeric("get"),10),a=i().settings,f=a?a.mDec||2:2,l=o.toFixed(f)!=u.toFixed(f);o===0&&u!==0&&u!=="0"&&(l=!0),l&&(s.autoNumeric("set",o),setTimeout(function(){s.change()}))}},t.bindingHandlers.currency={init:function(n,r,i,s){function u(){var t=i(),n=t.settings||{};return t.settings=e.extend({},o,n),t}var o={vMin:0,aSign:"￥"};t.bindingHandlers.autoNumeric.init.call(this,n,r,u,s)},update:t.bindingHandlers.autoNumeric.update},t.bindingHandlers.perfectScrollbar={init:function(t,n){var r=n();e(t).perfectScrollbar(r)},update:function(n,r,i){var s=i.get("scrollTop");if(s){var o=t.unwrap(s);e(n).scrollTop(o),e(n).perfectScrollbar("update")}}},t.bindingHandlers.relativeLabel={init:function(e,n,r){t.bindingHandlers.relativeLabel.update(e,n,r)},update:function(n,r,i){var s=t.unwrap(i().highBound)||0,o=t.unwrap(i().lowBound)||100,u=t.unwrap(i().stopPosition),a=t.unwrap(r())||50,f=(a-o)/(s-o)*100;f=u<50?Math.min(u,f):Math.max(u,f),e(n).css("left",f+"%")}},t.bindingHandlers.tooltip={init:function(n,r,i){var s=i().tooltipOptions;s=t.unwrap(s)||{};var o=t.unwrap(r());s=e.extend(s,{title:o}),e(n).tooltip(s),t.utils.domNodeDisposal.addDisposeCallback(n,function(){e(n).data("bs.tooltip")&&e(n).tooltip("destroy")})},update:function(n,r,i){var s=i().tooltipOptions;s=t.unwrap(s)||{};var o=t.unwrap(r());s=e.extend(s,{title:o}),e(n).tooltip("destroy"),e(n).tooltip(s)}},t.bindingHandlers.tagsinput={init:function(t,n){var r=e(t);r.on("change",function(){var e=n(),t=r.val();e(t)}),r.tagsinput()}},t.bindingHandlers.dropdown={init:function(t){e(t).dropdown()}},t}),define("viewmodels/howPanel/tradingStrategies",["knockout","events","dataContext","modules/context","modules/enums","modules/combinationViewModel","modules/combinationHelpers","modules/strategyHelpers","modules/strategyTemplates","modules/combinationChart","modules/combinationEditor","modules/formatting","modules/notifications","modules/configurations","koBindings/bootstrapDatePicker","koBindings/chartBindings","koBindings/customControls","koBindings/customExtenders"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=function(t){function o(e,n){var r=0,i=.5,o=(e-s.chartLowBound())/(s.chartHighBound()-s.chartLowBound());t.quote&&(i=(t.quote.last()-s.chartLowBound())/(s.chartHighBound()-s.chartLowBound()),r=o/2+i/2);var u=.3-Math.abs(i-r)*.5;!n&&s.leftProbPos()&&Math.abs(s.leftProbPos().leftVal-r)<.15&&(u-=.1);var a=0;return t.predictions&&!$.isEmptyObject(t.predictions.probs)&&s.maxDays()&&t.predictions.getProb(s.maxDays())&&(n?e<t.quote.last():e>t.quote.last())&&(a=t.predictions.getProb(s.maxDays()).probBetween(e,t.quote.last())),{left:r*100+"%",leftVal:r,bottom:u*100+"%",display:a!=0,prob:a*100}}function d(){s.isTradable()&&s.sentimentStrategyMap(a.sentimentStrategyMap);var e=[];$.each(a.sentimentStrategyMap,function(t,n){var r=n.filter(function(e){var t=e.template.legs.every(function(e){return e.legType!=="Security"});return t});e[t]=r}),s.sentimentStrategyMap(e)}function m(){var n=[];if(t.chain){var r=t.chain.expirySelectOptions;n=r.map(function(t){var n=$.extend({},t);return n.isGrayed=e.computed(function(){return c.compareDates(t.date,s.furthestExpiration())===1}),n.expiryStr=c.formatDate(n.date,"yyyy-MM-dd"),n})}s.expirySelectOptions(n)}function g(){var e=s.dateSliderMaxDays();s.maxDays(e);if(t.stdDev&&t.chain){var n=new Date,r=new Date(n.getFullYear(),n.getMonth(),n.getDate()+e),o=t.chain.impliedVolatility(r);s.whatifVolatility(o),s.whatifVolatilityAnchor(o);var u=t.stdDev.getStdDevsByExpiry(s.dateOfBellSlider());u=u&&u.stdDevPrices.slice(0);var a=E();if(u){var f=[u[1],u[2],t.quote.last(),u[3],u[4]];s.lowPrice(f[0]),s.highPrice(f[4]),s.chartLowBound(f[0]),s.chartHighBound(f[4]),s.sdSliderTicks(f),s.chartLowPrice(f[1]),s.chartHighPrice(f[3]),s.whatifSPrice(c.roundNumber(a==i.Sentiment.BULLISH?f[3]:f[1]))}else s.lowPrice(t.quote.last()*.7),s.highPrice(t.quote.last()*1.3),s.whatifSPrice(c.roundNumber(a==i.Sentiment.BULLISH?t.quote.last()*1.15:t.quote.last()*.85))}t.quote&&s.whatifSPriceAnchor(t.quote.last()),s.whatifDays(e)}function y(e){var n=u.assembleCombination(e,t.optionType(),t.quote,t.chain,t.stdDev,t.predictions);return n.outlookPriceLowerBound=s.chartLowPrice,n.outlookPriceHigherBound=s.chartHighPrice,n.outlookBoundChanged(),n.chartVM=f.createChartViewModel(n),n.chartVM.chartPriceRange=s.chartSPrices,n.editorVM=new l(n),n.whatifTheoretical=n.computed(function(){var e=this.payoff(s.whatifSPrice(),s.whatifDate(),s.whatifVolatility()/100),t=this.cost()!=0?e/Math.abs(this.cost())*100:0;this.whatifTheoreticalPL=t;var n=c.toFractionalCurrency(e)+(e>=0?" 盈利":" 损失"),r=c.toPercentage(t,!0)+" 回报";return{payoffValue:e,payoff:c.toFractionalCurrency(e),payoffFormatted:n,returnPercentage:c.toPercentage(t,!0),returnPercentageFormatted:r}},n).extend({rateLimit:10}),n.defaultPlainEnglish="",n}function b(n){var r=[],o,u;for(o=0;o<3;o++)n[o]&&n[o].legs&&n[o].legs[0].expirationDate&&(u=n[o].legs[0].expirationDate.numOfDaysUntilExpired);for(o=0;o<3;o++){var a=n[o];s.defaultTradingStrategies[o](null);var f;if(a.isComposed){var l=E();f=y(a),f.originalName=e.observable(null),r.push(f);if(f.rewardProfile()=="unlimited"||f.maxReward()>0){var h="";a.legs.length>1&&(h=l==i.Sentiment.BULLISH?f.extractedPositions()[1].strikePrice+f.extractedPositions()[1].price:f.extractedPositions()[0].strikePrice-f.extractedPositions()[0].price,h=c.toFractionalCurrency(h)),f.defaultPlainEnglish={symbol:s.symbol(),buyOrSell:f.buyOrSell().toLowerCase()+"ing",callOrPut:l==i.Sentiment.BULLISH?"call":"put",upOrDown:l==i.Sentiment.BULLISH?"upside":"downside",belowOrAbove:l==i.Sentiment.BULLISH?"below":"above",threshold:h},s.defaultTradingStrategies[o](f.fullName())}}if(r.length<o+1&&s.hasOption()){var p=E()==i.Sentiment.BULLISH?"Call":"Put",d=t.chain.findExpiry(new Date,0,3).date,v=d.toISOString(),m;r.length==2?(d=t.chain.findExpiry(r[1].expiration(),0,0).date,v=d.toISOString(),m=t.chain.findStrike(r[1].strikes()[0],d,0)):m=t.chain.findStrike(t.quote.lastPrice(),d,p=="Call"?0:-1);var g={strategyName:p,fullStrategyName:"Buy "+p,buyOrSell:"Buy",legs:[{legType:p,buyOrSell:"Buy",strikePrice:m,quantity:1,expirationDate:{futureDate:v,numOfDaysUntilExpired:c.daysFromNow(d)}}]};f=y(g),f.originalName=e.observable(p),r.push(f)}else o>0&&!s.hasOption()&&r.push({originalName:e.observable("N/A")})}r&&(s.sentiment=r[0].sentiment),s.allCombinations(r),w()}function w(){var e=E();if(e==null)return;e.toLowerCase()=="bearish"?s.allCombinations().forEach(function(e){e.sentiment()=="bullish"&&e.editorVM.flipBS()}):e.toLowerCase()=="bullish"&&s.allCombinations().forEach(function(e){e.sentiment()=="bearish"&&e.editorVM.flipBS()})}function E(){return r==null||r.selectedTradeIdea()==null?i.Sentiment.BULLISH:r.selectedTradeIdea().sentiment}function S(){s.showEditorCombination(null),s.dateOfBellSlider(null);var e=s.allCombinations();if(e&&e.length)for(var n=0;n<e.length;n++)e[n].dispose&&e[n].dispose();s.allCombinations([]),s.buyPower(0),s.amountType("investment"),s.lowPrice(t.quote.last()*.7),s.highPrice(t.quote.last()*1.3),s.chartLowPrice(t.quote.last()*.7),s.chartHighPrice(t.quote.last()*1.3),s.sdSliderTicks([]),s.sdSliderSupRes([]),g(),t.quote&&!s.hasOption()?s.showOptionsPlayScore(!1):s.showOptionsPlayScore(!0)}function x(e,t,n){return 1/(Math.sqrt(2*Math.PI)*n)*Math.exp(-Math.pow(e-t,2)/(2*Math.pow(n,2)))}var s=this;this.DATE_FORMAT=p.DATE_FORMAT,this.symbol=r.ulCode,this.isTradable=function(){return t.quote},this.hasOption=t.hasOption,this.sentiment=t.sentiment,this.expandChartClick=function(e){t.showCombinationInSingleTradeView(e)},this.isTradePanelVisible=r.isTradePanelVisible,this.lowPrice=e.observable(0),this.highPrice=e.observable(100),this.maxDays=e.observable(0),this.sdSliderTicks=e.observableArray([]),this.sdSliderSupRes=e.observableArray([]),this.chartLowBound=e.observable(0),this.chartHighBound=e.observable(100),this.chartLowPrice=e.observable(0).extend({numberRounded:2}),this.chartHighPrice=e.observable(100).extend({numberRounded:2}),this.chartLowPercent=e.observable(),this.chartHighPercent=e.observable(),this.chartRangeProb=e.observable(),this.chartSPrices=e.computed({read:function(){if(t.predictions&&s.maxDays()){var e=t.predictions.getProb(s.maxDays());e?s.chartRangeProb(e.probBetween(s.chartLowPrice(),s.chartHighPrice())*100):s.chartRangeProb("N/A")}else s.chartRangeProb("N/A");return[s.chartLowPrice(),s.chartHighPrice()]},write:function(e){var t=e[0],n=e[1];s.chartLowPrice(t),s.chartHighPrice(n)}},this).extend({rateLimit:{timeout:10,method:"notifyWhenChangesStop"}}),this.chartSPrices.subscribe(function(){typeof $("#sdRangeChart")[0]!="undefined"&&s.showRangeChart()}),this.narrowRange=e.computed(function(){var e=s.chartSPrices(),t=s.sdSliderTicks();return t&&t.length>0?c.closeTo(e[0],t[1],.02)&&c.closeTo(e[1],t[3],.02):!1}),this.wideRange=e.computed(function(){var e=s.chartSPrices(),t=s.sdSliderTicks();return t&&t.length>0?c.closeTo(e[0],t[0],.02)&&c.closeTo(e[1],t[4],.02):!1}),this.leftProbPos=e.computed(function(){return o(s.chartLowPrice(),!0)},this),this.rightProbPos=e.computed(function(){return o(s.chartHighPrice(),!1)},this),this.tradeTicket=t.tradeTicket,this.tradeCombination=function(e){t.tradeCombination(e)},this.symbolFullName=e.computed(function(){var e=r.quote();return e?e.securityName:""}),this.displayedToolboxIndex=e.observable(0),this.strategyTemplates=a.templates,this.sentimentOptions=a.sentiments,this.allCombinations=e.observableArray([]),this.prefferedShareIconPlacement=e.computed(function(){var e=s.allCombinations(),t={};e.forEach(function(e){e.chartVM&&e.chartVM.freeQuadrants().forEach(function(e){t[e.name]?t[e.name]++:t[e.name]=1})});var n=null,r=-1;for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];o>r&&(n=i,r=o)}return e.forEach(function(e){e.chartVM&&e.chartVM.freeChosenQuadrandName(n)}),n}),this.sentimentStrategyMap=e.observable([]),this.showEditorCombination=e.observable(null),this.selectedStrategy=e.computed({read:function(){var e=s.showEditorCombination(),t=null;return e&&e.matchedTemplate&&e.matchedTemplate()&&(t=e.matchedTemplate()),t},write:function(e){s.constructCombination(e)}},this),this.defaultTradingStrategies=[e.observable(null),e.observable(null),e.observable(null)],this.showDefaultEnglish=e.computed(function(){var e=!0,t=0;for(;t<s.defaultTradingStrategies.length;t++)e=e&&!!s.defaultTradingStrategies[t]()&&s.allCombinations()[t]&&s.defaultTradingStrategies[t]()==s.allCombinations()[t].fullName();return e}),this.noOfBreakeven=e.observable(1),this.breakevenCss=e.computed(function(){var e=s.allCombinations(),t=1;for(var n=0;n<e.length;n++){var r=e[n];if(r&&r.whatifTheoretical){var i=r.breakeven();t=Math.max(i.length,t)}}return s.noOfBreakeven(t),t>1?"two-line":"one-line"},this),this.bestTradingStrategy=e.computed(function(){var e=s.allCombinations(),t=0,n=null;for(var r=0;r<e.length;r++){var i=e[r];if(i&&i.whatifTheoretical){i.whatifTheoretical();var o=i.whatifTheoreticalPL;o>t&&(n=i,t=o)}}return n}),this.whatifSPrice=e.observable(0),this.whatifSPriceAnchor=e.observable(0),this.whatifDate=e.observable(new Date),this.whatifDays=e.computed({read:function(){return c.daysFromNow(s.whatifDate())},write:function(e){var t=new Date((new Date).getTime()+e*24*3600*1e3);s.whatifDate(t)}}),this.whatifVolatility=e.observable(.3),this.whatifVolatilityAnchor=e.observable(.3);var v=[null,null,null];this.dateOfBellSlider=e.observable(null),this.dateSliderMaxDays=e.computed(function(){var e=c.daysFromNow(s.dateOfBellSlider());return e},this),this.furthestExpiration=e.computed(function(){var e=s.allCombinations();if(t.chain==null)return new Date;var n=[],r=t.chain!=null?t.chain.expirationDates[0].date:new Date;for(var i=0;i<e.length;i++)if(e[i]&&e[i].expiration()){var o=e[i].expiration();n[i]=o,r.getTime()<o.getTime()&&(r=o)}var u=!0;return n.forEach(function(e,t){u&=c.sameDate(e,v[t])}),u||s.dateOfBellSlider(r),v=n,r},this),s.expiryStr=e.observable(null),s.dateOfBellSlider.subscribe(function(){s.expiryStr(c.formatDate(s.dateOfBellSlider(),"yyyy-MM-dd"))}),s.expiryStr.subscribe(function(e){s.dateOfBellSlider(new Date(e))}),this.expirySelectOptions=e.observable([]),this.minVolatility=e.computed(function(){if(s.dateOfBellSlider()&&s.allCombinations().length&&t.chain){var e=t.chain.impliedVolatility(s.dateOfBellSlider())*.5;if(e>0)return e}return 0}),this.maxVolatility=e.computed(function(){return s.dateOfBellSlider()&&s.allCombinations().length&&t.chain?t.chain.impliedVolatility(s.dateOfBellSlider())*1.5:100}),r.selectedTradeIdea.subscribe(g),this.dateOfBellSlider.subscribe(g),this.whatifDateOnSlide=function(e,t){var n=t.value;isNaN(n)||s.whatifDays(n)},this.whatifSPriceOnSlide=function(e,n){var r=n.value,i=s.whatifSPrice();c.roundNumber(i)!=c.roundNumber(r)&&(s.whatifSPrice(r),$.each(s.allCombinations(),function(e,n){n.chartVM&&n.chartVM.chart&&n.chartVM.chart.xAxis[0].update({plotLines:[{color:"#555",width:1.5,value:t.quote.last()},{color:n.payoff(s.whatifSPrice())<0?"red":n.payoff(s.whatifSPrice())>0?"green":"#555",width:1,value:s.whatifSPrice()}]})}))},this.whatifVolatilityOnSlide=function(e,t){var n=t.value;isNaN(n)||s.whatifVolatility(n)},this.bestOPScoreCombIndex=e.deferredComputed(function(){var e=s.allCombinations(),t,n=0,r=-1;for(t=0;t<e.length;t++){var i=e[t].originalName();if(e[t]&&e[t].opScore){if(!e[t].expiry()&&e[t].buyOrSell()&&e[t].buyOrSell().match(/sell/i))continue;if(i)continue;n=Math.max(n,e[t].opScore()),n==e[t].opScore()&&(r=t)}}return r!=-1&&e[r].opScore()>=80?r:-1},this).extend({rateLimit:10}),this.bestOPCombCheckListAllGreen=e.deferredComputed(function(){if(-1==s.bestOPScoreCombIndex())return!1;var e=s.allCombinations()[s.bestOPScoreCombIndex()],t=u.checkCombination(e);for(var n=0;n<t.length;n++)if(!t[n].className.match(/green/i))return!1;return!0},this).extend({rateLimit:10}),this.sliderMutex=!0,this.sdSliderOnChange=function(e,n){if(!s.sliderMutex||!t.predictions)return;s.sliderMutex=!1;if(n.values.indexOf(n.value)==0){s.chartLowPrice()>t.quote.last()&&(n.value=t.quote.last(),n.values[0]=t.quote.last()),s.chartLowPrice(n.values[0]);var r=t.predictions.getSymmetricPrice(parseFloat(n.values[0].toFixed(2)),s.maxDays());r<=n.values[0]&&(r=parseFloat(n.values[0].toFixed(2))+.01),r.toFixed(2)!==s.chartHighPrice().toFixed(2)&&-1==s.SRValue()[0].indexOf(parseFloat(n.values[0].toFixed(2)))&&s.chartHighPrice(c.roundNumber(r,2))}else{s.chartHighPrice()<t.quote.last()&&(n.value=t.quote.last(),n.values[1]=t.quote.last()),s.chartHighPrice(n.values[1]);var i=t.predictions.getSymmetricPrice(parseFloat(n.values[1].toFixed(2)),s.maxDays());i>=n.values[1]&&(i=parseFloat(n.values[1].toFixed(2))-.01),i.toFixed(2)!==s.chartLowPrice().toFixed(2)&&-1==s.SRValue()[1].indexOf(parseFloat(n.values[1].toFixed(2)))&&s.chartLowPrice(parseFloat(i.toFixed(2)))}var o=t.predictions.getProb(s.maxDays());if(o){var u=o.prob(s.chartLowPrice()),a=o.prob(s.chartHighPrice());s.chartLowPercent(u),s.chartHighPercent(a)}setTimeout(function(){s.sliderMutex=!0},20)},this.sdSliderOnSlide=function(e,n){if(!t.predictions||!e.originalEvent||e.originalEvent.type!="mousemove")return;s.sliderMutex=!1,$(this).slider("values",1-n.values.indexOf(n.value),t.predictions.getSymmetricPrice(n.value,s.maxDays())),$("#sdLowInput").val(n.values[0].toFixed(2)),$("#sdHighInput").val(n.values[1].toFixed(2)),s.sliderMutex=!0},this.buyPower=e.observable(0),this.amountType=e.observable("investment"),this.investmentRiskCalculate=function(){var e=s.buyPower(),n=s.amountType(),r=E();switch(n){case"investment":if(e){var o=(r==i.Sentiment.BULLISH?t.quote.currentAskPrice():t.quote.currentBidPrice())||t.quote.lastPrice(),u=Math.floor(e/o+.001);u<1&&(u=1),$.each(s.allCombinations(),function(e,t){if(t.positions)if(t.hasOnlyStx())t.absQuantity(u);else{var n=c.roundNumber(Math.floor((u+49)/t.multiplier()),0);n<=1&&(n=1),t.absQuantity(n)}})}break;case"risk":e&&$.each(s.allCombinations(),function(n,r){if(r.hasOnlyStx()&&r.buyOrSell().match(/buy/i))r.absQuantity(Math.floor(e/t.quote.currentAskPrice()+.001));else if(s.sdSliderTicks().length==5){var i=r.strikes().filter(function(e){return e>=s.sdSliderTicks()[0]&&e<=s.sdSliderTicks()[4]});i.push(s.sdSliderTicks()[0]),i.push(s.sdSliderTicks()[4]);var o=i.map(function(e){var t=r.payoff(e);return t<0?-t/r.absQuantity():0}),u=Math.max.apply(s,o);u==0&&(u=r.askPrice()*r.multiplier());var a=Math.floor(e/u);r.absQuantity(Math.abs(a))}});break;default:}},this.buyPower.subscribe(this.investmentRiskCalculate),this.amountType.subscribe(this.investmentRiskCalculate),this.updateViewModel=function(e){m(),t.quote&&s.whatifSPriceAnchor(t.quote.last()),S(),d(),b(e);if(s.allCombinations()[0]){var n;s.isTradable()?n=s.allCombinations()[0]:n=s.allCombinations()[1],s.showEditorCombination(n),s.buyPower(Math.abs(n.cost()))}s.showRangeChart()},this.editCombination=function(e){e&&e!=s.showEditorCombination()&&s.showEditorCombination(e),s.showEditorCombination()&&setTimeout(function(){s.displayedToolboxIndex(4)},1)},this.buildOwnStrategy=function(e){e.originalName(null),s.editCombination(e)},this.turnToNarrow=function(){var e=s.sdSliderTicks();s.chartLowPrice(e[1]),s.chartHighPrice(e[3])},this.turnToWide=function(){var e=s.sdSliderTicks();s.chartLowPrice(e[0]),s.chartHighPrice(e[4])},this.showOptionsPlayScore=e.observable(!0),this.toggleOptionsPlayScore=function(e){e?s.showOptionsPlayScore(!s.showOptionsPlayScore()):s.showOptionsPlayScore(!1)},this.SRValue=e.computed(function(){return[[],[]]}),this.toolboxCarouselOptions={options:{interval:6e5}},this.slideToolboxLeft=function(){s.displayedToolboxIndex(s.displayedToolboxIndex()-1)},this.slideToolboxRight=function(){s.displayedToolboxIndex(s.displayedToolboxIndex()+1)},this.rangeBellChart=null,this.showRangeChart=function(){var e=s.sdSliderTicks(),n=e[0],r=e[e.length-1];if(!t.quote||!t.chain||e.length<1||n==null||r==null){setTimeout(function(){s.showRangeChart()},100);return}s.rangeBellChart&&s.rangeBellChart.renderTo&&s.rangeBellChart.destroy();var i=[],o=t.quote.last(),u=s.chartLowPrice(),a=s.chartHighPrice(),f=50,l="#0068B3",h=[],p=(r-n)/f,d=(r-n)/4,v,m={enabled:!0,fillColor:"white",lineWidth:2,lineColor:"green",states:{hover:{enabled:!1}}};for(var g=n;g<=r;g+=p){if(g>=u&&Math.abs(g-u)<p){v=x(u,o,d);var y={x:u,y:v,marker:m};i.push(y)}else if(g>=a&&Math.abs(g-a)<p){v=x(a,o,d);var b={x:a,y:v,marker:m};i.push(b)}v=x(g,o,d);var w={x:g,y:v};i.push(w)}var E={linearGradient:{x1:0,y1:0,x2:1,y2:0},stops:[[0,"rgba(200, 200, 200, 0)"],[(u-n)/(r-n),"rgba(200, 200, 200, 0)"],[(u-n)/(r-n),"rgba(200, 200, 200, 70)"],[(a-n)/(r-n),"rgba(200, 200, 200, 70)"],[(a-n)/(r-n),"rgba(200, 200, 200, 0)"],[1,"rgba(200, 200, 200, 0)"]]};h=e.slice(0).map(function(e,t){return v=x(e,o,d),[{x:e,y:0},{x:e,y:v,dataLabels:{enabled:!0,format:(t===2?"":c.toSignedFractionalString(t-2,!0,0)+"SD")+"<br/>{x:.2f}",color:l,y:-12}}]});var S={chart:{width:450,height:150,margin:[0,0,0,0],animation:!1},title:{text:""},plotOptions:{series:{animation:!1}},xAxis:[{lineWidth:0,lineColor:"transparent",labels:{enabled:!1},minorTickLength:0,tickLength:0}],yAxis:[{title:{text:""},labels:{enabled:!1},gridLineWidth:0,min:0,maxPadding:.5,endOnTick:!1}],tooltip:{formatter:function(){return this.x.toFixed(2)}},series:[{type:"area",data:i,lineColor:l,lineWidth:3,marker:{enabled:!1},fillColor:E,zIndex:7}],legend:{enabled:!1},credits:!1};for(var T=0;T<h.length;T++)S.series.push({data:h[T],marker:{enabled:!1,states:{hover:{enabled:!1}}},lineColor:l,zIndex:8});S.chart.renderTo=$("#sdRangeChart")[0],S.chart.renderTo&&(s.rangeBellChart=new Highcharts.Chart(S))},this.constructCombination=function(e){var n=s.showEditorCombination();if(n&&e&&e.template){var r=u.rebuildCombination(n,e,t.optionType(),t.quote,t.chain,t.stdDev,t.predictions);r||h.error("Not enough strikes or expiries available to construct a "+e.template.name,"Strategy Constructor")}},this.toggleSubmenu=function(e,t){var n=$(t.target.parentElement);n.hasClass("open")||(n.parent().children().removeClass("open"),n.addClass("open"))},this.selectStrategyToConstruct=function(e,t){s.selectedStrategy(e),$($(t.target).parents()[5]).removeClass("open"),$($(t.target).parents()[5]).find(".open").removeClass("open")},this.attached=function(){var e=n.tradingStrategies.get(s.symbol()),i=n.quotation.get(s.symbol()),o=n.optionChains.get(s.symbol()),u=n.standardDeviations.get(s.symbol()),a=n.predictions.get(s.symbol());t.isInSingleTrade()&&t.closeExpand(),$.when(i,o,u,a,e).done(function(e,n,r,i,o){e.last=e.lastPrice,e.symbol=e.securityCode,e.name=e.securityName,n.last=e.last(),t.quote=e,t.chain=n,t.stdDev=r,t.predictions=i,s.updateViewModel(o)}).always(function(){r.isHowPanelLoading(!1)}),t.checkAndResizeHighcharts()},r.ulCode.subscribe(s.attached)};return d}),define("modules/combinationTextGeneration",["modules/formatting"],function(e){var t={};t.generateTradeTicketTitle=function(t){var n=t.fullName();t.hasOnlyStx()?t.symbol&&(n=n.replace(t.symbol,""),n+=" of "+t.symbol):n=n.replace("Sell","Sell to Open").replace("Buy","Buy to Open");var r=t.costWithoutOwned();return n+=" @ "+e.toFractionalCurrency(Math.abs(r))+" "+(r>=0?"借方":"贷方"),n};var n="{0} ${1} Trade: {2}";return t.generateSharingMessage=function(r){var i=r.sentiments()[0]?e.capitaliseFirstLetter(r.sentiments()[0]):"",s=e.toFractionalCurrency(Math.abs(r.costWithoutOwned())),o=e.capitaliseFirstLetter(r.debitOrCredit()),u=e.format(n,i,r.symbol,t.generateTradeTicketTitle(r));return u.length>100&&(i!=""&&(u=u.replace(" "+i,"")),u=u.replace(" Trade","")),u.length>100&&(u=u.replace(s,""),u=u.replace(" "+o,"")),u},t}),define("viewmodels/howPanel/singleTrade",["knockout","durandal/system","modules/context","modules/strategyHelpers","modules/combinationChart","modules/configurations","dataContext","modules/formatting","modules/combinationTextGeneration","loader","modules/session","modules/helpers","modules/enums"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(t,r,p){function v(e){return f.show(),html2CanvasHelpers.capture($("#singleTradeView"),s.screenshotDefaultMimeType).then(function(n){f.hide();var r=a.generateSharingMessage(t),i="Share: "+t.fullName();return sharing.share(i,r,t.symbol,t.sentiment(),n,m,e)})}function m(e){var n=t.extractedPositions(),r=u.mapObjects(n,null,{expiry:u.toUtcIsoDate}),i={sharedTrade:{fullName:t.fullName(),symbol:t.symbol,legs:r,costBasis:t.midPricedCost(),targetPrice:d.whatifSPrice(),targetDate:d.whatifDate().toUTCString()},screenshot:e};return o.sharing.save(i)}var d=this;p?this.shareDetails={sharedBy:p.sharedBy||"Anonymous",creationDate:p.creationDate,totalProfitAndLoss:e.computed(function(){var e=t.midPricedCost()-p.costBasis;return e})}:this.shareDetails=null,this.chart=null,this.combination=t,this.greeks=null,this.quote=null,this.syrahSentiments=null,this.strategyChecklist=null,this.tradingStrategies=r.tradingStrategies,this.canShare=!s.isEmbeddingPlatform&&!t.incomeStrategy&&l.hasPermission(h.Permissions.ALLOW_SHARING),this.transformOrigin=function(){var e=r.tradingStrategies.allCombinations.indexOf(t);switch(e){case 0:return"left-origin";case 2:return"right-origin";case 1:default:return"center-origin"}}(),this.combinationTitle=e.observable(),this.flipped=e.observable(!1),this.attached=function(){r.checkAndResizeHighcharts(),r.isInSingleTrade=e.observable(!0)},this.detached=function(){r.isInSingleTrade()&&d.close()},this.activate=function(){d.combinationTitle=a.generateTradeTicketTitle(t),d.syrahSentiments=n.symbolSentiments,d.sentiment=t.sentiment,d.quote=t.quote,d.strategyCheckList=e.computed(function(){var e=[],t={title:"股票趋势"};return n.trendSentiment()=="Bullish"?t.className="green fa fa-check-square":n.trendSentiment()=="Bearish"&&(t.className="red fa fa-times-circle"),e.push(t),e}),d.chart=i.createChartViewModelExpanded(t)},this.close=r.closeExpand,this.deactivate=function(){r.isInSingleTrade=e.observable(!1)},this.editCombination=function(){r.tradingStrategies.editCombination(t),d.close()},this.tradeCombination=function(){r.tradeCombination(t)},this.DATE_FORMAT=s.DATE_FORMAT,this.shareViaEmail=c.partial(v,h.SharingType.EMAIL_CLIENT),this.copyToClipboard=c.partial(v,h.SharingType.COPY),this.shareViaQuickShare=c.partial(v,h.SharingType.EMAIL),this.shareViaStocktwits=c.partial(v,h.SharingType.STOCKTWITS),this.shareViaTwitter=c.partial(v,h.SharingType.TWITTER),n.trendSentiment.subscribe(d.activate)}t.setModuleId(p,"viewmodels/howPanel/singleTrade");var d={create:function(e,t,n){return new p(e,t,n)}};return d}),define("viewmodels/tradeIdeas/howPanel",["knockout","modules/context","dataContext","events","komapping","modules/notifications","viewmodels/howPanel/tradingStrategies","modules/combinationHelpers","viewmodels/howPanel/singleTrade","durandal/activator","modules/formatting","modules/localizer","bootstrap","highstock"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h="BULLISH",p="BEARISH",d=function(){function g(){d.hasData(!1),d.quote=null,d.chain=null}function y(e){if(e!=h&&e!=p)return;t.showTradePanel();if(d.sentiment()==e)return;d.hasData()&&(d.sentiment(e),d.tradingStrategies.updateViewModel(d.tradingStrategiesRaw[e]),b())}function b(){$("#tradingStrategiesTab").tab("show")}function E(){if(!w||d.isLoading())return!1;var e=w;w=null;if(e.symbol!=d.symbol())return!1;if(e.isExpired)return s.info("Shared "+e.symbol+" strategy from "+e.sharedBy+" has expired"),!1;e.legs.forEach(function(e){e.expiry&&(e.expiry=new Date(e.expiry))});var t=d.tradingStrategies.allCombinations()[0];return t.initPositions(e.legs),d.showCombinationInSingleTradeView(t,e),e.targetPrice&&e.targetDate&&(d.tradingStrategies.whatifSPrice(e.targetPrice),d.tradingStrategies.whatifDate(new Date(e.targetDate))),!0}var d=this;this.isInSingleTrade=e.observable(!1),this.hasTriggeredTradingStrategies=e.observable(!1),this.isLoading=t.isHowPanelLoading,this.symbol=t.ulCode,this.hasData=e.observable(!1),this.hasOption=e.observable(!1),this.isTradable=e.observable(!1),this.tradeTicket=null,this.tradingStrategiesRaw={},this.tradingStrategiesRaw[h]=null,this.tradingStrategiesRaw[p]=null,this.sentiment=e.observable(),this.quote=null,this.chainEntity=null,this.chain=null,this.stdDev=null,this.predictions=null,this.optionType=e.observable("S");var v=e.observable(!1);this.zeroPremium=e.observable(),this.now=e.observable(new Date);var m=window.setInterval(function(){d.now(new Date)},1e4);this.showZeroPremium=e.computed(function(){var e=d.now(),t=e.getUTCHours(),n=e.getUTCMinutes();if(t>5&&t<13||t==13&&n<=50){var r=!v()&&d.zeroPremium();return r}return window.clearInterval(m),!1}),this.closeNotification=function(){v(!0)},this.checkAndResizeHighcharts=function(){$.each(Highcharts.charts,function(e,t){if(!t||!document.documentElement.contains(t.container))return;var n=$(t.container),r=n.width(),i=n.height(),s=n.parent();if(s.is(":visible")){var o=s.width(),u=s.height();o&&u&&(r!=o||i!=u)&&t.reflow&&t.reflow()}})},this.updateViewModel=function(t){g();if(!t||!t.expandedQuote||!t.tradingStrategies)return;d.quote=i.fromJS(t.expandedQuote,{copy:["symbol"]}),d.quote.changeWithSign=e.computed(function(){var e=d.quote.change();return d.quote.changeSign()==="d"&&(e*=-1),e}),d.quote.extendedChangeFormatted=e.computed(function(){return l.toExtendedChange(d.quote.changeWithSign(),d.quote.percentageChange())}),d.hasOption(t.expandedQuote.hasOption),d.isTradable(t.expandedQuote.isTradable),d.sentiment(t.sentiment),d.optionType("S"),d.hasOption()?(d.chain=d.chainEntity,d.chain.readOptionChains(d.symbol(),t.optionChains,d.quote.last()),d.zeroPremium(d.chain.zeroPremium())):(s.info('Symbol "'+t.expandedQuote.symbol+'" has no listed options',"No Option Chains"),d.chain=null),d.stdDev=new StandardDeviation(d.symbol,d.quote.last(),t.standardDeviations),d.predictions=new Predictions(d.symbol,t.predictions),d.hasData(!0),d.incomeStrategies.updateViewModel(t.callOptimal,t.putOptimal),d.tradingStrategiesRaw[h]=t.tradingStrategies,d.tradingStrategiesRaw[p]=t.oppositeStrategies,d.tradingStrategies.updateViewModel(d.tradingStrategiesRaw[t.sentiment]),E()||d.showDefaultStrategiesView()},this.oppositeSentiment=e.computed(function(){switch(d.sentiment()){case h:return p;case p:return h;default:return null}}),r.on(r.How.TOGGLE_SENTIMENT,y),this.tradeCombination=function(e){var t=u.extractOrderEntries(e);if(!t.length)return s.info(c.localize("app.notifications.stockTradeNotSupport")),!1;r.trigger(r.OrderEntry.PREFILL_ORDER,t,e)},this.currentView=f.create(),this.showCombinationInSingleTradeView=function(e,t){var n=a.create(e,d,t);return d.currentView.activateItem(n)},this.showDefaultStrategiesView=function(){d.currentView.activateItem(d.strategiesOverview)},this.closeExpand=function(){d.currentView.activateItem(d.tradingStrategies)};var w=null;this.restoreSharedStrategy=function(e){if(!e.legs||e.legs.length<1||e.symbol!=d.symbol())return;w=e,d.isLoading()||E()},this.tradingStrategies=new o(d),this.incomeStrategies=null,this.strategiesOverview=null,function(){$(window).on("resize",d.checkAndResizeHighcharts),t.isTradePanelVisible.subscribe(function(){d.checkAndResizeHighcharts()})}(),this.attached=function(){d.checkAndResizeHighcharts(),n.optionChains.get(d.symbol()).done(function(e){d.chain=e,d.hasOption(!0),d.currentView.activateItem(d.tradingStrategies)})}};return new d}),define("modules/custom/chartIQCommon",["jquery","modules/formatting"],function(e,t){function s(){var t=e("#floatDate")[0];if(!t)return;(this.layout.crosshair||STXChart.vectorType!="")&&this.panels.chart?this.panels.chart.bottom?(t.style.left=this.backOutX(STXChart.crosshairX)-t.offsetWidth/2+"px",t.style.bottom=this.chart.canvasHeight-this.panels.chart.bottom+"px",t.style.display="block"):t.style.display="none":t.style.display="none"}function o(){this.chart.crossX!=null&&this.chart.crossX.style.display==""&&e("#floatDate")[0]&&(e("#floatDate")[0].style.display="none")}function u(){var n=this.tickFromPixel(STXChart.crosshairX-this.chart.left);if(!this.chart.dataSet.length||e("#floatDate").length===9)return;this.layout.interval!="minute"&&(n/=this.layout.periodicity);var r=this.chart.dataSet[n];if(!r){var i=this.chart.dataSet[this.chart.dataSet.length-1].Date,s;i=strToDateTime(i);if(this.layout.interval==1){var o=n-this.chart.dataSet.length,u=i.setMinutes(i.getMinutes()+o);s=new Date(u),e("#floatDate")[0]&&(e("#floatDate")[0].innerHTML=t.formatDate(s,"MM-dd hh:mm"))}else if(this.layout.interval=="day"){var a=n-this.chart.dataSet.length,f=i.getDay()+a;for(var l=i.getDay();l<=f;l++)l%5==1&&(a+=2);s=new Date(i.setDate(i.getDate()+a)),e("#floatDate")[0]&&(e("#floatDate")[0].innerHTML=t.formatDate(s,"MM-dd-yyyy"))}}r!=null&&r.Date&&e("#floatDate")[0]&&(e("#floatDate")[0].innerHTML=mmddhhmm(r.Date))}function a(){var t=e("#home")[0];if(!t)return;t.style.display=this.chart.scroll>this.chart.maxTicks?"block":"none"}var n="rgb(215, 108, 126)",r="rgb(159, 208, 114)",i=1;if(window.STXChart==null)return console.log("ChartIQData library hasn't been loaded"),null;STXChart.prototype.prepend("doDisplayCrosshairs",s),STXChart.prototype.prepend("undisplayCrosshairs",o),STXChart.prototype.prepend("headsUpHR",u),STXChart.prototype.append("draw",a);var f=function(s,o,u){function c(){l&&(l.clearDrawings(f.supportAndResistanceDrawings),f.supportAndResistanceDrawings=[])}function h(){function h(e,t,n){a=l.createDrawing("ray",{pnl:"chart",d0:e,d1:c,v0:t,v1:t,col:n,lw:i}),u.push(a)}var e,s,o,u=f.supportAndResistanceDrawings,a,c=new Date(Date.now()+864e5);c=t.formatDate(c,"yyyy-MM-dd");for(e=0;e<f.support.length&&f.support[e];e++)s=f.support[e].value,o=f.support[e].date.substr(0,10),h(o,s,n);for(e=0;e<f.resistance.length&&f.resistance[e];e++)s=f.resistance[e].value,o=f.resistance[e].date.substr(0,10),h(o,s,r)}function p(){e.each(f.supportAndResistanceDrawings,function(e,t){var n=t.highlighted;n?(l.canvasStyle("stx_highlight_vector").color=t.color,t.lineWidth=i+2):t.lineWidth=i})}function d(e){var t=l.chart.maxTicks,n=21*e;l.chart.maxTicks=n,l.chart.scroll=n,l.layout.candleWidth=l.layout.candleWidth*t/n,l.draw(),l.changeOccurred("layout")}var a=350,f=this,l=new STXChart(s);l.manageTouchAndMouse=!0,l.prepend("adjustPanelPositions",function(){l.displayInitialized&&(l.chart.scroll=Math.min(l.chart.maxTicks,l.chart.dataSet.length),l.calculateYAxisMargins(l.chart.panel.yAxis))}),l.prepend("drawVectors",p),l.chart.beginHour=9,l.chart.beginMinute=30,l.chart.endHour=16,l.chart.endMinute=0,l.chart.minutesInSession=390,this.stxx=l,this.id=s.id,this.symbol=o&&o.symbol,this.chartType=u||"Daily",this.showSupportAndResistance=!1,this.supportAndResistanceDrawings=[],this.setSupportAndResistance=function(e){e?(f.support=e.support.slice(0,2),f.resistance=e.resistance.slice(0,2)):(f.support=[],f.resistance=[]),c(),h()},this.setSupportAndResistance(o&&o.supportAndResistance),this.highlightedSR=undefined,this.highlightedColor=undefined,this.highlightSR=function(t){e.each(f.supportAndResistanceDrawings,function(e,n){n.highlighted=n.v0==t}),l.draw()},this.disableSR=function(){f.highlightedSR=undefined,l.draw()},this.loadChart=function(e,t){c(),l.undisplayCrosshairs(),l.setMasterData(t||[]),l.createDataSet(),l.initializeChart($$(f.id+"-chartContainer")),f.home()},this.updateLastData=function(e){l.appendMasterData([e])},this.zoomIn=function(){l.zoomIn(),f.home()},this.click1m=function(){d(1)},this.click3m=function(){d(3)},this.click6m=function(){d(6)},this.zoomOut=function(){if(l.chart.maxTicks>a)return;l.zoomOut(),f.home()},this.home=function(){l.home(),l.draw()},this.toggleCrosshairs=function(){l.layout.crosshair=!l.layout.crosshair,l.draw(),l.changeOccurred("layout"),l.doDisplayCrosshairs()},this.createStudy=function(e,t){STXStudies.go(e,t)},this.createVolumePanel=function(){if(l.panelExists("vchart"))return;l.createPanel("Volume","vchart",l.chart.height/3),l.draw()},this.toggleVolumeUnderlay=function(){l.setVolumeUnderlay(!l.layout.volumeUnderlay)},this.modalBegin=function(){l.openDialog="modal",l.undisplayCrosshairs()},this.modalEnd=function(){l.cancelTouchSingleClick=!0,l.openDialog="",l.doDisplayCrosshairs()},this.dismissDialog=function(e){l.openDialog="",e.style.display="none",STXStudies.colorPickerDiv!=null&&(STXStudies.colorPickerDiv.style.display="none")},this.studyDialog=function(e,t){l.openDialog="study",l.chart.container.parentNode.parentNode.querySelectorAll("#studyDialog")[0].querySelectorAll(".title")[0].innerHTML=e.innerHTML,STXStudies.studyDialog(l,t,l.chart.container.parentNode.parentNode.querySelectorAll("#studyDialog")[0])},this.toggleMenu=function(t){$$(t).style.display=="none"?(e(".menuSelect").css("display","none"),$$(t).style.display="block",l.openDialog="menu"):($$(t).style.display="none",l.openDialog="")},this.oldwidth=e("#"+f.id).width(),this.bindEvents=function(){e(l.chart.container.parentNode.parentNode.querySelectorAll("#dismissDialog")[0]).click(function(){f.dismissDialog(l.chart.container.parentNode.parentNode.querySelectorAll("#studyDialog")[0])}),e(l.chart.container.parentNode.parentNode.querySelectorAll("#createStudy")[0]).click(function(){f.createStudy(this.parentNode,l),f.dismissDialog(l.chart.container.parentNode.parentNode.querySelectorAll("#studyDialog")[0])});var t=e("#"+f.id+"-toggleCrosshairs");t.length&&t.on("click",f.toggleCrosshairs),e("#"+f.id+"-toggle_studies").click(function(){f.toggleMenu(f.id+"-studies")}),e("#"+f.id+" div.study-item").click(function(){f.toggleMenu(f.id+"-studies"),f.studyDialog(this,this.firstChild.innerHTML)}),e("#"+f.id+"-createVolumePanel").click(function(){f.toggleMenu(f.id+"-studies"),f.createVolumePanel()}),e("#"+f.id+"-toggleVolumeUnderlay").click(function(){f.toggleMenu(f.id+"-studies"),f.toggleVolumeUnderlay()});var n=l.chart.container.querySelectorAll("#home")[0],r=$$("zoomIn"),i=$$("zoomOut"),s=$$(f.id+"-1m"),o=$$(f.id+"-3m"),u=$$(f.id+"-6m");i.onmouseover=f.modalBegin,i.onmouseout=f.modalEnd,r.onmouseover=f.modalBegin,r.onmouseout=f.modalEnd,STX.touchDevice?STX.isSurface?(document.body.addEventListener("MSPointerDown",function(e){return function(t){return e.startProxy(t)}}(l),!1),document.body.addEventListener("MSGestureStart",function(){return function(){STX.gestureInEffect=!0}}(l),!1),document.body.addEventListener("MSGestureChange",function(e){return function(t){return e.touchmove(t)}}(l),!1),document.body.addEventListener("MSGestureEnd",function(e){return function(t){return STX.gestureInEffect=!1,e.touchend(t)}}(l),!1),document.onmspointermove=function(e){return function(t){e.moveProxy(t)}}(l),document.onmspointerup=function(e){return function(t){return e.endProxy(t)}}(l),n.onmspointerup=f.home,r.onmspointerup=f.zoomIn,i.onmspointerup=f.zoomOut,s!=undefined&&(s.onmspointerup=f.click1m,o.onmspointerup=f.click3m,u.onmspointerup=f.click6m)):(n.ontouchend=f.home,r.ontouchend=f.zoomIn,i.ontouchend=f.zoomOut,s!=undefined&&(s.ontouchend=f.click1m,o.ontouchend=f.click3m,u.ontouchend=f.click6m,s.removeAttribute("onMouseOut"),o.removeAttribute("onMouseOut"),u.removeAttribute("onMouseOut")),r.removeAttribute("onMouseOver"),i.removeAttribute("onMouseOver"),r.removeAttribute("onMouseOut"),i.removeAttribute("onMouseOut")):(n.onclick=f.home,r.onclick=f.zoomIn,i.onclick=f.zoomOut,s!=undefined&&(s.onclick=f.click1m,o.onclick=f.click3m,u.onclick=f.click6m))},this.readQuotes=function(e){return e},this.main=function(e,t){f.bindEvents(),f.readQuotes(t),f.preLoadChart(e,t),f.loadChart(e,t),f.aftLoadChart(e,t),l.undisplayCrosshairs()}};return f}),define("modules/custom/canvasHelpers",[],function(){function e(e,t){e.beginPath(),e.moveTo(t[0],t[1]);for(var n=2;n<t.length;n+=2)e.lineTo(t[n],t[n+1]);e.fill(),e.closePath()}function t(e,t,n,r,i,s){s==undefined&&(s=2),e.beginPath(),e.moveTo(t,n);var o=r-t,u=i-n,a=Math.floor(Math.sqrt(o*o+u*u)/s),f=o/a,l=u/a,c=0;while(c++<a)t+=f,n+=l,e[c%2==0?"moveTo":"lineTo"](t,n);e[c%2==0?"moveTo":"lineTo"](r,i),e.stroke(),e.closePath()}function n(e,t,n,r,i){function s(){e.moveTo(t,n+i*2),e.lineTo(t-i*2,n+i*5),e.lineTo(t-i*.6,n+i*5),e.lineTo(t-i*.6,n+i*9),e.lineTo(t+i*.6,n+i*9),e.lineTo(t+i*.6,n+i*5),e.lineTo(t+i*2,n+i*5),e.lineTo(t,n+i*2)}i=(r?1:-1)*i,e.beginPath(),s(),e.fill(),e.closePath(),e.strokeStyle="rgba(0,0,0,0.8)",e.lineWidth=1,e.beginPath(),s(),e.stroke(),e.closePath()}function r(e,t,n){e.beginPath(),e.moveTo(0,t),e.lineTo(n,t),e.stroke(),e.closePath()}var i={drawHorisontalLine:r,drawArrow:n,dashedLine:t,drawFilledSegment:e};return i}),define("modules/custom/chartIQSmall",["jquery","modules/custom/chartIQCommon","knockout","modules/custom/canvasHelpers","modules/formatting"],function(e,t,n,r,i){function h(e,t,n){this.ideaPart=e,this.indicatorId=n||t,this.indicatorType=t}var s="rgba(215, 108, 126, 0.8)",o="rgba(159, 208, 114,0.8)",u=.7,a=.12,f=.18,l="Syrah Sentiments",c="chart",p=[new h("CCI Overbought","CCI"),new h("CCI Oversold","CCI"),new h("Williams %R","Williams %R"),new h("RSI Overbought","rsi"),new h("RSI Oversold","rsi"),new h("Stochastic","stochastics"),new h("RSI","rsi","drsi"),new h("CCI","CCI","DCCI")],d=function(h,d){function E(e){if(!w.chart||!w.panels)return undefined;var t=w.panels;if(t[e]==null)return undefined;var n=t[e],r=g[e],i=y[e],s=n.top,o=n.bottom,u=n.max,a=n.min,f,l;return u>a&&u>r||u<a&&u<r?f=s+(o-s)/Math.abs(a-u)*Math.abs(r-u):f=s-100,u>a&&i>a||u<a&&i<a?l=s+(o-s)/Math.abs(a-u)*Math.abs(i-u):l=o+100,{low:f,up:l}}function S(e,t){var n=w.chart.width,i=w.chart.context;i.lineWidth=1,i.strokeStyle="rgba(0,0,0,0.8)",r.drawHorisontalLine(i,e,n),r.drawHorisontalLine(i,t,n)}function T(){if(!w.chart||!w.panels)return;for(var e=0;e<m.length;e++){var t=m[e],n=E(t);if(n===undefined)continue;var u=n.low,a=n.up;S(u,a);var f=w.chart.context;function l(e,t,n,i){t<u&&i<u?(f.fillStyle=s,r.drawFilledSegment(f,[e,t,e,u,n,u,n,i])):t<u&&i>u?(A=((n-e)*u-n*t+e*i)/(i-t),f.fillStyle=s,r.drawFilledSegment(f,[e,t,e,u,A,u])):t>u&&i<u?(A=((n-e)*u-n*t+e*i)/(i-t),f.fillStyle=s,r.drawFilledSegment(f,[n,i,n,u,A,u])):t>a&&i>a?(f.fillStyle=o,r.drawFilledSegment(f,[e,t,e,a,n,a,n,i])):t>a&&i<a?(A=((e-n)*a+n*t-e*i)/(t-i),f.fillStyle=o,r.drawFilledSegment(f,[e,t,e,a,A,a])):t<a&&i>a&&(A=((e-n)*a+n*t-e*i)/(t-i),f.fillStyle=o,r.drawFilledSegment(f,[n,i,n,a,A,a]))}var c=w.panels[t],h=w.chart.dataSegment,p=(t=="drsi"?"RSI ":"Result ")+t;for(var d=0;d<h.length-1;d++){if(h[d]==null)continue;var g=h[d][p],y=h[d+1][p];if(g==null||y==null)continue;var b=w.pixelFromBar(d),T=w.pixelFromPrice(g,c),N=w.pixelFromBar(d+1),C=w.pixelFromPrice(y,c);l(b,T,N,C)}if(!x)continue;var k=new Date(x.dateOfScan),L=null;for(d=h.length-1;d>=0;d--)if(h[d]!=null&&i.compareDates(k,h[d].DT)>=0){L=d;break}if(L==null)return;var A=w.pixelFromBar(L)+1,O,M=v.sentiment==="Bullish";M?(f.strokeStyle=o,f.fillStyle=o,O=w.pixelFromPrice(h[L].Low)):(f.strokeStyle=s,f.fillStyle=s,O=w.pixelFromPrice(h[L].High)),r.dashedLine(f,A,0,A,w.chart.canvas.height,5);var _=c.bottom/100;r.drawArrow(f,A,O,M,_)}}function C(e){e&&!N&&(N=STXStudies.addStudy(w,l,{display:l,id:l},{Bearish:"rgb(215, 108, 126)",Bullish:"rgb(159, 208, 114)",Neutral:"rgb(255, 219, 141)"})),!e&&N&&(STXStudies.removeStudy(w,N),N=null)}function k(){if(!w)return;for(var e in w.panels){if(!w.panels.hasOwnProperty(e))continue;e===l?w.panels[e].percent=a:e===c?w.panels[e].percent=u:w.panels[e].percent=f}w.draw()}function L(e){b!=undefined&&b.libraryEntry!=undefined&&STXStudies.removeStudy(w,b);if(!e)return;var t=e.rules,n=t[0].reason;n.indexOf("Bullish")!=-1?v.sentiment="Bullish":v.sentiment="Bearish";var r=t[0].period.toString()||"14";for(var i=0;i<p.length;i++){var s=p[i];if(n.indexOf(s.ideaPart)!==-1){var o=s.indicatorType==="rsi"?{RSI:"#000000"}:{Result:"#000000"};b=STXStudies.addStudy(w,s.indicatorType,{Period:r,id:s.indicatorId},o);break}}}var v=this;t.call(this,h,d);var m=["Williams %R","CCI","stochastics","drsi","DCCI"],g={},y={},b;g["Williams %R"]=-20,y["Williams %R"]=-80,g.CCI=100,y.CCI=-100,g.stochastics=80,y.stochastics=20,g.drsi=70,y.drsi=30,g.DCCI=100,y.DCCI=-100;var w=this.stxx;w.append("draw",T);var x=d&&d.tradeIdea;$$("techInfoSign")&&e("#techInfoSign").tooltip({placement:"bottom"});var N=null;this.readQuotes=function(e,t,r){var i,s;if(e==null||e.length<=0)return;for(var o=0;o<e.length;o++)s=e[o],s.Date=s.tradeDate.substring(0,10),s.Open=parseFloat(s.openPrice),s.Close=parseFloat(s.closePrice),s.High=parseFloat(s.highPrice),s.Low=parseFloat(s.lowPrice),s.Volume=parseFloat(s.matchQuantity),s.Adj_Close=s.Close,s.Volume==0&&(s.Adj_Close=s.Low=s.High=s.Open=s.Close),t&&(i=n.utils.arrayFirst(t,function(e){return e.date==s.date}),s.SyrahSentimentShortTerm=i?i.value:null),r&&(i=n.utils.arrayFirst(r,function(e){return e.date==s.date}),s.SyrahSentimentLongTerm=i?i.value:null)},this.update=function(e){if(!e)return;x=e.tradeIdea,v.readQuotes(e.historicalQuotes,e.syrahSentimentShortTerm,e.syrahSentimentLongTerm),v.loadChart(e.symbol,e.historicalQuotes),v.setSupportAndResistance(e.supportAndResistance),C(e.syrahSentimentShortTerm&&e.syrahSentimentShortTerm.length>0),L(x),v.symbol=e.symbol,k()},this.resizeChart=function(){w.resizeChart()},this.studyDialog=function(e,t){w.openDialog="study",$$("studyDialog").querySelectorAll(".title")[0].innerHTML=e.innerHTML,STXStudies.studyDialog(w,t,$$("studyDialog"))},function(){w.mousemove({}),v.bindEvents(),w.chart.symbol="Daily",v.update(d),v.toggleCrosshairs(),v.toggleVolumeUnderlay(),w.undisplayCrosshairs(),v.home()}()};return d}),define("dataServices/models/supportAndResistanceModel",["knockout","modules/formatting"],function(e,t){var n=function(){var n=this,r=function(n,r){this.value=n,this.formattedValue=t.toFractionalCurrency(n),this.percentageChange=e.computed(function(){if(typeof r=="undefined"||r==null)return null;var e=r.lastPrice(),t=(n-e)*100/e;return t})};this.support=e.observable([]),this.resistance=e.observable([]),this.update=function(e,t){function i(e){var n=new r(e.value,t);return n}var s=[],o=[];e&&(s=e.support.slice(0,2).map(i),o=e.resistance.slice(0,2).map(i)),n.support(s),n.resistance(o)}};return n}),define("viewmodels/tradeIdeas/chartIq",["knockout","modules/context","dataContext","modules/custom/chartIQSmall","dataServices/models/supportAndResistanceModel"],function(e,t,n,r,i){var s=function(s){function u(){var e=o.selectedTradeIdea();e&&o.technicalRank(e.technicalRank)}function a(e){n.historicalQuotes.get(e,{period:"5y"}).done(function(e){var t=e().filter(function(e){return e.matchQuantity>0}),n=[];t.forEach(function(e,r){var i={};i.Adj_Close=r<t.length-1?t[r+1].lastClosePrice:e.closePrice,i.Close=e.closePrice,i.Date=e.tradeDate.substring(0,10),i.High=e.highPrice,i.Low=e.lowPrice,i.Open=e["openPrice"]==0?e.closePrice:e.openPrice,i.Volume=e.matchQuantity,n.push(i)}),o.chart.update({historicalQuotes:t})}).always(function(){t.isWhyPanelLoading(!1)})}var o=this;this.quote=e.observable(s),this.highlightS=function(e){var t=o.chart;t.highlightSR(e.value,"green")},this.highlightR=function(e){var t=o.chart;t.highlightSR(e.value,"red")},this.disableLevel=function(){var e=o.chart;e.disableSR()},this.selectedTradeIdea=t.selectedTradeIdea,this.technicalRank=e.observable().extend({nullValue:"No Rank"}),t.selectedTradeIdea.subscribe(u),this.sentiment=e.observable(null),this.sentimentCssClass=e.computed(function(){var e=o.sentiment(),t=e?e.toLowerCase():"";return t}),securityCode=t.ulCode(),this.supportAndResistance=new i,this.updateSupportAndResistanc=function(e){n.quotation.get(e).done(function(t){n.signals.get(e+"/5y").done(function(e){o.supportAndResistance.update(e,t)})})},this.updateSupportAndResistanc(securityCode),t.ulCode.subscribe(this.updateSupportAndResistanc),this.chart=null,this.attached=function(){o.chart=new r($("#powerhouseProHistoricalChart-chartContainer")[0],o.chartViewModel()),a(t.ulCode())},this.chartViewModel=e.observable(),this.chartViewModel.subscribe(function(e){o.chart&&o.chart.update(e)}),this.hasHistoricalData=e.observable(!0),this.noHistoricalDataNote=e.observable(""),t.ulCode.subscribe(a),this.updateViewModel=function(e,n,r){if(n.historicalQuotes==null||n.historicalQuotes.length===0){var i='Symbol "'+r.symbol()+'" has no Historical Data';o.hasHistoricalData(!1),o.noHistoricalDataNote(i)}else o.hasHistoricalData(!0);o.sentiment(n.sentiment),o.quote(r),o.chartViewModel(n),t.supportAndResistance(o.supportAndResistance),o.supportAndResistance.update(n.supportAndResistance,r);var s=o.selectedTradeIdea();s?o.technicalRank(s.technicalRank):o.technicalRank(e)},this.fullChart=e.observable(!1),this.fullChart.subscribe(function(){o.showStudyMenu(!1),window.setTimeout(function(){o.chart.stxx.resizeChart()})}),this.showStudyMenu=e.observable(!1),this.showStudyMenu.subscribe(function(e){e&&o.showTypeMenu(!1)}),this.openStudyDialog=function(e,t){o.showStudyMenu(!1),t=="Volume"?o.chart.createVolumePanel():t=="Vol Underlay"?o.chart.toggleVolumeUnderlay():o.chart.studyDialog(e,t)},this.popularStudyCols=[{studyItems:[{name:"ATR",studyText:"真实波幅"},{name:"Bollinger Bands",studyText:"布林极限"},{name:"Chaikin MF",studyText:"佳庆资金流量指标"},{name:"CCI",studyText:"商品路径指标"},{name:"Directional",studyText:"定向运动系统指标"},{name:"Hist Vol",studyText:"历史波动指数"},{name:"Keltner",studyText:"肯特纳通道"},{name:"macd",studyText:"平滑异同平均"},{name:"Momentum",studyText:"动量摆动指标"},{name:"M Flow",studyText:"资金流量指标"}]},{studyItems:[{name:"ma",studyText:"指数平均数指标"},{name:"On Bal Vol",studyText:"累积能量线"},{name:"PSAR",studyText:"抛物线指标"},{name:"Price ROC",studyText:"价格变动率指标"},{name:"rsi",studyText:"相对强弱指标"},{name:"stochastics",studyText:"随机动量指标"},{name:"TRIX",studyText:"三重指数平均线"},{name:"Volume",studyText:"成交量"},{name:"Williams %R",studyText:"威廉指标"},{name:"W Acc Dist",studyText:"威廉多空力度线"}]}],this.techStudyCols=[{studyItems:[{name:"Acc Swing",studyText:"振动升降指标"},{name:"Aroon",studyText:"阿隆指标"},{name:"Aroon Osc",studyText:"阿隆摆动指标"},{name:"COG",studyText:"利用中心法"},{name:"Chaikin Vol",studyText:"佳庆指标"},{name:"Chande Mtm",studyText:"钱德动量摆动指标"},{name:"Coppock",studyText:"估波指标"},{name:"EOM",studyText:"简易波动指标"},{name:"Ehler Fisher",studyText:"埃勒斯费舍尔变换"},{name:"Elder Force",studyText:"劲道指数"},{name:"Elder Ray",studyText:"艾达透视"},{name:"Fractal Chaos Bands",studyText:"混沌分形指标"},{name:"stochastics",studyText:"随机摆动"}]},{studyItems:[{name:"Fractal Chaos",studyText:"混沌分形摆动指标"},{name:"High Low",studyText:"高低极限"},{name:"High-Low",studyText:"高减低"},{name:"HHV",studyText:"最高及高值"},{name:"Intraday Mtm",studyText:"日内动量指标"},{name:"Lin Fcst",studyText:"线性回归预测指标"},{name:"Lin Incpt",studyText:"线性回归插值指标"},{name:"Lin R2",studyText:"线性回归R2指标"},{name:"LR Slope",studyText:"线性回归预测指标"},{name:"LLV",studyText:"最低及低值"},{name:"Mass Idx",studyText:"梅斯线"},{name:"Med Price",studyText:"中间价格指标"},{name:"MA Env",studyText:"移动平均封装线"}]},{studyItems:[{name:"Neg Vol",studyText:"负成交量"},{name:"Perf Idx",studyText:"成绩衡量指标"},{name:"Pos Vol",studyText:"正成交量"},{name:"Price Osc",studyText:"价格摆动指标"},{name:"Price Vol",studyText:"价量趋势指标"},{name:"Prime Number Bands",studyText:"质数指标"},{name:"Prime Number",studyText:"质数摆动指标"},{name:"QStick",studyText:"Q棒指标"},{name:"Random Walk",studyText:"随机行走指标"},{name:"RAVI",studyText:"趋势横盘分别指标"},{name:"Schaff",studyText:"沙夫趋势周期"},{name:"STD Dev",studyText:"标准差"},{name:"Stch Mtm",studyText:"随机动量指标"}]},{studyItems:[{name:"Swing",studyText:"振动升降指标"},{name:"Time Fcst",studyText:"时间序列预测法"},{name:"Trade Vol",studyText:"交易量指标"},{name:"True Range",studyText:"平均真实波幅"},{name:"Typical Price",studyText:"初始价格指标"},{name:"Ultimate",studyText:"终极指标"},{name:"VT HZ Filter",studyText:"十字过滤线"},{name:"Vol Underlay",studyText:"成交量（同界面）"},{name:"Vol Osc",studyText:"成交量摆动指标"},{name:"Vol ROC",studyText:"成交量摆动"},{name:"Weighted Close",studyText:"加权收盘价"}]}],this.showTypeMenu=e.observable(!1),this.showTypeMenu.subscribe(function(e){e&&o.showStudyMenu(!1)}),this.setChartStyle=function(e){o.showTypeMenu(!1),o.chart.stxx.setChartType(e)},this.typeItems=[{typeText:"蜡烛图",typeName:"candle"},{typeText:"条状图",typeName:"bar"},{typeText:"彩色条状图",typeName:"colored_bar"},{typeText:"直线图",typeName:"line"}],this.activeMonthButton=e.observable(3),this.click1m=function(){o.chart&&o.chart.click1m(),o.activeMonthButton(1)},this.click3m=function(){o.chart&&o.chart.click3m(),o.activeMonthButton(3)},this.click6m=function(){o.chart&&o.chart.click6m(),o.activeMonthButton(6)},this.zoomIn=function(){o.chart&&o.chart.zoomIn()},this.zoomOut=function(){o.chart&&o.chart.zoomOut()}};return s}),define("koBindings/bootstrap",["jquery","knockout","bootstrap"],function(e,t){function n(e,t,n){for(var r in t)n[r]&&e.on(t[r],n[r])}t.bindingHandlers.tab={init:function(r,i,s,o,u){var a=i(),f={onShow:"show.bs.tab",onShown:"shown.bs.tab"},l=e(r).tab(),c=function(){return function(){l.tab("show")}};n(l,f,a),t.bindingHandlers.click.init(r,c,s,o,u)}},t.bindingHandlers.bootstrapModal={init:function(r,i,s,o,u){var a=s().template,f=s().modalOptions||{},l=i(),c={onShow:"show.bs.modal",onShown:"shown.bs.modal",onHide:"hide.bs.modal",onHidden:"hidden.bs.modal"};t.utils.toggleDomNodeCssClass(r,"modal fade",!0);if(a){var h=u.createChildContext(o);t.utils.extend(h,l),t.renderTemplate(a,h,null,r)}else t.bindingHandlers.with.init(r,i,s,o,u);f.show!=null&&l.show(!!f.show),f.show=!1;var p=e(r).modal(f);n(p,c,l),p.on(c.onHidden,function(){l.show(!1)});var d=t.computed(function(){var t=l.show();e(r).modal(t?"show":"hide")});return t.utils.domNodeDisposal.addDisposeCallback(r,function(){d.dispose();for(var e in c)c.hasOwnProperty(e)&&p.off(c[e])}),{controlsDescendantBindings:!0}}},t.bindingHandlers.carousel={init:function(r,i,s){function u(){var i={onSlide:"slide.bs.carousel",onSlid:"slid.bs.carousel"},u=s.get("carouselOptions"),a=u?u.options:{},f=e(r).carousel(a);u&&n(f,i,u),f.on("slid.bs.carousel",function(){var e=f.find(".item.active").index();o(e)}),e(f.find(".item")[t.unwrap(o)]).addClass("active")}var o=i();t.unwrap(o),window.setTimeout(u,1)},update:function(n,r){function o(){e(n).carousel(s)}var i=r(),s=t.unwrap(i);e(n).data("bs.carousel")?e(n).carousel(s):window.setTimeout(o,1)}}}),define("koBindings/customBindings",["knockout","jquery"],function(e,t){e.bindingHandlers.href={update:function(t,n){e.bindingHandlers.attr.update(t,function(){return{href:n()}})}},e.bindingHandlers.toggle={init:function(t,n){var r=n();e.applyBindingsToNode(t,{click:function(){r(!r())}})}},e.bindingHandlers.grouping={init:function(e,n){var r=n(),i=r.separator||"-";t(e).keyup(function(){t(this).val(function(e,t){return t=t.replace(/[^\d]/g,"").match(/.{1,4}/g),t?t.join(i):""})})}},e.bindingHandlers.hoverTargetId={init:function(n,r){function i(e){t(n)[e]("slide",{direction:"up"},100)}var s=i.bind(null,"hide"),o=i.bind(null,"show"),u=t("#"+e.utils.unwrapObservable(r()));e.utils.registerEventHandler(u,"mouseover",o),e.utils.registerEventHandler(u,"mouseleave",s),s()}},e.bindingHandlers.foreachOptions={init:function(t,n,r){function o(){window.setTimeout(function(){s.valueHasMutated()})}var i=n(),s=r().value;if(i.subscribe&&s&&s.valueHasMutated){var u=i.subscribe(o);e.utils.domNodeDisposal.addDisposeCallback(t,function(){u.dispose()})}else o();return e.bindingHandlers.foreach.init.apply(this,arguments)},update:function(){return e.bindingHandlers.foreach.update.apply(this,arguments)}}}),define("koBindings/changeFlash",["knockout","jquery"],function(e,t){return e.bindingHandlers.changeFlash={init:function(t,n){t.changeFlashOldValue=e.unwrap(n())},update:function(n,r,i){var s=e.unwrap(i().increaseCss)||"increaseCss",o=e.unwrap(i().decreaseCss)||"decreaseCss",u=e.unwrap(i().flashDelay)||2e3,a=e.unwrap(r()),f=n.changeFlashOldValue;n.changeFlashOldValue=a,a-f>1e-4?(t(n).removeClass(o),t(n).addClass(s),setTimeout(function(){t(n).removeClass(s)},u)):a-f<-0.0001&&(t(n).removeClass(s),t(n).addClass(o),setTimeout(function(){t(n).removeClass(o)},u))}},e}),define("viewmodels/tradeIdeas/whyPanel",["jquery","knockout","dataContext","modules/formatting","modules/context","modules/session","viewmodels/tradeIdeas/quoteWidget","viewmodels/tradeIdeas/howPanel","viewmodels/tradeIdeas/chartIq","modules/enums","koBindings/textFormatted","koBindings/bootstrap","koBindings/customBindings","koBindings/changeFlash"],function(e,t,n,r,i,s,o,u,a,f){var l=function(){var r=this;this.backdrop=t.computed(function(){return!s.isAuthenticated()||i.isWhyPanelLoading()}),this.isInitialized=t.observable(!0),this.isTradePanelVisible=t.observable(!0),this.selectedTradeIdea=i.selectedTradeIdea,this.selectedTradeIdeaRule=t.observable(null),this.selectedTradeIdeaRuleIndex=t.observable(0),this.stockCode=t.observable(i.ulCode()),this.quoteWidget={};var l=this.selectedTradeIdea();l&&this.selectedTradeIdeaRule(l.rules[0]),this.selectedTradeIdea.subscribe(function(e){r.selectedTradeIdeaRuleIndex(0),e&&r.stockCode(e.securityCode)}),this.selectedTradeIdeaRuleIndex.subscribe(function(e){if(e!=null){var t=r.selectedTradeIdea();t&&r.selectedTradeIdeaRule(t.rules[e])}else r.selectedTradeIdeaRule(null)}),this.showBullishStrategies=function(){var e=u.tradingStrategies.allCombinations();e.forEach(function(e){e.sentiment()=="bearish"&&(e.editorVM.flipBS(),i.trendSentiment("Bullish"))})},this.showBearishStrategies=function(){var e=u.tradingStrategies.allCombinations();e.forEach(function(e){e.sentiment()=="bullish"&&(e.editorVM.flipBS(),i.trendSentiment("Bearish"))})},this.symbolWidget=new o,this.sentence=t.observable(null),r.updatesentence=function(){n.quotation.get(i.ulCode()).done(function(e){n.signals.get(i.ulCode()+"/5y").done(function(t){var n="",s,o;i.trendSentiment()=="Bearish"?n=e.securityName+" 处在下降通道，压力线在 "+t.resistance[0].value+", 支撑线在 "+t.support[0].value+" 。":i.trendSentiment()=="Bullish"?n=e.securityName+" 处在上升通道，支撑线在 "+t.support[0].value+" , 压力线在 "+t.resistance[0].value+" 。":n="",r.sentence(n)})})},this.selectedTradeIdea.subscribe(function(){r.updatesentence(),r.selectedTradeIdea().sentiment==f.Sentiment.BULLISH?r.showBullishStrategies():r.showBearishStrategies()}),r.chartIq=new a,this.selectedTradeIdeaRule.subscribe(function(e){if(!e){r.selectedTradeIdeaRuleIndex(0);return}var t=r.selectedTradeIdea().rules.length;for(var n=0;n<t;n++)if(r.selectedTradeIdea().rules[n].ruleMatch==r.selectedTradeIdeaRule().ruleMatch){r.selectedTradeIdeaRuleIndex(n);return}r.selectedTradeIdeaRuleIndex(0)}),this.isFirst=t.computed(function(){return r.selectedTradeIdea()==null?!0:r.selectedTradeIdeaRuleIndex()==0}),this.isLast=t.computed(function(){if(r.selectedTradeIdea()==null)return!0;var e=r.selectedTradeIdeaRuleIndex();return e==r.selectedTradeIdea().rules.length-1}),this.onIntradayShown=function(){e(window).resize()},this.attached=function(){r.updatesentence()}};return new l}),define("viewmodels/index",["viewmodels/tradeIdeas/tradeIdeas","viewmodels/tradeIdeas/whyPanel","viewmodels/tradeIdeas/howPanel","modules/context"],function(e,t,n,r){return r.isTradeIdPanelLoading(!0),{what:e,why:t,how:n}}),define("koBindings/slideVisible",["knockout","jquery"],function(e,t){return e.bindingHandlers.slideVisible={init:function(n,r){var i=e.utils.unwrapObservable(r());t(n).toggle(i)},update:function(n,r){var i=r();e.utils.unwrapObservable(i)?t(n).slideDown(500):t(n).slideUp(500)}},e}),define("koBindings/arrowMove",["knockout","jquery"],function(e,t){return e.bindingHandlers.arrowMove={init:function(t,n){t.lastPriceVal=e.unwrap(n())},update:function(n,r,i){var s=e.unwrap(i().highBound)||0,o=e.unwrap(i().lowBound)||100,u=e.unwrap(i().lastPriceVal)||50,a=(u-o)/(s-o)*100;t(n).css("left",a+"%")}},e}),define("viewmodels/bottom",["knockout","komapping","dataContext","jquery","events","modules/localizer","modules/configurations","durandal/system","koBindings/slideVisible","jquery-hotkeys","koBindings/arrowMove","koBindings/bootstrap"],function(e,t,n,r,i,s,o,u){function l(){console.log("in loadFundInfo"),n.fund.get("","",!0).done(function(e){f.portfolioFund(e)})}function c(){n.indexValue.get().done(function(t){f.portfolioindexValue(e.unwrap(t))})}function h(){f.traceVisible(!f.traceVisible())}var a="alt+ctrl+l",f={};f.shangHaiIndex=e.observable(),f.traceVisible=o.App.showTrace,f.inDebugMode=e.observable(!1),f.title="pages.trade",f.isExpanded=e.observable(!1),f.portfolioFund=e.observable(null),f.portfolioindexValue=e.observable(null),f.indexes={shIndex:e.computed(function(){return f.portfolioindexValue()?f.portfolioindexValue()[0].currentPeriod:"N/A"}),szIndex:e.computed(function(){return f.portfolioindexValue()?f.portfolioindexValue()[1].currentPeriod:"N/A"}),hsIndex:e.computed(function(){return f.portfolioindexValue()?f.portfolioindexValue()[2].currentPeriod:"N/A"})},f.fund={totalAssetsValue:e.computed(function(){return f.portfolioFund()?f.portfolioFund().totalAssetsValue():"N/A"}),availableFund:e.computed(function(){return f.portfolioFund()?f.portfolioFund().availableFund():"N/A"}),floatingPL:e.computed(function(){return f.portfolioFund()?f.portfolioFund().floatingPL():"N/A"}),marginRate:e.computed(function(){return f.portfolioFund()?f.portfolioFund().marginRate()*100:"N/A"})},f.attached=function(){l(),c(),setInterval(c,6e4),setInterval(l,1e4),r(document).bind("keydown",a,h),setInterval(f.lastRefreshAuto,1e3)},f.detached=function(){clearInterval(c),clearInterval(l),clearInterval(f.lastRefreshAuto),r(document).unbind("keydown",h)};var p=5e3;return f.refreshOrders=function(){var e=Date.now()-(f.lastRefresh()&&f.lastRefresh().getTime());e>p?(i.trigger(i.Bottom.INTRADAY_REFRESH),l(),c()):console.log(s.localize("trade.donotRefreshFrequently"))},f.lastRefresh=e.observable(),f.lastRefreshAuto=function(){f.lastRefresh(new Date)},i.on(i.Bottom.INTRADAY_REFRESHED,function(){f.lastRefresh(new Date)}),i.on(i.Bottom.IS_SHOWN,function(e){arguments.length>0?f.isExpanded(e):f.isExpanded(!f.isExpanded())}),i.on(i.OrderEntry.PREFILL_ORDER,function(e){r.isArray(e)&&e.length>1?f.isExpanded(!1):f.isExpanded(!0)}),f.counter=!1,f.isExpanded.subscribe(function(e){i.trigger(i.Bottom.IS_SHOWN,e),f.counter=!f.counter,f.counter?(r(".appearWhenUp").css("display","block"),r(".appearWhenDown").css("display","none")):(r(".appearWhenUp").css("display","none"),r(".appearWhenDown").css("display","block"))}),f}),define("dataServices/traceDataService",["jquery","dataServices/socketConnection"],function(e,t){var n={TRACE_START:"traceStart",TRACE_RESULT:"traceResult",TRACE_ERROR:"traceError"},r=new t("SZKingdomTraceHub",n);return r}),define("viewmodels/trace",["jquery","knockout","dataServices/traceDataService"],function(e,t,n){function s(e,t,n){var r=null;return e.some(function(i,s){return t.call(n,i,s,e)?(r=i,!0):!1}),r}function o(e){var n=this;this.functionName=e,this.state=t.observable(i.RUNNING),this.stateTranslation=t.computed(function(){var e=n.state();switch(e){case i.RUNNING:return"trace.running";case i.COMPLETED:return"trace.executionTime";case i.FAILED:return"trace.executionFailed";default:return""}}),this.seconds=0,this.milliseconds=0}function u(e,t){e.seconds=Math.floor(t/1e3),e.milliseconds=Math.ceil(t-e.seconds*1e3)}function a(e,t){var n=r.libraryFunctionsInProgress(),i=s(n,function(t){return t.functionName===e});return i==null&&(i=new o(e),r.libraryFunctionsInProgress.push(i)),u(i,t),window.setTimeout(function(){r.libraryFunctionsInProgress.remove(i)}),i}var r={},i={RUNNING:"running",COMPLETED:"completed",FAILED:"failed"};return r.removeNotification=function(t){t.nodeType===1&&window.setTimeout(function(){e(t).slideUp(500,function(){e(t).remove()})},5e3)},r.libraryFunctionsInProgress=t.observableArray([]),n.on(n.TRACE_START,function(e){var t=new o(e);r.libraryFunctionsInProgress.push(t)}),n.on(n.TRACE_RESULT,function(e,t){var n=a(e,t);n.state(i.COMPLETED)}),n.on(n.TRACE_ERROR,function(e,t,n){var r=a(e,n);r.state(i.FAILED)}),r.activate=function(){return n.connect()},r}),define("koBindings/perfectScrollbar",["jquery","knockout","perfectScrollbar"],function(e,t){t.bindingHandlers.perfectScrollbar={init:function(t,n){var r=n();e(t).perfectScrollbar(r)},update:function(n,r,i){var s=i.get("scrollTop");if(s){var o=t.unwrap(s);e(n).scrollTop(o),e(n).perfectScrollbar("update")}}}}),define("viewmodels/quotes",["knockout","dataContext","komapping","events","plugins/router","modules/context","koBindings/textFormatted","koBindings/redGreen","koBindings/bootstrap","koBindings/perfectScrollbar","koBindings/changeFlash"],function(e,t,n,r,i,s){function o(){var n=this;this.optionables=e.observableArray([]),this.securityCode=s.ulCode,this.fullChart=e.observable(!1),this.pullOptionableQuotes=function(){t.quotation.get().done(function(t){if(e.isObservable(t))n.optionables(t()),n.optionables().some(function(e){return e.securityCode==n.securityCode()?(r.trigger(r.Quotes.CHANGE_DETAILS,e),!0):!1});else debugger})},i.on("router:route:activating",function(e){e!=n&&$(".stx_annotation").hide()}),this.columnHeaders=e.computed(function(){var e=n.optionables().length,t=Math.min(3,e);return new Array(t)}),this.goToChains=function(e){s.symbolCode(e.securityCode),i.navigate("#chains")},this.updateChart=function(e){return s.symbolCode(e.securityCode),r.trigger(r.Quotes.CHANGE_DETAILS,e),!1},this.marketDataDetail=e.observable(),r.on(r.Quotes.CHANGE_DETAILS).then(function(e){n.marketDataDetail(e)}),this.showHistChartTab=function(){},this.showIntradayChartTab=function(){$(window).resize()},this.pullOptionableQuotes()}return o}),define("viewmodels/chains",["knockout","dataContext","modules/grid","modules/dropDownList","modules/context","modules/combinationViewModel","modules/combinationHelpers","modules/combinationChart","modules/kendoWindow","modules/localizer","jquery","events","modules/helpers","modules/formatting","koBindings/changeFlash","koBindings/redGreen","kendo","knockout-kendo","koBindings/kendoExt"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function d(){function w(e){var t={};return u.strategyTemplates.forEach(function(n){n.name==e&&(t.org=n,n.pairStrategyId&&u.strategyTemplates.forEach(function(e){e.id==n.pairStrategyId&&(t.pair=e)}))}),t}function E(t,n,r){var i=n.split("."),s=e.computed(function(){var n=0,s=0;return t.forEach(function(t){n+=t.quantity*e.unwrap(i.length==2?t[i[0]][i[1]]:t[i[0]]),s+=t.quantity}),r&&(n/=s),n},u).extend({rateLimit:10});return s}function x(e,t,n,r,i){var s=e.length,o=parseInt(u.selectedWidth()),a=parseInt(u.selectedWingspan()),f=e.map(function(e,f){var l={};if(e.legType!="Security"){var c=e.offset;s==2?t&&f==1&&(c=o):s==3?n&&f==1?c=a:n&&f==2&&(c=2*a):s==4&&(n&&f==1?c=a:n&&t&&f==2?c=a+o:n&&!t&&f==2?c=(f-1)*a:n&&t&&f==3?c=2*a+o:n&&!t&&f==3&&(c=2*a));var h=r+c;if(h>=i.length)throw{exception:"Option Index out of Boundary"};var p=e.legType.toLowerCase()+"Option",d=i[h][p];l={greeks:{sigma:d.greeks?d.greeks.sigma:null,delta:d.greeks?d.greeks.delta:null,theta:d.greeks?d.greeks.theta:null,gamma:d.greeks?d.greeks.gamma:null,vega:d.greeks?d.greeks.vega:null,rho:d.greeks?d.greeks.rho:null},volume:d.volume,openInterest:d.uncoveredPositionQuantity,bid:d.bid,ask:d.ask,optionNumber:d.optionNumber,legType:e.legType,quantity:e.quantity,strikePrice:i[h].strikePrice,change:d.change,latestTradedPrice:d.latestTradedPrice,previousClose:d.previousClose},l.combLeg={buyOrSell:e.buyOrSell,expiry:i[h].expiryDate,legType:e.legType,quantity:e.quantity,strikePrice:i[h].strikePrice}}else l={greeks:{sigma:0,delta:0,theta:0,gamma:0,vega:0,rho:0},volume:0,openInterest:0,bid:u.lastPrice,ask:u.lastPrice,quantity:e.quantity/1e3*u.multiplier(),optionNumber:u.securityCode(),previousClose:u.previousClose},l.combLeg={buyOrSell:e.buyOrSell,expiry:i[0].expiryDate,legType:"SECURITY",quantity:e.quantity/1e3*u.multiplier(),strikePrice:null};return l}),l=new S(f);return l}function C(){l.each(T,function(e,t){N.forEach(function(e){var n=h.getValue(t,e);n!=null&&typeof n.dispose=="function"&&(n.dispose(),delete n)})})}function k(n){u.gridReady(!1),u.itemsListAll.removeAll(),t.optionChains.get(n).done(function(t){u.chains=t,u.expiryChoices.removeAll(),u.selectedExpiryItem(null),u.expiryStrikes(t.expiryStrikes),u.expiryChoices([]),u.multipliers(t.multipliers),u.multiplier(t.defaultMultiplier),u.itemsListAll(t.allRows.slice(0)),u.step=t.rows[1].strikePrice-t.rows[0].strikePrice,t.expirationDates.forEach(function(t){u.expiryChoices.push({textDisplayed:p.formatDate(t.date,"yyyy年MM月")+"("+t.noOfDaysToExpiry+")",expiry:t.expiryKey,date:t.date,daysToExpiry:t.noOfDaysToExpiry,isActivated:u.expiryChoices().length==0?e.observable(!0):e.observable(!1)})}),u.expiryChoices().length&&u.selectedExpiryItem(u.expiryChoices()[0].expiry)}).always(function(){u.gridReady(!0)})}function L(e){u.quoteReady(!1),t.quotation.get(e).done(function(e){u.securityName(e.securityName),u.lastPrice(e.lastPrice()||e.previousClose()),u.previousClose(e.previousClose())}).always(function(){u.quoteReady(!0)})}function A(){t.strategies.get().done(function(t){u.strategyTemplates=e.unwrap(t)}).always(function(){u.strategyReady(!0)}),t.strategyGroups.get().done(function(t){t=e.unwrap(t),u.strategyGroups=t,t.sort(function(e,t){return e.displayOrder-t.displayOrder}),t.forEach(function(e){e.display&&u.strategyComboChoices.push({key:"chains."+e.name,value:e.callStrategyName})})})}var u=this;this.securityCode=i.ulCode,this.gridReady=e.observable(!1),this.quoteReady=e.observable(!1),this.expiryStrikes=e.observable(),this.combination=e.observable(),this.isPlVisible=e.observable(!1),this.securityName=e.observable(!1),this.lastPrice=e.observable(!1),this.previousClose=e.observable(!1),this.greekToggled=e.observable(!1),this.historicalOrderToggled=e.observable(!1),this.strategyReady=e.observable(!1),this.strategyTemplates=[],this.strategyTemplate=e.observable(!1),this.strategyGroups=[],this.multipliers=e.observableArray(),this.multiplier=e.observable(),this.isTDisplay=e.observable(!0),this.step=!1,this.greeksToggleIcon=e.computed(function(){var e=f.activeLocale();return"lastPriceToggle_"+e}),this.gridType=e.computed(function(){var e=u.strategyTemplate();return e&&e.org?e["org"].name=="Call"?1:e.pair?2:3:1}),this.toggleGreek=function(){u.greekToggled(!u.greekToggled())},this.showQueryArea=function(){u.isTDisplay(!0)},this.hideQueryArea=function(){u.isTDisplay(!1)},this.selectedLeg=!1,this.strategyComboChoices=e.observableArray([]),this.selectedStrategy=e.observable("Call");var d=new r;this.strategyOptions=l.extend(d.baseOptions(),{data:u.strategyComboChoices,value:u.selectedStrategy}),this.strikeComboChoices=e.observableArray([{key:"chains.allStrike",value:"1000"},{key:"2",value:"2"},{key:"4",value:"4"},{key:"6",value:"6"}]),this.selectedStrike=e.observable(1e3);var v=new r;this.strikeOptions=l.extend(v.baseOptions(),{data:u.strikeComboChoices,value:u.selectedStrike});var m=new r;this.multipliersOptions={data:u.multipliers,value:u.multiplier},this.widthComboChoices=e.observableArray([{key:"1",value:"1"},{key:"2",value:"2"},{key:"3",value:"3"},{key:"4",value:"4"}]),this.selectedWidth=e.observable(1);var g=new r;this.widthOptions=l.extend(g.baseOptions(),{data:u.widthComboChoices,value:u.selectedWidth}),this.wingspanComboChoices=e.observableArray([{key:"1",value:"1"},{key:"2",value:"2"},{key:"3",value:"3"},{key:"4",value:"4"}]),this.selectedWingspan=e.observable(1);var y=new r;this.wingspanOptions=l.extend(y.baseOptions(),{data:u.wingspanComboChoices,value:u.selectedWingspan}),this.expiryComboChoices=e.observableArray([{key:"1",value:"1"},{key:"2",value:"2"},{key:"3",value:"3"},{key:"4",value:"4"}]),this.selectedExpiry=e.observable(1);var b=new r;this.expiryOptions=l.extend(b.baseOptions(),{data:u.expiryComboChoices,value:u.selectedExpiry}),u.strategyTemplate.subscribe(function(e){if(e){var t=e.org.legs,n=[],r=[],i=1,s=1;t.forEach(function(e){e.legType=="Security"?r.push(e):n.push(e)});var o=n.length;if(o>1){var a=parseInt(o/2);i=n[a].strike-n[a-1].strike,s=n[1].strike-n[0].strike}u.selectedWidth(i),u.selectedWingspan(s),u.selectedExpiry(1)}}),this.expiryChoices=e.observableArray([]),this.selectedExpiryItem=e.observable(),this.selectedExpiries=e.computed(function(){var e=[];return u.selectedExpiryItem()&&e.push(u.selectedExpiryItem()),e}),this.expiryDropDownOptions=l.extend((new r).baseOptions(),{data:u.expiryChoices,value:u.selectedExpiryItem,dataTextField:"expiry",dataValueField:"expiry",template:"#: expiry #"}),u.itemsListAll=e.observableArray();var S=function(e){var t=this;t.greeks={sigma:E(e,"greeks.sigma",!0),delta:E(e,"greeks.delta"),theta:E(e,"greeks.theta"),gamma:E(e,"greeks.gamma"),vega:E(e,"greeks.vega"),rho:E(e,"greeks.rho")},t.volume=E(e,"volume"),t.openInterest=E(e,"openInterest"),t.bid=E(e,"bid"),t.ask=E(e,"ask"),t.change=E(e,"change"),t.previousClose=E(e,"previousClose"),t.latestTradedPrice=E(e,"latestTradedPrice"),t.optionNumber=function(){var t="";return e.forEach(function(e,n){t+=(n>0?"/":"")+e.optionNumber}),t}(),t.combLegs=function(){var t=[];return e.forEach(function(e){t.push(e.combLeg)}),t}(),t.strikes=function(){var t="",n=[];return e.forEach(function(e,r){e.strikePrice&&n.indexOf(e.strikePrice)<0&&(t+=(r>0?"/":"")+e.strikePrice,n.push(e.strikePrice))}),t}()},T=null;u.itemsList=e.computed(function(){var t=u.itemsListAll().filter(function(e){return e.premiumMultiplier==u.multiplier()});if(t.length===0||!u.strategyReady())return[];var n=u.selectedExpiries(),r=[],i=u.selectedStrike(),s={};n.forEach(function(e){s[e]=[]}),t.forEach(function(e){n.indexOf(e.expiryKey)>-1&&s[e.expiryKey].push(e)});var o=w(u.selectedStrategy());return u.strategyTemplate()||u.strategyTemplate(o),o["org"].id!=u.strategyTemplate()["org"].id&&u.strategyTemplate(o),n.forEach(function(t){var n=s[t],a={};try{var f=o.org.legs,l=[],c=[];f.forEach(function(e){e.legType=="Security"?c.push(e):l.push(e)}),l.forEach(function(e){e.offset=e.strike-l[0].strike});var h;if(o["pair"]!=undefined){h=o.pair.legs;if(h!=undefined){var p=[],d=[];h.forEach(function(e){e.legType=="Security"?d.push(e):p.push(e)}),p.forEach(function(e,t){e.offset=e.strike-p[0].strike})}}n.forEach(function(t,s){var a={strikePrice:"",cmpPrice:0,putOption:{greeks:{sigma:0,delta:0,theta:0,gamma:0,vega:0,rho:0},volume:0,openInterest:0,bid:0,ask:0,change:e.observable(0),optionNumber:""},isExpiryRow:!1,comLeftLegs:[],comRightLegs:[]},l=x(f,o.org.canCustomizeWidth,o.org.canCustomizeWingspan,s,n);a.callOption=l;if(h&&h.length){var c=x(h,o.org.canCustomizeWidth,o.org.canCustomizeWingspan,s,n);c&&(a.putOption=c)}a.strikePrice=a.callOption.strikes;var p=a.strikePrice.split("/");a.cmpPrice=parseFloat(p[parseInt(p.length/2)]);var d=u.lastPrice()-u.step*i/2,v=u.lastPrice()+u.step*i/2;(a.isExpiryRow||a.cmpPrice>d&&a.cmpPrice<v)&&r.push(a)})}catch(v){console.log(v)}}),T=u.itemsList(),setTimeout(C,1),r});var N=["callOption.greeks.sigma","callOption.greeks.delta","callOption.greeks.theta","callOption.greeks.gamma","callOption.greeks.vega","callOption.greeks.rho","callOption.volume","callOption.openInterest","callOption.bid","callOption.ask","callOption.change","callOption.previousClose","callOption.latestTradedPrice","putOption.greeks.sigma","putOption.greeks.delta","putOption.greeks.theta","putOption.greeks.gamma","putOption.greeks.vega","putOption.greeks.rho","putOption.volume","putOption.openInterest","putOption.bid","putOption.ask","putOption.change","putOption.previousClose","putOption.latestTradedPrice"];this.chains=null,this.gridOptions=l.extend(n.baseOptions(),{data:u.itemsList,rowTemplate:"chainsRowTemplate",resizable:!0,scrollable:!1,dataBound:function(e){u.gridReady()&&n.showLabelIfEmpty(e)}}),this.plGraphWindowOptions=l.extend(a.baseOptions(),{isOpen:u.isPlVisible}),this.clickExpiry=function(e){e.isActivated(!e.isActivated())},this.isExpActive=function(){return!1},this.popPl=function(e,t){var n=l(t.target),r=[],i=n.hasClass("call")?"callOption":"putOption",o=e[i];o.combLegs.forEach(function(e){r.push({buyOrSell:n.hasClass("buy")^e.buyOrSell=="Buy"?"SELL":"BUY",expiry:e.expiry,legType:e.legType.toUpperCase(),quantity:e.quantity,strikePrice:e.strikePrice})}),u.selectedLeg={optionNumber:o.optionNumber,buyOrSell:n.hasClass("buy")?"BUY":"SELL",bid:o.bid,ask:o.ask},u.combination()&&(u.combination().dispose(),u.combination(null));var a=new s(u.securityCode(),r);u.isPlVisible(!0),u.combination(a)},this.kendoContextMenu={currentItem:e.observable(),targets:"#chainsGrid tbody tr td",beforeOpen:function(t){var n=e.contextFor(t.target).$data,r=l(t.target).hasClass("call"),i=r?n.callOption:n.putOption;u.kendoContextMenu.currentItem(i)},itemSelect:function(e){var t=u.kendoContextMenu.currentItem(),n=l(e.item),r=[];t.combLegs.forEach(function(e){r.push({buyOrSell:n.hasClass("buy")^e.buyOrSell=="Buy"?"SELL":"BUY",expiry:e.expiry,legType:e.legType==null?e.legType:e.legType.toUpperCase(),quantity:e.quantity,strikePrice:e.strikePrice})});var i=new s(u.securityCode(),r);l.when(i.ready).then(function(){var e=o.extractOrderEntries(i);e.length==1&&n.hasClass("covered-call")&&(e[0].isCovered=!0,e[0].stockBusiness="404"),c.trigger(c.OrderEntry.PREFILL_ORDER,e,i),i.dispose()})}},this.prefill=function(){u.isPlVisible(!1);var e=u.combination(),t=o.extractOrderEntries(e);c.trigger(c.OrderEntry.PREFILL_ORDER,t,e)};var O=null,M=null;this.activate=function(){k(this.securityCode()),L(this.securityCode()),O=u.securityCode.subscribe(k),M=u.securityCode.subscribe(L)},this.detached=function(){O&&O.dispose(),M&&M.dispose(),u.itemsList&&u.itemsList.dispose()},A(),this.selectedOptionNumber=e.observable(null),this.onDoubleClick=function(e,t){var n=null;l(t.target).hasClass("call")?n=u.chains.findOption(e.callOption.optionNumber):l(t.target).hasClass("put")&&(n=u.chains.findOption(e.putOption.optionNumber)),u.selectedOptionNumber(n&&n.optionNumber),n&&c.trigger(c.Quotes.CHANGE_DETAILS,n)}}return d}),define("viewmodels/optionList",["knockout","dataContext","modules/grid","modules/context","modules/formatting","events","jquery","modules/helpers","kendo","knockout-kendo","koBindings/kendoExt","koBindings/changeFlash"],function(e,t,n,r,i,s,o,u){function a(){function c(){t.optionChains.get(r.ulCode()).done(function(e){var t=[];e.rows.forEach(function(e){e.callOption.strikePrice=e.strikePrice,e.callOption.expiryDate=e.expiryDate,e.callOption.securityName=e.securityName,e.putOption.strikePrice=e.strikePrice,e.putOption.expiryDate=e.expiryDate,e.putOption.securityName=e.securityName,t.push(e.callOption),t.push(e.putOption)}),a.allOptionList(t),a.gridReady(!0)})}function d(){if(o("#optionListTable").length==0)return;var e=o("#optionListTable").offset().top,t=o("#footer").offset().top,n=t-e-10,r=o(".optionList-table .k-grid-header").height();a.recordCountPerPage(Math.floor((n-r)/(r-2)))}function m(e){a.filteredOptionList().length-e<=a.recordCountPerPage()?a.recordNo(a.filteredOptionList().length-a.recordCountPerPage()):(e=Math.min(e,a.filteredOptionList().length-1),e=Math.max(0,e),a.recordNo(e))}function g(e){switch(e){case"buytoOpen":return"400";case"buytoClose":return"403";case"selltoOpen":return"402";case"selltoClose":return"401";case"buytoCoverdCall":return"405";case"selltoCoveredCall":return"404";default:return null}}function y(e){return e=="buytoCoverdCall"||e=="selltoCoveredCall"?!0:!1}function b(e,t){return t=="buytoOpen"||t=="buytoClose"||t=="buytoCoverdCall"?e.bid():e.ask()}var a=this;this.filterOptions=[{key:"optionList.delta",value:"DELTA",path:"greeks.delta"},{key:"optionList.gamma",value:"GAMMA",path:"greeks.gamma"},{key:"optionList.theta",value:"THETA",path:"greeks.theta"},{key:"optionList.vega",value:"VEGA",path:"greeks.vega"},{key:"optionList.rho",value:"RHO",path:"greeks.rho"},{key:"optionList.impliedVolatility",value:"SIGMA",path:"greeks.sigma"},{key:"optionList.openInterest",value:"OPEN_INTEREST",path:"uncoveredPositionQuantity"},{key:"optionList.changePercentage",value:"CHANGE_PERCENTAGE",path:"changePercentage"},{key:"optionList.last",value:"LAST",path:"latestTradedPrice"},{key:"optionList.bid",value:"BID",path:"bid"},{key:"optionList.ask",value:"ASK",path:"ask"},{key:"optionList.change",value:"CHANGE",path:"change"},{key:"chains.optionNumber",value:"OPTION_NUMBER",path:"optionNumber"},{key:"chains.optionName",value:"CHANGE",path:"name"},{key:"optionList.volume",value:"CHANGE",path:"volume"},{key:"chains.expiry",value:"CHANGE",path:"expiryDate"},{key:"optionList.strike",value:"STRIKE",path:"strikePrice"},{key:"chains.securityCode",value:"SECURITY_CODE",path:"securityCode"},{key:"chains.securityName",value:"SECURITY_NAME",path:"securityName"}],this.operators=["<",">","=","≤","≥","≠"],this.sortBy=e.observable("");var f=function(t,n){var r=this;r.filterName=e.observable("optionList.default"),r.filter=e.observable(null),r.operator=e.observable(a.operators[0]),r.value=e.observable(""),r.selectFilter=function(e){r.filterName(e.key),r.filter(e)},r.filteredItems=n,r.selectOperator=function(e){r.operator(e)},r.enabled=e.observable(t),r.toggleUl=function(e,t){r.enabled()?o(t.currentTarget).find("ul").toggle():o(t.currentTarget).find("ul").toggle(!1)},r.enabled.subscribe(function(e){}),r.autoValues=e.computed(function(){if(r.enabled()&&r.filter()!=null){var t=[];return a.filteredOptionList().forEach(function(n){var i=""+e.unwrap(u.getValue(n,r.filter().path));t.indexOf(i)<0&&t.push(i)}),t}return[]}),r.autoCompleteValues={data:r.autoValues,suggest:!1,minLength:0,enable:r.enabled,value:r.value}};this.filters=[new f(!0),new f(!1),new f(!1)];var l=function(t){var n=!0;return t.greeks==null?!1:(a.filters.forEach(function(r){if(r.enabled()&&r.filter()!=null){var s=e.unwrap(u.getValue(t,r.filter().path)),o=r.value();if(o.trim()==""){n&=!0;return}typeof s=="number"&&(s=i.roundNumber(s,4),o=parseFloat(o),o=i.roundNumber(o,4));switch(r.operator()){case"<":n&=s<o;break;case">":n&=s>o;break;case"=":n&=s==o;break;case"≤":n&=s<=o;break;case"≥":n&=s>=o;break;case"≠":n&=s!=o;break;default:}}}),n)};this.allOptionList=e.observableArray([]),this.gridReady=e.observable(!1),c(),r.ulCode.subscribe(c),this.recordNo=e.observable(0),this.recordCountPerPage=e.observable(20),this.sortAsc=e.observable(!0);var h=null;this.sortResult=function(e,t){a.sortDesc=!1;var n=t.currentTarget.attributes["data-field"].value;n==a.sortBy()?a.sortAsc(!a.sortAsc()):(a.sortAsc(!0),a.sortBy(n)),h!=null&&(h.textContent=h.textContent.replace("↑","").replace("↓","")),t.currentTarget.textContent=t.currentTarget.textContent+(a.sortAsc()?"↑":"↓"),h=t.currentTarget};var p=function(t){return a.sortBy()===""?t:t.sort(function(t,n){var r=a.sortBy(),i=e.unwrap(u.getValue(t,r))>e.unwrap(u.getValue(n,r))?1:e.unwrap(u.getValue(t,r))==e.unwrap(u.getValue(n,r))?0:-1;return a.sortAsc()?i:-i})};this.filteredOptionList=e.computed(function(){return a.recordNo(0),p(a.allOptionList())}).extend({rateLimit:{timeout:50,method:"notifyWhenChangesStop"}}),o(window).on("resize",d),this.displayedOptionList=e.computed(function(){return a.filteredOptionList()}),this.gridOptions=o.extend(n.baseOptions(),{data:a.displayedOptionList,rowTemplate:"optionListRowTemplate",resizable:!0,scrollable:!1,sortable:!1,dataBound:function(e){a.gridReady()&&n.showLabelIfEmpty(e)}});var v=5;this.onWheelScroll=function(e,t){if(a.filteredOptionList().length<=a.recordCountPerPage()){a.recordNo(0);return}var n=t.originalEvent,r=n.deltaY>0?a.recordNo()+v:a.recordNo()-v;m(r)},this.OptionListContextMenu={currentItem:e.observable(),putFlag:e.observable(),targets:"#optionListTable tbody tr td",beforeOpen:function(t){var n=e.contextFor(t.target).$data,r=n.optionCode.toUpperCase().indexOf("C")<0?!0:!1;a.OptionListContextMenu.putFlag(r),a.OptionListContextMenu.currentItem(n)},itemSelect:function(e){var t=a.OptionListContextMenu.currentItem(),n=e.item.classList[0],r={optionNumber:t.optionNumber,optionCode:t.optionCode,stockBiz:g(n),isCovered:y(n),orderPrice:b(t,n)};s.trigger(s.OrderEntry.PREFILL_ORDER,r)}},this.attached=function(){a.recordCountPerPage(Math.floor((o("#listGridContainer").height()-40)/32)),document.onkeyup=function(){switch(window.event.keyCode){case 33:m(a.recordNo()-v);break;case 34:m(a.recordNo()+v);break;case 35:a.recordNo(a.filteredOptionList().length-a.recordCountPerPage());break;case 36:a.recordNo(0);break;default:return}}},this.selectedOption=e.observable(null),this.onDoubleClick=function(e){a.selectedOption(e),e&&s.trigger(s.Quotes.CHANGE_DETAILS,e)}}return new a}),define("viewmodels/compositions/symbolLookup",["jquery","knockout","modules/context","kendo","dataContext","modules/help"],function(e,t,n,r,i,s){function u(e){o.quoteReady(!1),i.quotation.get(e).done(function(e){o.lastPrice=e.lastPrice()?e.lastPrice:e.previousClose,o.securityName(e.securityName),o.securityCode(e.securityCode),o.quote(e),o.quoteReady(!0)})}var o={};return o.securityName=t.observable(""),o.securityCode=t.observable(""),o.lastPrice=t.observable(""),o.quoteReady=t.observable(!1),o.quote=t.observable(null),u(n.symbolCode()),n.symbolCode.subscribe(function(e){u(e)}),o.globalCompaniesDataSource=new r.data.DataSource({serverFiltering:!0,transport:{read:{url:function(){var e=this.data.filter.filters[0].value;return"api/marketdata/getcompanies/"+e},dataType:"json"}}}),o.portfolioCompaniesDataSource=new r.data.DataSource({serverFiltering:!0,transport:{read:{url:function(){return"api/portfolio/getPortfolioCompanies"},dataType:"json"}}}),o.expandButtonClick=function(){var t=e("#symbolLookup").data("kendoAutoComplete");t.options.isOpened?t.close():o.showPortfolioCompanies()},o.showPortfolioCompanies=function(){var t=e("#symbolLookup").data("kendoAutoComplete");t.setDataSource(o.portfolioCompaniesDataSource),t.search("")},o.symbolViewOptions={data:o.globalCompaniesDataSource,dataTextField:"securityCode",suggest:!0,autoBind:!0,minLength:0,isOpened:!1,templateName:"symbolViewTemplate",expandButtonTemplateName:"symbolViewExpandButtonTemplate",alignToRightSide:!0,value:n.symbolCode,dataBinding:function(t){t.sender.template=r.template(e("#"+t.sender.options.templateName).html())},dataBound:function(e){if(e.sender.options.alignToRightSide){var t=e.sender.list.width(),n=e.sender.element.width(),r=4;e.sender.list.parent().index(document.body)<0&&e.sender.list.parent().offset({left:e.sender.list.parent().offset().left-t+n-r})}},select:function(t){function r(n){return e.trim(t.item.find('[data-field="'+n+'"]').text())}var i={code:r("code"),name:r("name"),stockExchange:r("stockExchange")};n.symbolCode(i.code)},close:function(e){e.sender.options.isOpened=!1,e.sender.setDataSource(o.globalCompaniesDataSource)},open:function(e){e.sender.options.isOpened=!0}},o.attachSymbolLookupExpandButton=function(){var t=e("#"+o.symbolViewOptions.expandButtonTemplateName).html(),n=e(t);e("#symbolLookup").parent().append(n),n.bind("click",o.expandButtonClick)},o.bindingComplete=function(){o.attachSymbolLookupExpandButton()},o}),define("viewmodels/portfolio",["knockout","komapping","dataContext","modules/grid","modules/formatting","modules/localizer","modules/combinationViewModel","modules/combinationChart","events","loader","modules/kendoWindow","modules/dropDownList","plugins/router","viewmodels/compositions/symbolLookup","portfolioItemGroupModel","modules/enums","koBindings/changeFlash","kendo","kendo-plugins","knockout-kendo","koBindings/kendoExt"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){function g(){function w(e){switch(e.optionSide()){case"L":return v.SELL;case"S":return v.BUY;case"C":return v.BUY;default:return null}}function E(e){switch(e.optionSide()){case"L":return"401";case"S":return"403";case"C":return"405";default:return null}}function S(e){g(e).pipe(y)}var t=this;this.grid=e.observable(null),this.gridBound=e.observable(!1),this.dataFetched=e.observable(!1),this.toggleHistoricalOrder=function(){a.trigger(a.Portfolio.HISTORICAL_INQUIRY)},this.groupList=e.observableArray([]),this.selectedItem=e.observable(),this.symbolLookup=p,this.currentAutoExerciseInstructions=e.observable({}),this.autoExerciseInstructions=e.observable(),this.details=e.observable(!1),this.detailsSwitch=e.computed(function(){var e=t.details()?"":"greeksVisible";return e}),this.costBasisIconPath=e.computed(function(){var e=t.details()?"greekToggle":"costBasis_"+s.activeLocale();return e}),this.closePositionIconPath=e.computed(function(){var e="closePosition_"+s.activeLocale();return e}),this.complexPositionIconPath=e.computed(function(){var e="complexPosition_"+s.activeLocale();return e}),this.expiryQuantity=e.observable(0),this.expiryTodayQuantity=e.observable(0),this.hasTodayExpiration=e.observable(!1),this.expiryWarningsMessage=e.computed(function(){var e;return s.waitForLocaleChange(),t.expiryQuantity()===0?e=s.localize("portfolio.alerts.noExpiryWarnings"):t.expiryQuantity()===1?t.hasTodayExpiration()?e=s.localize("portfolio.alerts.oneExpiryTodayWarning"):e=s.localize("portfolio.alerts.oneExpiryWarning"):(t.hasTodayExpiration()?e=s.localize("portfolio.alerts.manyExpiryTodayWarning"):e=s.localize("portfolio.alerts.manyExpiryWarnings"),e=e.replace("{X}",t.expiryQuantity())),e}),t.portfolioDataReady=e.observable(!1);var g=function(r){var i=$.Deferred();return n.portfolio.get("",{},r).done(function(n){var r=e.unwrap(n);h.activeItem()==t&&(!r||r.length<=1)&&m&&h.navigate("#quotes"),m=!1,t.groupList=n,t.gridOptions.data=n,t.expiryQuantity(0),t.expiryTodayQuantity(0),t.hasTodayExpiration(!1),$.each(t.groupList(),function(n,r){r.strategyGraphPath=r.strategyGraphPath||e.observable(""),r.isStockGroup()?r.strategyGraphPath("StockBuy"):r.quantity()>0?r.strategyGraphPath(r.strategy()+"Buy"):r.strategyGraphPath(r.strategy()+"Sell"),$.each(r.items(),function(n,r){r.isStock()||r.expiresInTwoDays()&&(t.expiryQuantity(t.expiryQuantity()+1),r.expiresToday()&&(t.expiryTodayQuantity(t.expiryTodayQuantity()+1),t.hasTodayExpiration(!0))),r.autoExerciseInstruction=e.observable()})}),t.portfolioDataReady(!0)}).always(function(){t.dataFetched(!0),f.hide(),i.resolve()}),i.promise()},y=function(){var r=$.Deferred();return f.showUnobtrusive(),n.autoExerciseData.get().done(function(n){t.autoExerciseInstructions=n,$.each(t.groupList(),function(n,r){$.each(r.items(),function(n,r){$.each(t.autoExerciseInstructions(),function(t,n){if(r.optionNumber()&&r.optionNumber()===n.contractNumber()&&r.optionSide()==="L"){var i=n;i.contractName(r.optionName()),i.optionType=e.observable(r.optionTypeFormatted()),i.optionAvailableQuantity=e.observable(r.optionAvailableQuantity()),i.autoExerciseInstructionStatus=e.computed(function(){return i.exercisingQuantity()===0?0:i.exercisingQuantity()>0&&i.exercisingQuantity()<r.optionAvailableQuantity()?1:i.exercisingQuantity()===r.optionAvailableQuantity()?2:0}),i.exercisingStrategyValue.extend({required:!0,number:!0,maxLength:2}),typeof r.autoExerciseInstruction=="undefined"&&(r.autoExerciseInstruction=e.observable()),r.autoExerciseInstruction(i)}})})})}).always(function(){f.hideUnobtrusive(),r.resolve()}),r.promise()},b=function(n,r){var i;n.strategy?i=n.items():i=[n];var s=i.map(function(t){var n=r.findRow(t.optionNumber());return{buyOrSell:e.unwrap(t.optionSideEnum),legType:e.unwrap(t.optionTypeEnum),quantity:Math.abs(t.optionHoldingQuantity?t.optionHoldingQuantity():t.adjustedBalance()),expiry:n?n.expiryDate:null,strikePrice:n?n.strikePrice:null,costBasis:Math.abs(t.adjustedRealtimeCostBasis())}}),a=new o(n.underlyingCode(),s),f=t.portfolioPLGraphOptions.stockPriceHigherBound(),l=t.portfolioPLGraphOptions.stockPriceLowerBound(),c=Math.min(200,(f-l)/.1);return a.chart=new u(a,c),a};this.kendowWindowOpen=function(n){var r=n.sender,i=r.wrapper.find(".k-window-titlebar");if(!e.dataFor(i[0])){i.parent().addClass("exercise-instructions-window");var s=$("#"+r.options.headerTemplate).html();i.html(s),e.applyBindings(t,i[0])}var o=$("#"+r.options.template).html();r.element.html(o),e.applyBindings(t,r.element.children()[0]),l.centralizeWindow(n)},this.autoExerciseInstructionWindowOptions=$.extend(l.baseOptions(),{template:"autoExerciseInstructionsTemplate",headerTemplate:"autoExerciseInstructionsHeaderTemplate",actions:["close"],open:t.kendowWindowOpen}),this.strategyOptions=$.extend(c().baseOptions(),{data:e.observableArray([{key:"portfolio.autoExercise.strategyTypes.strategyType1",value:"1"},{key:"portfolio.autoExercise.strategyTypes.strategyType2",value:"2"},{key:"portfolio.autoExercise.strategyTypes.strategyType3",value:"3"}])}),this.quantityOptions={min:0,decimals:0,format:"#",step:1,value:""},this.thresholdOptions={min:0,decimals:2,format:"#.00",step:.01,value:""},this.expandRow=function(e){var n="tr[data-collapsable=true][data-parent={0}]".replace("{0}",e.id());t.grid().tbody.find(n).show(),e.expanded(!0)},this.collapseRow=function(e){var n="tr[data-collapsable=true][data-parent={0}]".replace("{0}",e.id());t.grid().tbody.find(n).hide(),e.expanded(!1)},this.gridOptions=$.extend(r.baseOptions(),{data:t.groupList,resizable:!0,rowTemplate:"portfolioGridRowTemplate",scrollable:!0,dataBound:function(e){t.dataFetched()&&r.showLabelIfEmpty(e);if(t.gridBound())return;t.grid(e.sender),t.gridBound(!0),setTimeout(t.toggleColumns,1)}}),this.contextMenuOptions={currentItem:e.observable(),targets:"#portfolioGrid tbody tr",width:"260px",beforeOpen:function(n){var r=e.contextFor(n.target).$data;r.typeIsGroup=e.observable(r instanceof d),t.contextMenuOptions.currentItem(r)},itemSelect:function(e){var n=t.contextMenuOptions.currentItem(),r,i=$(e.item);i.hasClass("exercise")?t.exercisePosition(n):i.hasClass("closePosition")?t.closePosition(n):i.hasClass("closeComplex")?t.closeComplexPosition(n):i.hasClass("viewUnderlyingChart")&&console.log('You selected: "View Underlying Chart"')}},this.portfolioPLGraphOptions={combination:e.observable(null),portfolio:e.observable(null),stockPriceLowerBound:e.observable(0),stockPriceHigherBound:e.observable(205),chartPriceRange:e.observable([30,170]),sentiments:e.computed(function(){var e=t.portfolioPLGraphOptions;if(e){var n=e.combination().sentiments().join(" ");return n}return null}),visible:e.observable(!1)},this.plGraphWindowOptions=$.extend({},l.baseOptions(),{isOpen:t.portfolioPLGraphOptions.visible}),this.closePosition=function(e){if(e.strategy){t.closeComplexPosition(e);return}var n=e.isCovered(),r=n?"405":e.optionSide()==="L"?"401":"403",i={optionNumber:e.optionNumber(),orderType:"133",orderQuantity:Math.abs(e.optionAvailableQuantity()),isCovered:n,stockBiz:r};a.trigger(a.OrderEntry.PREFILL_ORDER,i)},this.closePositionFromPLGraph=function(){var e=this.portfolio();t.closePosition(e),this.visible(!1)},this.closeComplexPosition=function(t){var n=t.items().filter(function(e){return!e.isStock()}).map(function(t){return{buyOrSell:w(t),legType:e.unwrap(t.optionTypeEnum),quantity:Math.abs(t.optionAvailableQuantity()),expiry:new Date(t.expiry.date()+i.CHINA_TIME_ZONE),strikePrice:t.strikePrice(),isCovered:t.optionSide()=="C",orderQuantity:Math.abs(t.optionAvailableQuantity()),stockBiz:E(t),optionNumber:t.optionNumber(),orderType:"133"}}),r=new o(t.underlyingCode(),n);$.when(r.ready).done(function(){a.trigger(a.OrderEntry.PREFILL_ORDER,n,r,r.absQuantity())})},this.showAutoExerciseInstructions=function(n){t.selectedItem(n),n.autoExerciseInstruction()&&(t.currentAutoExerciseInstructions(e.mapping.fromJS(e.toJS(n.autoExerciseInstruction()))),t.quantityOptions.value=t.currentAutoExerciseInstructions().exercisingQuantity,t.strategyOptions.value=t.currentAutoExerciseInstructions().exercisingStrategyType,t.thresholdOptions.value=t.currentAutoExerciseInstructions().exercisingStrategyValue,$("#autoExerciseInstructions").data("kendoWindow").open())},this.closeAutoExerciseInstructions=function(){$("#autoExerciseInstructions").data("kendoWindow").close()},this.submitAutoExerciseInstructions=function(e){n.autoExerciseData.post("update",t.currentAutoExerciseInstructions()).done(function(){t.selectedItem().autoExerciseInstruction().exercisingQuantity(t.currentAutoExerciseInstructions().exercisingQuantity()),t.selectedItem().autoExerciseInstruction().exercisingStrategyType(t.currentAutoExerciseInstructions().exercisingStrategyType()),t.selectedItem().autoExerciseInstruction().exercisingStrategyValue(t.currentAutoExerciseInstructions().exercisingStrategyValue()),$("#autoExerciseInstructions").data("kendoWindow").close()})},this.autoExercisePosition=function(){n.autoExerciseData.post("update",t.currentAutoExerciseInstructions()).done(function(){$("#exerciseInstructions").data("kendoWindow").close()})},this.generatePremium=function(){console.log("Generating premium...")},this.toggleColumnText=e.observable("GREEKS"),this.toggleColumns=function(){var e=["optionRealtimeCostBasis","lastPrice","optionFloatingPL","optionMarketValue","optionMargin"],n=["greekDelta","greekGamma","greekTheta","greekVega","greekRho"];if(t.details()){if(t.groupList().length<=1)return;e.forEach(function(e){t.grid().hideColumn(e)}),n.forEach(function(e){t.grid().showColumn(e)}),t.details(!1),t.toggleColumnText("成本")}else e.forEach(function(e){t.grid().showColumn(e)}),n.forEach(function(e){t.grid().hideColumn(e)}),t.details(!0),t.toggleColumnText("GREEKS")},this.togglePortfolioPLGraph=function(e){if(e==t.portfolioPLGraphOptions.portfolio()){t.portfolioPLGraphOptions.visible(!0);return}if(t.portfolioPLGraphOptions.visible()){t.portfolioPLGraphOptions.combination(null),t.portfolioPLGraphOptions.visible(!1);return}f.show();var r=e.underlyingCode();t.dataFetched(!1),n.optionChains.get(r).done(function(n){var r=b(e,n);t.portfolioPLGraphOptions.portfolio(e),t.portfolioPLGraphOptions.visible(!0),t.portfolioPLGraphOptions.combination(r)}).always(function(){t.dataFetched(!0),f.hide()})},this.exercisePosition=function(e){var t={optionNumber:e.optionNumber(),optionCode:e.optionCode(),orderQuantity:e.optionAvailableQuantity()};a.trigger(a.OrderEntry.EXERCISE,t)},this.resetColumnWidth=function(){$(".k-grid col").css("width",""),$(".k-grid table").css("width","")},a.on(a.Portfolio.REFRESH,function(){S(!0)}),this.activate=function(){S()},this.attached=function(){}}e.mapping=t;var m=!0;return g}),define("viewmodels/trade/orderEntry",["jquery","knockout","modules/localizer","modules/dropDownList","events","dataContext","modules/orderEnums","modules/kendoWindow","modules/context","modules/combinationHelpers","modules/notifications","knockout-kendo"],function(e,t,n,r,i,s,o,u,a,f,l){function b(i,u,a,f,l){var y=this;y.optionNumber=t.observable(i),y.optionName=t.observable(),y.securityCode=t.observable(""),y.securityName=t.observable(""),y.orderQuantity=t.observable(a||1),y.orderPrice=t.observable(f||1e-4),y.stockBusiness=t.observable(u||"400"),y.orderType=t.observable(l||"130"),y.maxOrderQuantity=t.observable(0),y.optionType=t.observable(),y.option=t.observable(null),y.multiplier=t.observable(),y.orderPriceMin=t.observable(1e-4),y.orderPriceMax=t.observable(),y.success=t.observable(!1),y.fail=t.observable(!1),y.errorMessage=t.observable(""),y.submitting=t.observable(!1),y.isChecked=t.observable(!0),y.optionNumber.subscribe(function(e){c.isLoadingOptionsInfo(!0),e?s.optionTradingInfo.get(e).done(function(e){y.option(e),y.optionName(e.name()),y.orderPriceMin(e.limitDownPrice()),y.orderPriceMax(e.limitUpPrice()),y.optionType(e.TypeOfOption),y.multiplier(e.optionUnit()),y.securityCode(e.optionUnderlyingCode()),y.securityName(e.optionUnderlyingName())}).fail(function(e){console.log(n.localize("trade.incorrectOptionNumber")),console.log(e.responseJSON.message.substring(e.responseJSON.message.indexOf("Message:")+9)),y.option(null),c.isLoadingOptionsInfo(!1)}):(y.optionName(undefined),y.orderPriceMin(1e-4),y.orderPriceMax(undefined),y.optionType(undefined),y.option(null),y.multiplier(undefined),y.securityCode(""),y.securityName(""),c.isLoadingOptionsInfo(!1))}),y.isCovered=t.observable(!1),y.stockBusinessOptions=t.computed(function(){var e=y.isCovered()?p:d;return setTimeout(function(){var e=y.stockBusiness();y.isCovered()?e in p||y.stockBusiness("404"):e in p&&y.stockBusiness("400")},0),h.filter(function(t){return t.value in e})}),y.selectedStockBusinessName=t.computed(function(){return o.StockBusinessDic[y.stockBusiness()]}),y.orderTypeName=t.computed(function(){return o.OrderTypeDic[y.orderType()]}),y.priceNeeded=t.computed(function(){var e=y.orderType();return e in v}),y.orderPriceText=t.computed(function(){return y.priceNeeded()?y.orderPrice():n.localize("trade.marketPrice")}),y.optionNumberAutoComp={data:g,dataTextField:"optionNumber",suggest:!0,autoBind:!0,minLength:0,template:"<span>#: optionNumber #	#: optionName #</span>",value:y.optionNumber,dataBound:function(e){e.sender.list.width(220)}},y.kendoStockBusiness=e.extend((new r).baseOptions(),{data:y.stockBusinessOptions,value:y.stockBusiness}),y.kendoOrderTypeOptions=e.extend((new r).baseOptions(),{data:m,value:y.orderType}),y.kendoOrderPrice={value:y.orderPrice,decimals:4,format:"#.0000",step:1e-4,min:y.orderPriceMin,max:y.orderPriceMax,enabled:y.priceNeeded},y.kendoOrderQuantity={value:y.orderQuantity,decimals:0,format:"#",step:1,min:0,max:y.maxOrderQuantity},y.kendoOrderQuantityForMulti={value:y.orderQuantity,decimals:0,format:"#",step:1,min:1};var b={optionNumber:"",stockBusiness:"",orderPrice:"",orderType:"130"};y.getMaxOrderQuantity=function(){var e={optionNumber:t.unwrap(y.optionNumber),stockBusiness:t.unwrap(y.stockBusiness),orderPrice:t.unwrap(y.orderPrice),orderType:t.unwrap(y.orderType),securityCode:t.unwrap(y.securityCode)},n=JSON.stringify(b)!=JSON.stringify(e);for(var r in e)n&=!!e[r],!e[r]||(b[r]=e[r]);n&&s.order.post("maxOrderQuantity",e).done(function(e){y.maxOrderQuantity(e.orderQuantity)}),setTimeout(y.getMaxOrderQuantity,1e3)},y.plainData=t.computed(function(){var e={isChecked:t.unwrap(y.isChecked),optionNumber:t.unwrap(y.optionNumber),orderQuantity:t.unwrap(y.orderQuantity),orderPrice:t.unwrap(y.orderPrice),stockBusiness:t.unwrap(y.stockBusiness),orderType:t.unwrap(y.orderType),securityCode:t.unwrap(y.securityCode)};return y.getMaxOrderQuantity(),e},y).extend({rateLimit:0}),y.valid=t.computed(function(){var e=this.plainData(),t=!0;for(var n in e)t&=!!e[n];return t},y)}function w(){var n=this;n.securityCode=t.observable(""),n.securityName=t.observable(""),n.valid=t.observable(!1),n.securityCodeAutoComp={data:y,dataTextField:"securityCode",suggest:!0,autoBind:!0,minLength:0,template:"<span>#: securityCode #	#: securityName #</span>",value:n.securityCode,dataBound:function(e){e.sender.list.width(220)}},n.securityCode.subscribe(function(e){n.maxLockQuantity(0),n.maxUnlockQuantity(0),s.quotation.get(e).done(function(e){n.valid(!0),n.getMaxLockUnlockQuantity(),n.securityName(e.securityName)}).fail(function(){n.valid(!1)})}),n.maxLockQuantity=t.observable(0),n.maxUnlockQuantity=t.observable(0),n.orderQuantity=t.observable(0),n.kendoOrderQuantity={value:n.orderQuantity,decimals:0,format:"#",step:100,min:0},n.lockMax=function(){n.orderQuantity(n.maxLockQuantity())},n.unlockMax=function(){n.orderQuantity(n.maxUnlockQuantity())},c.getMaxLockUnlockQuantity=n.getMaxLockUnlockQuantity=function(){if(n.valid()){var r={stockBusiness:"408",orderType:"100",securityCode:t.unwrap(n.securityCode)};s.order.post("maxOrderQuantity",r).done(function(e){n.maxLockQuantity(e.orderQuantity)}).fail(function(){n.orderQuantity(0)}),r.stockBusiness="409",s.order.post("maxOrderQuantity",r).done(function(t){n.maxUnlockQuantity(t.orderQuantity),c.submittingOrder(!1),e(".k-i-close")&&e(".k-i-close").parent().show()}).fail(function(){n.orderQuantity(0)})}}}function E(e,t){t.optionNumber(e.optionNumber),t.orderType(e.orderType||o.OrderTypes.MARKET_FOK),t.maxOrderQuantity(e.orderQuantity||1),t.orderQuantity(e.orderQuantity||1),e.orderPrice&&t.orderPrice(e.orderPrice),t.isCovered(e.isCovered||!1),t.stockBusiness(e.stockBiz||"400"),t.getMaxOrderQuantity()}var c={};c.getMaxLockUnlockQuantity=function(){},c.isLoadingOptionsInfo=t.observable(!1);var h=[{key:"trade.stockBizOptions.buyToOpen",value:"400"},{key:"trade.stockBizOptions.sellToClose",value:"401"},{key:"trade.stockBizOptions.sellToOpen",value:"402"},{key:"trade.stockBizOptions.buyToClose",value:"403"},{key:"trade.stockBizOptions.openCoveredCall",value:"404"},{key:"trade.stockBizOptions.closeCoveredCall",value:"405"}],p={404:!0,405:!0},d={400:!0,401:!0,402:!0,403:!0},v={130:!0,131:!0,132:!0},m=t.observableArray([{key:"trade.orderTypeOptions.limitGFD",value:"130"},{key:"trade.orderTypeOptions.limitFOK",value:"131"},{key:"trade.orderTypeOptions.marketToLimitGFD",value:"132"},{key:"trade.orderTypeOptions.marketFOK",value:"133"},{key:"trade.orderTypeOptions.marketIOC",value:"134"}]),g=new kendo.data.DataSource({serverFiltering:!0,transport:{read:{url:function(){var e=this.data.filter.filters[0].value;return"api/marketdata/getoptions/"+e},dataType:"json"}}}),y=new kendo.data.DataSource({serverFiltering:!0,transport:{read:{url:function(){var e=this.data.filter.filters[0].value;return"api/marketdata/getcompanies/"+e},dataType:"json"}}});return c.orderLegs=t.observableArray([new b]),c.edittedLeg=t.observable(c.orderLegs()[0]),c.emptyLegForMulti=t.observable(new b),c.lockUnlockOrder=new w,c.removeLeg=function(e){c.orderLegs().length>1&&(c.orderLegs.remove(e),c.edittedLeg()==e&&c.edittedLeg(c.orderLegs()[0]))},c.editLeg=function(e){c.edittedLeg(e)},c.confirmWindow=t.observable(!1),c.submittingOrder=t.observable(!1),c.submitOrder=function(){var e,t=window.localStorage.getItem("noConfirmWhenPlaceOrderInStore");t=="false"||t==null||t==""?e=!0:e=!1;if(e){var n=c.orderLegs(),r=!0;n.forEach(function(e){r&=e.valid()}),r&&c.confirmWindow(!0)}else c.confirmAndSubmit()},c.confirmAndSubmit=function(){c.submittingOrder(!0);var t=c.orderLegs().length,r=c.orderLegs().map(function(e){var t=e.plainData();e.submitting(!0),e.success(!1),e.fail(!1);if(t.isChecked)return s.order.post("submit",t).done(function(){e.success(!0)}).fail(function(t){t&&t.responseJSON&&t.responseJSON.message&&e.errorMessage(t.responseJSON.message.substring(t.responseJSON.message.indexOf("Message:")+9)),e.fail(!0)}).always(function(){e.submitting(!1)});e.submitting(!1),e.success(!1),e.fail(!1)});return e.when.apply(c,r).done(function(){c.orderLegs().length>1?(l.success(n.localize("trade.orderSuccessfully")),setTimeout(c.closeConfirmWindow,2e3)):c.closeConfirmWindow()}).fail(function(e){c.orderLegs().length==1&&(e&&e.responseJSON&&e.responseJSON.message&&console.log(e.responseJSON.message.substring(e.responseJSON.message.indexOf("Message:")+9)),c.closeConfirmWindow())}).always(function(){c.closeExerciseWindow(),i.trigger(i.Bottom.INTRADAY_REFRESH),i.trigger(i.Bottom.INTRADAY_EXERCISES_REFRESH),c.closeConfirmWindow()})},c.closeConfirmWindow=function(){c.confirmWindow(!1),c.submittingOrder(!1),c.orderLegs().forEach(function(e){e.submitting(!1),e.success(!1),e.fail(!1),e.errorMessage("")})},c.kendoConfirmWindow=e.extend(u.baseOptions(),{isOpen:c.confirmWindow,title:n.localize("trade.confirm"),resizable:!0,width:t.computed(function(){return c.orderLegs().length>1?650:300}),open:function(e){e.sender.wrapper.width(c.orderLegs().length>1?650:300),u.centralizeWindow(e)}}),c.exerciseWindowShown=t.observable(!1),c.kendoExerciseWindow=e.extend(u.baseOptions(),{isOpen:c.exerciseWindowShown,title:n.localize("trade.exercise"),resizable:!0,width:250}),c.lockUnlockWindowOpen=t.observable(!1),c.lockUnlockSharesWindowOptions=e.extend(u.baseOptions(),{isOpen:c.lockUnlockWindowOpen,title:n.localize("trade.lockUnlockShares"),width:250}),c.openLockUnlockWindow=function(){c.lockUnlockOrder.securityCode()||c.lockUnlockOrder.securityCode(a.symbolCode()),c.lockUnlockWindowOpen(!0),c.getMaxLockUnlockQuantity()},c.lockUnlockShares=function(r){c.submittingOrder(!0),e(".k-i-close")&&e(".k-i-close").parent().hide();if(r==="refresh")c.getMaxLockUnlockQuantity();else{if(c.lockUnlockOrder.orderQuantity()<=0||!c.lockUnlockOrder.orderQuantity()){l.error(n.localize("trade.nonZeroMessage")),c.closeLockUnlockWindow();return}var i={quantity:c.lockUnlockOrder.orderQuantity(),securityCode:t.unwrap(c.lockUnlockOrder.securityCode)};s.order.post("shares/"+r,i).done(function(){l.success(n.localize("trade.orderSuccessfully"))}).always(function(){c.closeLockUnlockWindow(),c.submittingOrder(!1)})}},c.closeLockUnlockWindow=function(){c.lockUnlockWindowOpen(!1)},c.closeExerciseWindow=function(){c.exerciseWindowShown(!1)},c.cancelMultipleLeg=function(){c.orderLegs.splice(1,c.orderLegs().length-1),c.orderLegs()[0].optionNumber(null),c.combination(null)},c.combination=t.observable(null),c.combinationMaxQuantity=t.observable(0),c.combinationQuantity=t.computed({read:function(){var e=1,t=1,n=Math.min.apply(this,c.orderLegs().map(function(e){return e.orderQuantity()}));while(++t<=n){var r=!0;c.orderLegs().forEach(function(e){r=e.orderQuantity()%t==0}),r&&(e=t)}return e},write:function(e){e=parseInt(e);if(e<1)return;var t=c.combinationQuantity();c.orderLegs().forEach(function(n){var r=n.orderQuantity();n.orderQuantity(parseInt(r*e/t))}),c.combination().absQuantity(e)}},c).extend({rateLimit:0}),c.stockBusinessName=t.computed(function(){var e=c.orderLegs()[0];if(c.combination()){var t=o.OpenStockBizes[e.stockBusiness()]?"Open":o.CloseStockBizes[e.stockBusiness()]?"Close":"Unknown",n=c.combination().buyOrSell().toLowerCase()+"To"+t;return n}return e.selectedStockBusinessName()}),c.multiOrderLegsNonChecked=t.computed(function(){if(c.orderLegs().length>1){var e=0;c.orderLegs().forEach(function(t){t.isChecked()&&e++}),e>0?c.submittingOrder(!1):c.submittingOrder(!0)}}),c.combinationQuantityOptions={value:c.combinationQuantity,format:"#",step:1,min:1,max:c.combinationMaxQuantity,spin:function(e){c.combinationQuantity(e.sender.value()),console.log(this.value())}},i.on(i.OrderEntry.PREFILL_ORDER).then(function(t,n,r){c.combination()&&(c.combination().dispose(),c.combination(null)),c.orderLegs.splice(1,c.orderLegs().length-1);if(e.isArray(t))t.forEach(function(e,t){if(e.orderQuantity>0){var n=c.orderLegs()[t];typeof n=="undefined"?(n=new b,E(e,n),c.orderLegs.push(n)):E(e,n)}}),c.combinationMaxQuantity(r),c.combination(f.cloneCombination(n));else{var i=c.orderLegs()[0];E(t,i)}if(t.length>1){c.confirmWindow(!0);return}e("#OrdersnewTab").click()}),i.on(i.OrderEntry.EXERCISE).then(function(e){var t=c.orderLegs()[0];t.optionNumber(e.optionNumber),t.orderType(o.OrderTypes.SUBMIT_ORDER),t.orderQuantity(e.orderQuantity),e.optionCode.indexOf("C")>=0?t.stockBusiness(o.StockBusinesses.EXERCISE_CALL):e.optionCode.indexOf("P")>=0&&t.stockBusiness(o.StockBusinesses.EXERCISE_PUT),c.exerciseWindowShown(!0)}),c}),define("viewmodels/trade/exercise",["jquery","knockout","modules/localizer","modules/dropDownList","events","dataContext","modules/orderEnums","modules/kendoWindow","modules/context","modules/combinationHelpers","modules/notifications","knockout-kendo"],function(e,t,n,r,i,s,o,u,a,f,l){function p(e,r){var i=this;i.optionNumber=t.observable(e),i.optionName=t.observable(),i.optionType=t.observable(),i.securityCode=t.observable(""),i.securityName=t.observable(""),i.orderQuantity=t.observable(r||1),i.maxOrderQuantity=t.observable(0),i.multiplier=t.observable(),i.stockBusiness=t.computed(function(){return i.optionType()=="P"?"407":"406"}),i.success=t.observable(!1),i.fail=t.observable(!1),i.errorMessage=t.observable(""),i.submitting=t.observable(!1),i.optionNumber.subscribe(function(e){e?s.optionBasic.get(e).done(function(e){if(e){i.optionName(e.optionName),i.optionType(e.optionType),i.multiplier(e.optionUnit),i.securityCode(e.optionUnderlyingCode),i.securityName(e.optionUnderlyingName);var n={optionNumber:t.unwrap(i.optionNumber),stockBusiness:t.unwrap(i.stockBusiness)};s.order.post("maxOrderQuantity",n).done(function(e){i.maxOrderQuantity(e.orderQuantity)})}}).fail(function(){l.error(n.localize("trade.incorrectOptionNumber"))}):(i.optionName(undefined),i.optionType(undefined),i.multiplier(undefined),i.securityCode(""),i.securityName(""))}),i.optionNumberAutoComp={data:h,dataTextField:"optionNumber",suggest:!0,autoBind:!0,minLength:0,template:"<span>#: optionNumber #	#: optionName #</span>",value:i.optionNumber,dataBound:function(e){e.sender.list.width(220)}},i.kendoOrderQuantity={value:i.orderQuantity,decimals:0,format:"#",step:1,min:1,max:i.maxOrderQuantity},i.plainData=t.computed(function(){var e={optionNumber:t.unwrap(i.optionNumber),orderQuantity:t.unwrap(i.orderQuantity),stockBusiness:t.unwrap(i.stockBusiness)};return e},i).extend({rateLimit:0}),i.valid=t.computed(function(){var e=this.plainData(),t=!0;for(var n in e)t&=!!e[n];return t},i)}var c={},h=new kendo.data.DataSource({serverFiltering:!0,transport:{read:{url:function(){var e=this.data.filter.filters[0].value;return"api/portfolio/getOptionPositions/"+e},dataType:"json"}}});return c.exerciseTicket=new p,c.submittingOrder=t.observable(),c.postExerciseTicket=function(){c.submittingOrder(!0);var e=c.exerciseTicket.plainData();return c.exerciseTicket.submitting(!0),c.exerciseTicket.success(!1),c.exerciseTicket.fail(!1),s.order.post("exercise",e).done(function(){l.success(n.localize("trade.exerciseSuccessfully")),c.exerciseTicket.success(!0),c.exerciseTicket.optionNumber(""),c.exerciseTicket.maxOrderQuantity(0),c.exerciseTicket.orderQuantity(1)}).fail(function(e){e&&e.responseJSON&&e.responseJSON.message&&c.exerciseTicket.errorMessage(e.responseJSON.message.substring(e.responseJSON.message.indexOf("Message:")+9)),c.exerciseTicket.fail(!0)}).always(function(){c.exerciseTicket.submitting(!1)})},c}),define("viewmodels/trade/intradayOrders",["knockout","komapping","modules/localizer","modules/notifications","dataContext","modules/grid","modules/kendoWindow","modules/orderEnums","modules/formatting","events","knockout-kendo"],function(e,t,n,r,i,s,o,u,a,f){function l(){function r(){var e=t.intradayOrderItems();if(e.length<=0)return[];var n=[];e.forEach(function(e){var t=e.isWithdraw()||!(e.orderStatusValue()in u.WithdrawableOrderStatuses);e.isWithdraw(t);var r=new Object;r.orderId=e.orderId(),r.orderTime=e.orderTime(),r.optionNumber=e.optionNumber(),r.optionName=e.optionName(),r.isWithdraw=e.isWithdraw(),r.buyOrSell=e.buyOrSell(),r.openOrClose=e.openOrClose(),r.orderPrice=e.orderPrice(),r.orderQuantity=e.orderQuantity(),r.matchedQuantity=e.matchedQuantity(),r.orderStatus=e.orderStatus(),r.optionType=e.optionType(),r.isCovered=e.isCovered(),r.orderType=e.orderType,r.orderDate=e.orderDate(),r.optionSide=e.optionSide(),n.push(r)}),t.displayedItems(n),e.length!=t.displayedItems().length&&f.trigger(f.Portfolio.REFRESH)}var t=this;this.withdrawableOnly=e.observable(!0),this.selectedOrder=e.observable(null),this.selectOrder=function(e){t.selectedOrder(e)},this.pullingIntradayOrders=e.observable(!1),this.gridReady=e.observable(!1),this.intradayOrderItems=e.observableArray([]),this.displayedItems=e.observableArray([]),this.pullIntradayOrders=function(){if(t.pullingIntradayOrders())return;t.pullingIntradayOrders(!0),i.intradayOrders.get("",{},!0).done(function(e){t.intradayOrderItems(e()),r()}).always(function(){t.gridReady(!0),t.pullingIntradayOrders(!1)})},f.on(f.Bottom.INTRADAY_REFRESH,this.pullIntradayOrders),this.withdrawConfirm=e.observable(!1),this.withdrawingSelected=e.observable(!1),this.withdrawSelected=function(){var n=t.selectedOrder();n&&(t.withdrawingSelected()||(t.withdrawingSelected(!0),i.order.post("cancel/"+e.unwrap(n.orderId)).done(function(e){console.log(e)}).fail(function(e){e.responseJSON&&console.log(e.responseJSON.message),console.log(e)}).always(function(){f.trigger(f.Bottom.INTRADAY_REFRESH),t.closeWithdrawConfirm(),t.withdrawingSelected(!1)})))},this.showWithdrawConfirm=function(){var e,n=window.localStorage.getItem("noConfrimWhenCancelOrderInStore");n=="false"||n==null||n==""?e=!0:e=!1,e?t.withdrawConfirm(!0):t.withdrawSelected()},this.closeWithdrawConfirm=function(){t.withdrawConfirm(!1)},this.kendoGrid=$.extend(s.baseOptions(),{data:t.displayedItems,rowTemplate:"orderRowTemplate",sortable:!0,height:280,resizable:!0,scrollable:!0,dataBound:function(){}}),this.kendoContextMenu={targets:"#intradayOrderGridContainer tbody tr",width:"260px",itemSelect:function(e){t.withdrawSelected();var n=kendo.format('You selected: "{0}" on "{1}"',$(e.item).text().trim(),$(e.target).text());console.log(n)}},this.kendoWithdrawConfirmWindow=$.extend(o.baseOptions(),{isOpen:t.withdrawConfirm,title:n.localize("trade.confirm"),resizable:!0,width:250}),this.attached=function(){t.pullIntradayOrders(),setInterval(t.pullIntradayOrders,1e4)},this.detached=function(){clearInterval(t.pullIntradayOrders)}}return l}),define("viewmodels/trade/portfolioList",["jquery","knockout","modules/localizer","modules/dropDownList","events","dataContext","modules/orderEnums","modules/kendoWindow","modules/context","modules/combinationHelpers","knockout-kendo","modules/formatting","modules/grid"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=function(){var r=this;this.withdrawableOnly=t.observable(!0),this.portfolioListItems=t.observableArray([]),this.selectedOrder=t.observable(null),this.selectOrder=function(e){r.selectedOrder(e)},r.loadPortfolio=function(){s.intradayExercises.get("",{},!0).done(function(e){var t=[];e().forEach(function(e){var n=e.isWithdraw()||!(e.orderStatusValue()in o.WithdrawableOrderStatuses);e.isWithdraw(n);var r=new Object;r.orderId=e.orderId(),r.orderTime=e.orderTime(),r.optionNumber=e.optionNumber(),r.optionName=e.optionName(),r.isWithdraw=e.isWithdraw(),r.buyOrSell=e.buyOrSell(),r.openOrClose=e.openOrClose(),r.orderPrice=e.orderPrice(),r.orderQuantity=e.orderQuantity(),r.matchedQuantity=e.matchedQuantity(),r.orderStatus=e.orderStatus(),r.optionType=e.optionType(),r.isCovered=e.isCovered(),r.orderType=e.orderType,r.orderDate=e.orderDate(),r.optionSide=e.optionSide(),t.push(r)}),r.portfolioListItems(t)}).always(function(){})},this.withdrawConfirm=t.observable(!1),i.on(i.Bottom.INTRADAY_EXERCISES_REFRESH,this.loadPortfolio),this.withdrawingSelected=t.observable(!1),this.withdrawSelected=function(){var e=r.selectedOrder();e&&(r.withdrawingSelected()||(r.withdrawingSelected(!0),s.order.post("cancel/"+t.unwrap(e.orderId)).done(function(e){console.log(e)}).fail(function(e){e.responseJSON&&console.log(e.responseJSON.message),console.log(e)}).always(function(){i.trigger(i.Bottom.INTRADAY_EXERCISES_REFRESH),r.closeWithdrawConfirm(),r.withdrawingSelected(!1)})))},this.showWithdrawConfirm=function(){var e,t=window.localStorage.getItem("noConfrimWhenCancelOrderInStore");t=="false"||t==null||t==""?e=!0:e=!1,e?r.withdrawConfirm(!0):r.withdrawSelected()},this.kendoWithdrawConfirmWindow=e.extend(u.baseOptions(),{isOpen:r.withdrawConfirm,title:n.localize("trade.confirm"),resizable:!0,width:250}),this.closeWithdrawConfirm=function(){r.withdrawConfirm(!1)},r.portfolioGirds=e.extend(h.baseOptions(),{data:r.portfolioListItems,rowTemplate:"exercisableRowTemplate",sortable:!0,height:320,resizable:!0,scrollable:!0,dataBound:function(e){}}),this.attached=function(){r.loadPortfolio(),setInterval(r.loadPortfolio,3e4)},this.detached=function(){clearInterval(r.loadPortfolio)}};return new p}),define("viewmodels/trade/intradayTrades",["knockout","komapping","modules/localizer","modules/notifications","dataContext","modules/grid","modules/orderEnums","modules/formatting","events","knockout-kendo"],function(e,t,n,r,i,s,o,u,a){function f(){function n(){var e=t.intradayTradeItems();if(e.length<=0)return[];var n=[];e.forEach(function(e){var t=new Object;t.matchedTime=e.matchedTime(),t.optionNumber=e.optionNumber(),t.optionName=e.optionName(),t.buyOrSell=e.buyOrSell(),t.openOrClose=e.openOrClose(),t.matchedPrice=e.matchedPrice(),t.matchedQuantity=e.matchedQuantity(),t.orderPrice=e.orderPrice(),t.matchedAmount=e.matchedAmount(),t.optionSide=e.optionSide(),t.optionType=e.optionType(),t.isCovered=e.isCovered(),t.orderId=e.orderId(),t.matchedSerialNo=e.matchedSerialNo(),t.offerReturnMessage=e.offerReturnMessage(),n.push(t)}),t.displayedTradeItems(n),e.length!=t.displayedTradeItems().length&&a.trigger(a.Portfolio.REFRESH)}var t=this;this.intradayTradeItems=e.observableArray([]),this.gridReady=e.observable(!1),this.pullingIntradayTraders=e.observable(!1),this.selectedTrade=e.observable(null),this.selectTrade=function(e){t.selectedTrade(e)},this.displayedTradeItems=e.observableArray([]),this.pullIntradayTrades=function(){if(t.pullingIntradayTraders())return;t.pullingIntradayTraders(!0),i.intradayTrades.get("",{},!0).done(function(e){t.intradayTradeItems(e()),n()}).always(function(){t.gridReady(!0),t.pullingIntradayTraders(!1)})},this.dblClickToTrade=function(t){a.trigger(a.OrderEntry.PREFILL_ORDER,{optionNumber:e.unwrap(t.optionNumber)})},this.kendoGrid=$.extend(s.baseOptions(),{data:t.displayedTradeItems,rowTemplate:"tradeRowTemplate",sortable:!0,height:280,resizable:!0,scrollable:!0,dataBound:function(e){}}),a.on(a.Bottom.INTRADAY_REFRESH,this.pullIntradayTrades),this.attached=function(){t.pullIntradayTrades(),setInterval(t.pullIntradayTrades,1e4)},this.detached=function(){clearInterval(t.pullIntradayTrades)}}return f}),define("viewmodels/trade/queryOption",["jquery","knockout","modules/localizer","modules/dropDownList","events","dataContext","modules/orderEnums","modules/kendoWindow","modules/context","modules/combinationHelpers","knockout-kendo","modules/formatting"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={},p=[{key:"trade.queryOptions.historicalOrder",value:"101"},{key:"trade.queryOptions.historicalTrade",value:"102"},{key:"trade.queryOptions.historicalStrike",value:"103"}],d={101:!0,102:!0,103:!0},v=function(n){var o=this;o.histStartDate=t.observable(),o.histEndDate=t.observable(),o.Biz=t.observable(n||"101"),o.orderGridReady=t.observable(!1),o.historicalOrders=t.observableArray([]),o.historicalTrades=t.observableArray([]),o.historicalStrikes=t.observableArray([]),o.showOrdersOrTradesOrStrikes=t.observable(0),o.queryBizOptions=t.computed(function(){var e=d;return p.filter(function(t){return t.value in e})}),o.kendoQueryType=e.extend((new r).baseOptions(),{data:o.queryBizOptions,value:o.Biz,select:function(e){var t=e.item.index();i.trigger(i.Bottom.HIST_ORDERS_TRADES_STRIKES,t),o.showOrdersOrTradesOrStrikes(t)}}),o.initializeDate=function(){var e=new Date,t=new Date;t.setDate(t.getDate()-20),o.histStartDate(t),o.histEndDate(e)},o.initializeDate(),o.pullHistoricalOrder=function(){var e=o.histStartDate(),t=o.histEndDate();s.historicalOrders.get("historicalQuery",[c.formatDate(e,"yyyyMMdd"),c.formatDate(t,"yyyyMMdd")]).done(function(e){e&&o.historicalOrders(e())}).always(function(){o.orderGridReady(!0)})},o.pullHistoricalTrade=function(){var e=o.histStartDate(),t=o.histEndDate();s.historicalTrades.get("historicalQuery",[c.formatDate(e,"yyyyMMdd"),c.formatDate(t,"yyyyMMdd")]).done(function(e){e&&o.historicalTrades(e())}).always(function(){o.orderGridReady(!0)})},o.pullHistoricalStrike=function(){var e=o.histStartDate(),t=o.histEndDate();s.historicalStrikes.get("historicalQuery",[c.formatDate(e,"yyyyMMdd"),c.formatDate(t,"yyyyMMdd")]).done(function(e){e&&o.historicalStrikes(e())}).always(function(){o.orderGridReady(!0)})}};return new v}),define("viewmodels/trade/paramSet",["jquery","knockout","modules/localizer","modules/dropDownList","events","dataContext","modules/orderEnums","modules/kendoWindow","modules/context","modules/combinationHelpers","knockout-kendo"],function(e,t,n,r,i,s,o,u,a,f){var l=function(){self=this;var e;window.localStorage.getItem("noConfirmWhenPlaceOrderInStore")=="true"?e=!0:e=!1,self.noConfirmWhenPlaceOrder=t.observable(e),self.setting1=function(){var e=self.noConfirmWhenPlaceOrder();window.localStorage.setItem("noConfirmWhenPlaceOrderInStore",e),console.log(window.localStorage.getItem("noConfirmWhenPlaceOrderInStore"))},self.noConfirmWhenPlaceOrder.subscribe(self.setting1),window.localStorage.getItem("noConfrimWhenCancelOrderInStore")=="true"?e=!0:e=!1,self.noConfrimWhenCancelOrder=t.observable(e),self.setting2=function(){var e=self.noConfrimWhenCancelOrder();window.localStorage.setItem("noConfrimWhenCancelOrderInStore",e)},self.noConfrimWhenCancelOrder.subscribe(self.setting2),window.localStorage.getItem("illegalDataForStoreInStore")=="true"?e=!0:e=!1,self.illegalData=t.observable(e),self.setting3=function(){var e=self.illegalData();window.localStorage.setItem("illegalDataForStoreInStore",e)},self.illegalData.subscribe(self.setting3),window.localStorage.getItem("placeOrdermanuallyForStoreInStore")=="true"?e=!0:e=!1,self.placeOrdermanually=t.observable(e),self.setting4=function(){var e=self.placeOrdermanually();window.localStorage.setItem("placeOrdermanuallyForStoreInStore",e)},self.placeOrdermanually.subscribe(self.setting4),window.localStorage.getItem("changeToCompetitorRateInStore")=="true"?e=!0:e=!1,self.changeToCompetitorRate=t.observable(e),self.setting5=function(){var e=self.changeToCompetitorRate();window.localStorage.setItem("changeToCompetitorRateInStore",e),console.log(e)},self.changeToCompetitorRate.subscribe(self.setting5),self.adjustPriceForStore,self.adjustPrice=t.observable({decimals:0,format:"#",step:1,min:1,max:10}),self.minutesOption=t.observable(),self.minutesOption={decimals:0,format:"#",step:1,min:1,max:10}};return l}),define("viewmodels/trade/queryGrid",["jquery","knockout","modules/localizer","modules/dropDownList","events","dataContext","modules/orderEnums","modules/kendoWindow","modules/context","modules/combinationHelpers","knockout-kendo","modules/formatting","modules/grid","./queryOption"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=function(){var n=this;n.showOrdersOrTradesOrStrikes=t.observable(0),i.on(i.Bottom.HIST_ORDERS_TRADES_STRIKES,function(e){n.showOrdersOrTradesOrStrikes(e)}),n.kendoGridForOrder=e.extend(h.baseOptions(),{data:p.historicalOrders,rowTemplate:"orderRowTemplateOnChains",sortable:!0,height:280,resizable:!0,scrollable:!0,dataBound:function(e){h.showLabelIfEmpty(e)}}),n.kendoGridForTrade=e.extend(h.baseOptions(),{data:p.historicalTrades,rowTemplate:"tradeRowTemplateOnChains",sortable:!0,height:280,resizable:!0,scrollable:!0,dataBound:function(e){h.showLabelIfEmpty(e)}}),n.kendoGridForStrike=e.extend(h.baseOptions(),{data:p.historicalStrikes,rowTemplate:"strikeRowTemplateOnChains",sortable:!0,height:280,resizable:!0,scrollable:!0,dataBound:function(e){h.showLabelIfEmpty(e)}})};return new d}),define("viewmodels/compositions/historicalInquiry",["knockout","komapping","dataContext","modules/grid","modules/formatting","modules/localizer","modules/combinationViewModel","modules/combinationChart","events","loader","modules/kendoWindow","modules/dropDownList","plugins/router","viewmodels/compositions/symbolLookup","portfolioItemGroupModel","modules/enums","koBindings/changeFlash","kendo","kendo-plugins","knockout-kendo","koBindings/kendoExt"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=function(){var t=this;this.datePickerEnabled=!1,this.orderStartDate=e.observable(),this.orderEndDate=e.observable(),this.tradeStartDate=e.observable(),this.tradeEndDate=e.observable(),this.orderGridReady=e.observable(!1),this.tradeGridReady=e.observable(!1),this.historicalOrders=e.observableArray([]),this.historicalTrades=e.observableArray([]),this.fundTransferHistory=e.observableArray([]),this.isHCVisible=e.observable(!1),this.initializeDate=function(){var e=new Date,n=new Date;n.setDate(n.getDate()-20),t.orderStartDate(n),t.orderEndDate(e),t.tradeStartDate(n),t.tradeEndDate(e)},this.initializeDate(),this.pullHistoricalOrder=function(){var e=t.orderStartDate(),r=t.orderEndDate();n.historicalOrders.get({beginDate:i.formatDate(e,"yyyyMMdd"),endDate:i.formatDate(r,"yyyyMMdd")}).done(function(e){e&&t.historicalOrders(e())}).always(function(){t.orderGridReady(!0)})},this.pullHistoricalTrade=function(){var e=t.tradeStartDate(),r=t.tradeEndDate();n.historicalTrades.get({beginDate:i.formatDate(e,"yyyyMMdd"),endDate:i.formatDate(r,"yyyyMMdd")}).done(function(e){e&&t.historicalTrades(e())}).always(function(){t.tradeGridReady(!0)})},this.kendoGridForOrder=$.extend(r.baseOptions(),{data:t.historicalOrders,rowTemplate:"orderRowTemplateOnChains",sortable:!0,height:155,resizable:!0,scrollable:!0,dataBound:function(e){t.tradeGridReady()&&r.showLabelIfEmpty(e)}}),this.kendoGridForTrade=$.extend(r.baseOptions(),{data:t.historicalTrades,rowTemplate:"tradeRowTemplateOnChains",sortable:!0,height:155,resizable:!0,scrollable:!0,dataBound:function(e){t.tradeGridReady()&&r.showLabelIfEmpty(e)}}),this.hcWindowOptions=$.extend(l.baseOptions(),{isOpen:t.isHCVisible,title:s.localize("portfolio.historicalInquiry"),width:1e3}),a.on(a.Portfolio.HISTORICAL_INQUIRY,function(){t.isHCVisible(!t.isHCVisible())})};return new m});